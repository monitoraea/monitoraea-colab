{"version":3,"sources":["components/PageTitle/PageTitle.js","components/PageTitle/PageTitle.module.scss","components/FlowRenderer/index.js","tools/Agora/index.js"],"names":["PageTitle","title","className","styles","module","exports","FlowRenderer","notifications","hasMore","onMore","onSend","loading","sending","useState","message","_message","loadMoreActive","_loadMoreActive","useEffect","setTimeout","useInView","threshold","ref","inView","console","log","placeholder","value","onChange","e","target","disabled","onClick","map","n","id","Element","fallback","data","MoreContainer","styled","div","Agora","server","useDorothy","user","useUser","currentCommunity","useRouter","useSnackbar","enqueueSnackbar","closeSnackbar","queryClient","useQueryClient","useQuery","queryFn","axios","get","enabled","type","_type","errors","_errors","confirming","_confirming","following","_following","mutations","sendBroadcast","useMutation","post","changeFollowing","put","room","communityId","onSuccess","invalidateQueries","handleConfirmSendBroadcast","snackKey","persist","anchorOrigin","vertical","horizontal","mutateAsync","variant","error","checked","isCommunity","Card","name","FormGroup","FormControlLabel","control","Switch","label","FormControl","fullWidth","InputLabel","Select","MenuItem","TextField","multiline","rows","hasErrors","newErrors","trim","length","Dialog","open","onClose","maxWidth","DialogTitle","DialogContent","DialogActions","Button","autoFocus"],"mappings":"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","file":"static/js/18.469a50c5.chunk.js","sourcesContent":["import styles from './PageTitle.module.scss';\n\nexport const PageTitle = ({ title }) => <div className={styles['page-title']}>{title}</div>;\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"page-title\":\"PageTitle_page-title__1MUJj\"};","import React, { useState, useEffect, Fragment, Suspense } from \"react\";\nimport { useInView } from 'react-intersection-observer';\nimport styled from 'styled-components';\nimport './index.scss';\n\nexport default function FlowRenderer({ notifications, hasMore, onMore, onSend, loading, sending }) {\n    const [message, _message] = useState('');\n    const [loadMoreActive, _loadMoreActive] = useState(false);\n\n    useEffect(()=>{\n        if(loading === 'fetched')\n        setTimeout(()=>_loadMoreActive(true), 3000) /* TODO: best practices */\n    },[loading])\n\n    const [ref, inView] = useInView({\n        /* Optional options */\n        threshold: 0,\n    });\n\n    useEffect(() => {\n        if (inView && hasMore && loading === 'fetched') {\n            console.log('load more...')\n            onMore();\n        }\n    }, [inView, hasMore, onMore, loading]); \n\n    return (\n        <div className=\"flow\">\n            <div className=\"flow-new\">\n                <textarea placeholder=\"Inicie um tópico...\" className=\"textarea-box\" value={message} onChange={(e) => _message(e.target.value)} />\n                <button className='button-primary' disabled={sending === 'sending'} onClick={() => { onSend(message); _message('') }}>publicar</button>\n            </div>\n            <div className=\"flow-line\"/>\n\n            {notifications.map(n => {\n                const { id, Element } = n;\n\n                return <Fragment key={id}>\n                    <Suspense fallback={<div>...</div>}>\n                        <Element data={n} />\n                    </Suspense>\n                </Fragment>\n            })}\n\n            {loading === 'fetching' && <>...</>}\n            {/* {loading !== 'fetching' && <>\n                {hasMore && <button disabled={loading === 'fetching_more'} onClick={onMore}>{loading === 'fetching_more' ? <>...</> : <>more messages</>}</button>}\n            </>} */}\n\n            {loadMoreActive && <MoreContainer ref={ref}>...</MoreContainer>}\n        </div>\n    )\n}\n\nconst MoreContainer = styled.div`\n    width: 100%;\n    margin-top: 5px; \n    position: relative;\n`;","import React, { useEffect, useState } from \"react\";\nimport Card from '../../components/Card';\nimport { PageTitle } from '../../components/PageTitle/PageTitle';\n\nimport { Flow, useRouter, useDorothy, useUser } from 'dorothy-dna-react';\nimport FlowRenderer from \"../../components/FlowRenderer\";\n\nimport {\n    FormControl,\n    Select,\n    MenuItem,\n    InputLabel,\n    TextField,\n    Dialog,\n    DialogTitle,\n    DialogContent,\n    DialogActions,\n    Button,\n    FormGroup,\n    FormControlLabel,\n    Switch,\n} from '@mui/material';\n\nimport { useQuery, useMutation, useQueryClient } from 'react-query';\nimport axios from 'axios';\n\nimport { useSnackbar } from 'notistack';\n\nexport default function Agora() {\n    /* hooks */\n    const { server } = useDorothy();\n    const { user } = useUser();\n    const { currentCommunity } = useRouter();\n    const { enqueueSnackbar, closeSnackbar } = useSnackbar();\n    const queryClient = useQueryClient();\n\n    const { data } = useQuery(['following_status'], {\n        queryFn: async () => (await axios.get(`${server}user/${user.id}/following/room_c${currentCommunity.id}_t1`)).data,\n        enabled: !!user && !!currentCommunity,\n    });\n\n    /* state */\n    const [type, _type] = useState(null);\n    const [message, _message] = useState('');\n    const [errors, _errors] = useState({});\n    const [confirming, _confirming] = useState(false);\n    const [following, _following] = useState(null);    \n\n    useEffect(() => {\n        if (!!data) {\n            _following(data?.following);\n        }\n    }, [data])\n\n    const mutations = {\n        sendBroadcast: useMutation(\n            () => {\n                return axios.post(`${server}gt/broadcasting`, {\n                    type,\n                    message,\n                });\n            },\n        ),\n        changeFollowing: useMutation(\n            (following) => {\n                return axios.put(`${server}user/${user.id}/follow`, {\n                    room: `room_c${currentCommunity.id}_t1`,\n                    following: following ? 1 : 0,\n                    communityId: currentCommunity.id,\n                });\n            },\n            {\n              onSuccess: () => {\n                queryClient.invalidateQueries('following_status');\n              },\n            },\n        ),\n    }\n\n    const handleSendBroadcast = () => {\n\n        let hasErrors = false;\n        let newErrors = {};\n\n        if (!type) {\n            newErrors.type = true;\n            hasErrors = true;\n        }\n        if (message.trim().length === 0) {\n            newErrors.message = true;\n            hasErrors = true;\n        }\n\n        _errors(newErrors);\n\n        if (hasErrors) return;\n\n        _confirming(true);\n    }\n\n    const handleConfirmSendBroadcast = async () => {\n        _confirming(false);\n\n        const snackKey = enqueueSnackbar('Enviando...', {\n            /* variant: 'info', */\n            /* hideIconVariant: true, */\n            persist: true,\n            anchorOrigin: {\n                vertical: 'top',\n                horizontal: 'center',\n            },\n        });\n\n        try {\n\n\n            await mutations.sendBroadcast.mutateAsync();\n\n            _type(null);\n            _message('');\n\n            closeSnackbar(snackKey);\n\n            enqueueSnackbar('Envio efetuado com sucesso!', {\n                variant: 'success',\n                anchorOrigin: {\n                    vertical: 'top',\n                    horizontal: 'right',\n                },\n            });\n        } catch (error) {\n            closeSnackbar(snackKey);\n\n            console.error(error);\n\n            enqueueSnackbar('Erro ao enviar notificações!', {\n                variant: 'error',\n                anchorOrigin: {\n                    vertical: 'top',\n                    horizontal: 'right',\n                },\n            });\n        }\n    }\n\n    const changeFollowing = async (e) => {\n        _following(e.target.checked);\n        await mutations.changeFollowing.mutateAsync(e.target.checked);\n    }\n\n    return (<>\n        {/* flow geral de comunidade especifica */}\n        <div className=\"page width-limiter\">\n            <div className=\"page-header\">\n                <PageTitle title=\"Fluxo\" />\n            </div>\n            <div className=\"page-content\">\n                <div className=\"page-body\">\n                    <Flow isCommunity={true}>\n                        <FlowRenderer />\n                    </Flow>\n                </div>\n                <div className=\"page-sidebar\">\n                    <Card title=\"sobre o fluxo\">\n                        <p className=\"pt-1 px-3 pb-3\">\n                            Este é o fluxo do grupo de trabalho de {currentCommunity ? currentCommunity.name : '...'}.\n                            {following !== null && <div>\n                                <FormGroup>\n                                    <FormControlLabel\n                                        control={\n                                            <Switch\n                                                checked={!!following}\n                                                onChange={changeFollowing}\n                                            />\n                                        }\n                                        label=\"Seguindo\"\n                                    />\n                                </FormGroup>\n                            </div>}\n                        </p>\n                    </Card>\n\n                    {currentCommunity.id === 1 && <Card title=\"Envio de notificação em massa\">\n                        <p className=\"pt-1 px-3 pb-3\">\n                            <FormControl fullWidth>\n                                <InputLabel>\n                                    Para quem?\n                                </InputLabel>\n                                <Select\n                                    label=\"Para quem?\"\n                                    className=\"input-select\"\n                                    value={type || 'none'}\n                                    onChange={(e) => _type(e.target.value)}\n                                    error={errors.type}\n                                >\n                                    <MenuItem value=\"none\"> -- selecione -- </MenuItem>\n                                    <MenuItem value=\"all\">Todos os grupos</MenuItem>\n                                    <MenuItem value=\"projects\">Iniciativas</MenuItem>\n                                    <MenuItem value=\"supporters\">Facilitadores</MenuItem>\n                                </Select>\n                            </FormControl>\n                        </p>\n                        <p className=\"pt-1 px-3 pb-3\">\n                            <TextField\n                                label=\"mensagem\"\n                                className=\"input-text\"\n                                value={message}\n                                onChange={e => _message(e.target.value)}\n                                multiline\n                                rows={8}\n                                error={errors.message}\n                            />\n                        </p>\n                        <p className=\"pt-1 px-3 pb-3\">\n                            <button className=\"button-primary\" onClick={handleSendBroadcast}>\n                                Enviar\n                            </button>\n                        </p>\n                    </Card>}\n                </div>\n            </div>\n        </div>\n\n        <Dialog\n            open={confirming}\n            onClose={() => _confirming(false)}\n            aria-labelledby=\"alert-dialog-title\"\n            aria-describedby=\"alert-dialog-description\"\n            fullWidth\n            maxWidth=\"sm\"\n        >\n            <DialogTitle id=\"alert-dialog-title\">Confirmação de envio de notificação em massa</DialogTitle>\n            <DialogContent id=\"alert-dialog-description\">\n                O envio de noticações em massa é irreversível!\n            </DialogContent>\n            <DialogActions>\n                <button className=\"button-primary\" onClick={handleConfirmSendBroadcast}>\n                    Enviar\n                </button>\n                <Button onClick={() => _confirming(false)} autoFocus>\n                    Cancelar\n                </Button>\n            </DialogActions>\n        </Dialog>\n    </>)\n}"],"sourceRoot":""}