(this["webpackJsonpzcm-v2-frontend"]=this["webpackJsonpzcm-v2-frontend"]||[]).push([[18],{326:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(327),c=n.n(a),r=n(1),i=function(e){var t=e.title;return Object(r.jsx)("div",{className:c.a["page-title"],children:t})}},327:function(e,t,n){e.exports={"page-title":"PageTitle_page-title__1MUJj"}},540:function(e,t,n){},641:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return I}));var a,c=n(9),r=n(17),i=n(24),s=n(0),o=n(53),l=n(326),u=n(16),j=n(86),d=n(541),b=n(430),O=(n(540),n(1));function h(e){var t=e.notifications,n=e.hasMore,a=e.onMore,r=e.onSend,i=e.loading,o=e.sending,l=Object(s.useState)(""),u=Object(c.a)(l,2),j=u[0],b=u[1],h=Object(s.useState)(!1),f=Object(c.a)(h,2),m=f[0],x=f[1];Object(s.useEffect)((function(){"fetched"===i&&setTimeout((function(){return x(!0)}),3e3)}),[i]);var v=Object(d.a)({threshold:0}),g=Object(c.a)(v,2),w=g[0],y=g[1];return Object(s.useEffect)((function(){y&&n&&"fetched"===i&&(console.log("load more..."),a())}),[y,n,a,i]),Object(O.jsxs)("div",{className:"flow",children:[Object(O.jsxs)("div",{className:"flow-new",children:[Object(O.jsx)("textarea",{placeholder:"Inicie um t\xf3pico...",className:"textarea-box",value:j,onChange:function(e){return b(e.target.value)}}),Object(O.jsx)("button",{className:"button-primary",disabled:"sending"===o,onClick:function(){r(j),b("")},children:"publicar"})]}),Object(O.jsx)("div",{className:"flow-line"}),t.map((function(e){var t=e.id,n=e.Element;return Object(O.jsx)(s.Fragment,{children:Object(O.jsx)(s.Suspense,{fallback:Object(O.jsx)("div",{children:"..."}),children:Object(O.jsx)(n,{data:e})})},t)})),"fetching"===i&&Object(O.jsx)(O.Fragment,{children:"..."}),m&&Object(O.jsx)(p,{ref:w,children:"..."})]})}var p=b.a.div(a||(a=Object(j.a)(["\n    width: 100%;\n    margin-top: 5px; \n    position: relative;\n"]))),f=n(516),m=n(491),x=n(517),v=n(309),g=n(316),w=n(306),y=n(305),N=n(308),k=n(251),C=n(245),S=n(253),E=n(255),F=n(250),_=n(38),z=n(19),M=n.n(z),q=n(35);function I(){var e=Object(u.e)().server,t=Object(u.h)().user,n=Object(u.g)().currentCommunity,a=Object(q.b)(),j=a.enqueueSnackbar,d=a.closeSnackbar,b=Object(_.useQueryClient)(),p=Object(_.useQuery)(["following_status"],{queryFn:function(){var a=Object(i.a)(Object(r.a)().mark((function a(){return Object(r.a)().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,M.a.get("".concat(e,"user/").concat(t.id,"/following/room_c").concat(n.id,"_t1"));case 2:return a.abrupt("return",a.sent.data);case 3:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}(),enabled:!!t&&!!n}),z=p.data,I=Object(s.useState)(null),J=Object(c.a)(I,2),P=J[0],Q=J[1],T=Object(s.useState)(""),W=Object(c.a)(T,2),A=W[0],B=W[1],U=Object(s.useState)({}),D=Object(c.a)(U,2),G=D[0],H=D[1],K=Object(s.useState)(!1),L=Object(c.a)(K,2),R=L[0],V=L[1],X=Object(s.useState)(null),Y=Object(c.a)(X,2),Z=Y[0],$=Y[1];Object(s.useEffect)((function(){z&&$(null===z||void 0===z?void 0:z.following)}),[z]);var ee={sendBroadcast:Object(_.useMutation)((function(){return M.a.post("".concat(e,"gt/broadcasting"),{type:P,message:A})})),changeFollowing:Object(_.useMutation)((function(a){return M.a.put("".concat(e,"user/").concat(t.id,"/follow"),{room:"room_c".concat(n.id,"_t1"),following:a?1:0,communityId:n.id})}),{onSuccess:function(){b.invalidateQueries("following_status")}})},te=function(){var e=Object(i.a)(Object(r.a)().mark((function e(){var t;return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return V(!1),t=j("Enviando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}}),e.prev=2,e.next=5,ee.sendBroadcast.mutateAsync();case 5:Q(null),B(""),d(t),j("Envio efetuado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),e.next=16;break;case 11:e.prev=11,e.t0=e.catch(2),d(t),console.error(e.t0),j("Erro ao enviar notifica\xe7\xf5es!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}});case 16:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=Object(i.a)(Object(r.a)().mark((function e(t){return Object(r.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return $(t.target.checked),e.next=3,ee.changeFollowing.mutateAsync(t.target.checked);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:"page width-limiter",children:[Object(O.jsx)("div",{className:"page-header",children:Object(O.jsx)(l.a,{title:"Fluxo"})}),Object(O.jsxs)("div",{className:"page-content",children:[Object(O.jsx)("div",{className:"page-body",children:Object(O.jsx)(u.c,{isCommunity:!0,children:Object(O.jsx)(h,{})})}),Object(O.jsxs)("div",{className:"page-sidebar",children:[Object(O.jsx)(o.a,{title:"sobre o fluxo",children:Object(O.jsxs)("p",{className:"pt-1 px-3 pb-3",children:["Este \xe9 o fluxo do grupo de trabalho de ",n?n.name:"...",".",null!==Z&&Object(O.jsx)("div",{children:Object(O.jsx)(f.a,{children:Object(O.jsx)(m.a,{control:Object(O.jsx)(x.a,{checked:!!Z,onChange:ne}),label:"Seguindo"})})})]})}),1===n.id&&Object(O.jsxs)(o.a,{title:"Envio de notifica\xe7\xe3o em massa",children:[Object(O.jsx)("p",{className:"pt-1 px-3 pb-3",children:Object(O.jsxs)(v.a,{fullWidth:!0,children:[Object(O.jsx)(g.a,{children:"Para quem?"}),Object(O.jsxs)(w.a,{label:"Para quem?",className:"input-select",value:P||"none",onChange:function(e){return Q(e.target.value)},error:G.type,children:[Object(O.jsx)(y.a,{value:"none",children:" -- selecione -- "}),Object(O.jsx)(y.a,{value:"all",children:"Todos os grupos"}),Object(O.jsx)(y.a,{value:"projects",children:"Iniciativas"}),Object(O.jsx)(y.a,{value:"supporters",children:"Facilitadores"})]})]})}),Object(O.jsx)("p",{className:"pt-1 px-3 pb-3",children:Object(O.jsx)(N.a,{label:"mensagem",className:"input-text",value:A,onChange:function(e){return B(e.target.value)},multiline:!0,rows:8,error:G.message})}),Object(O.jsx)("p",{className:"pt-1 px-3 pb-3",children:Object(O.jsx)("button",{className:"button-primary",onClick:function(){var e=!1,t={};P||(t.type=!0,e=!0),0===A.trim().length&&(t.message=!0,e=!0),H(t),e||V(!0)},children:"Enviar"})})]})]})]})]}),Object(O.jsxs)(k.a,{open:R,onClose:function(){return V(!1)},"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"sm",children:[Object(O.jsx)(C.a,{id:"alert-dialog-title",children:"Confirma\xe7\xe3o de envio de notifica\xe7\xe3o em massa"}),Object(O.jsx)(S.a,{id:"alert-dialog-description",children:"O envio de notica\xe7\xf5es em massa \xe9 irrevers\xedvel!"}),Object(O.jsxs)(E.a,{children:[Object(O.jsx)("button",{className:"button-primary",onClick:te,children:"Enviar"}),Object(O.jsx)(F.a,{onClick:function(){return V(!1)},autoFocus:!0,children:"Cancelar"})]})]})]})}}}]);
//# sourceMappingURL=18.469a50c5.chunk.js.map