import{j as e,u as B,b as I,d as O,r as a,e as H,f as F,z as K,l as w,S as ie,M as D,A as U,g as ce,c as ne,D as de,h as ue,i as me,T as se,k as he,B as pe}from"./index-BN3gKjL8.js";import{T as xe,a as W}from"./Tabs-DyF4vSY-.js";import{T as E,A as G}from"./Trash-8H_ufUkd.js";import{C as q}from"./index-CZB1zvQB.js";import{T as V,a as X}from"./TableRow-9XFqVBHT.js";import{I as M}from"./Popper-Dy494ZUE.js";import{T as J}from"./TablePagination-5b9KPxQu.js";import{B as Z}from"./Box-C5mAkSw4.js";import{T as ee}from"./TableSortLabel-DZPWNsEe.js";import{D as ae}from"./index-Ur2ATter.js";import{P as re}from"./Plus-BcUBqwKt.js";import{P as je}from"./PageTitle-kKvWziKP.js";import"./KeyboardArrowRight-78DbW38S.js";import"./useThemeProps-CDSbSnq-.js";import"./useThemeProps-DlwLatle.js";import"./getThemeProps-DH9qAVvt.js";const ve="_backdrop_wqc9y_52",fe="_divisor_wqc9y_118",ge="_cleanfilters_wqc9y_124",A={"tool-tabs":"_tool-tabs_wqc9y_45",backdrop:ve,"ptabs-content":"_ptabs-content_wqc9y_72","ptabs-tabs":"_ptabs-tabs_wqc9y_79","ptabs-actions":"_ptabs-actions_wqc9y_91","ptabs-datefilter":"_ptabs-datefilter_wqc9y_96","ptabs-datefilter-button":"_ptabs-datefilter-button_wqc9y_106",divisor:fe,cleanfilters:ge};function be({defaultTab:t,onTabChange:s}){const o=i=>{s(i.target.id)};return e.jsxs("div",{className:A["tool-tabs"],children:[e.jsx("div",{className:A.backdrop}),e.jsx("div",{className:A["ptabs-content"],children:e.jsxs(xe,{className:A["ptabs-tabs"],onChange:o,value:t,children:[e.jsx(W,{disableRipple:!0,label:"Membros",...z("lista")}),e.jsx(W,{disableRipple:!0,label:"Solicitações",...z("solicitacoes")}),e.jsx(W,{disableRipple:!0,label:"Convites",...z("convites")})]})})]})}function z(t){return{id:t,"aria-controls":`simple-tabpanel-${t}`,value:t}}const _e=()=>{const{server:t}=B(),{currentCommunity:s}=I(),o=O(),[i,l]=a.useState(1),[c,j]=a.useState("name"),[n,v]=a.useState("desc"),[h,_]=a.useState(10),[g,y]=a.useState(null),{data:p}=H(["members_list",{community:s.id,page:i,order:c,direction:n,perPage:h}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/membership/?page=${i}&order=${c}&direction=${n==="asc"?"desc":"asc"}&limit=${h}`)).data}),u={remove:F(r=>w.delete(`${t}gt/${s.id}/membership/${r.id}`),{onSuccess:()=>o.invalidateQueries("members_list")})},b=r=>{l(1),c===r?v(n==="asc"?"desc":"asc"):(j(r),v("desc"))},C=r=>{y(r)},N=async r=>{r==="confirm"&&await u.remove.mutateAsync(g),y(null)};return e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"page-body",children:[p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(Q,{text:"ID",column:"id",order:c,direction:n,onClick:b})}),e.jsx("th",{children:e.jsx(Q,{text:"Nome",column:"name",order:c,direction:n,onClick:b})}),e.jsx("th",{children:e.jsx(Q,{text:"E-mail",column:"email",order:c,direction:n,onClick:b})}),e.jsx("th",{children:"Ações"})]})}),e.jsx(V,{children:p.entities.map(r=>e.jsxs(ye,{children:[e.jsxs("td",{children:["#",r.id]}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.email}),e.jsx("td",{className:"tbox-table-actions",children:e.jsx("div",{children:e.jsx(E,{title:"Remover",children:e.jsx(M,{onClick:()=>C(r),children:e.jsx(G,{})})})})})]},r.id))})]})})}),e.jsx(J,{className:"pagination",component:"div",count:p.total,page:i-1,onPageChange:(...r)=>l(r[1]+1),rowsPerPage:h,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:r=>{_(r.target.value),l(1)}})]}),e.jsx(Z,{display:"flex",justifyContent:"space-between"}),e.jsx(q,{open:!!g,content:"Confirma a remoção deste membro?",confirmButtonText:"Remover",onClose:N})]})})};function Q({text:t,column:s,order:o,direction:i,enabled:l=!0,onClick:c}){return e.jsxs(e.Fragment,{children:[!l&&e.jsx(e.Fragment,{children:t}),l&&e.jsx(ee,{className:"tbox-table-sortlabel",active:o===s,direction:i,onClick:()=>c(s),children:t})]})}const ye=K(X)({"&:last-child td, &:last-child th":{border:0}}),Ce=_e,Ne=()=>{const{server:t}=B(),{currentCommunity:s}=I(),o=O(),[i,l]=a.useState(1),[c,j]=a.useState("name"),[n,v]=a.useState("desc"),[h,_]=a.useState(10),[g,y]=a.useState(null),{data:p}=H(["invites_list",{community:s.id,page:i,order:c,direction:n,perPage:h}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/invites/?page=${i}&order=${c}&direction=${n==="asc"?"desc":"asc"}&limit=${h}`)).data}),u={remove:F(r=>w.delete(`${t}gt/${s.id}/invites/${r.id}`),{onSuccess:()=>o.invalidateQueries("invites_list")})},b=r=>{l(1),c===r?v(n==="asc"?"desc":"asc"):(j(r),v("desc"))},C=r=>{y(r)},N=async r=>{r==="confirm"&&await u.remove.mutateAsync(g),y(null)};return e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"page-body",children:[p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(L,{text:"ID",column:"id",order:c,direction:n,onClick:b})}),e.jsx("th",{children:e.jsx(L,{text:"Nome",column:"name",order:c,direction:n,onClick:b})}),e.jsx("th",{children:e.jsx(L,{text:"E-mail",column:"email",order:c,direction:n,onClick:b})}),e.jsx("th",{children:"Ações"})]})}),e.jsx(V,{children:p.entities.map(r=>e.jsxs(ke,{children:[e.jsxs("td",{children:["#",r.id]}),e.jsx("td",{children:r.name}),e.jsx("td",{children:r.email}),e.jsx("td",{className:"tbox-table-actions",children:e.jsx("div",{children:e.jsx(E,{title:"Remover",children:e.jsx(M,{onClick:()=>C(r),children:e.jsx(G,{})})})})})]},r.id))})]})})}),e.jsx(J,{className:"pagination",component:"div",count:p.total,page:i-1,onPageChange:(...r)=>l(r[1]+1),rowsPerPage:h,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:r=>{_(r.target.value),l(1)}})]}),e.jsx(Z,{display:"flex",justifyContent:"space-between"}),e.jsx(q,{open:!!g,content:"Confirma a remoção deste convite?",confirmButtonText:"Remover",onClose:N})]})})};function L({text:t,column:s,order:o,direction:i,enabled:l=!0,onClick:c}){return e.jsxs(e.Fragment,{children:[!l&&e.jsx(e.Fragment,{children:t}),l&&e.jsx(ee,{className:"tbox-table-sortlabel",active:o===s,direction:i,onClick:()=>c(s),children:t})]})}const ke=K(X)({"&:last-child td, &:last-child th":{border:0}}),$e=Ne,Se=t=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-user-check",...t},a.createElement("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),a.createElement("circle",{cx:8.5,cy:7,r:4}),a.createElement("polyline",{points:"17 11 19 13 23 9"}));function we(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"})]})}const Pe="_sidebar_filters_1f2oe_45",Te="_filter_group_1f2oe_45",De="_group_title_1f2oe_48",Fe="_add_filter_1f2oe_55",Re="_choose_filter_1f2oe_79",Ae="_filter_1f2oe_45",Ee="_remove_1f2oe_86",$={sidebar_filters:Pe,filter_group:Te,group_title:De,add_filter:Fe,choose_filter:Re,filter:Ae,"input-select":"_input-select_1f2oe_83",remove:Ee};function qe({filters:t,onChange:s,options:o,dateRange:i=!0}){const[l,c]=a.useState([]),[j,n]=a.useState(!0),[v,h]=a.useState(!1),[_,g]=a.useState(null),[y,p]=a.useState(null),[u,b]=a.useState([]);a.useEffect(()=>{const x=t.filter(d=>d.type!=="period").map(d=>d.type).filter(d=>d!=="unknown"),f=x.length===o.length;c(x),n(!f&&!t.find(d=>!d.value))},[t,o,i]),a.useEffect(()=>{b(t.filter(x=>!!x.value))},[t]);const C=()=>{s([...t,{type:"unknown"}]),n(!1)},N=x=>{let f=!1;const d=x.filter(k=>k.value&&k.type!=="unknown").map(k=>k.type);for(let k of d)if(o.find(S=>S.type===k&&S.incompatibleWith.includes("period"))){f=!0;break}return f&&(g(null),p(null)),h(f),f},r=(x,f)=>{let d=[...t];if(d[f]=x,x.value){const S=o.find(P=>P.type===x.type);S.incompatibleWith&&(d=d.filter(P=>!S.incompatibleWith.includes(P.type)))}N(d)&&(d=d.filter(S=>S.type!=="period")),s(d)},R=x=>{let f=t.filter((d,k)=>k!==x);N(f),s(f)},Y=(x,f)=>{g(x),p(f);let d=[...t.filter(k=>k.type!=="period"),{type:"period",value:[x,f]}];s(d)};return e.jsxs("div",{className:`${$.sidebar_filters}`,children:[i&&e.jsxs("div",{className:`${$.filter_group}`,children:[e.jsx("div",{className:`${$.group_title}`,children:"Período"}),e.jsx(Ie,{disabled:v,startDate:_,endDate:y,onChange:Y,className:"input-datepicker"})]}),e.jsxs("div",{className:`${$.filter_group}`,children:[e.jsx("div",{className:`${$.group_title}`,children:"Filtros"}),t.map((x,f)=>x.type==="period"?null:e.jsxs("div",{children:[f>0&&e.jsx("hr",{className:"hr-spacer"}),e.jsx(Me,{onFilterChange:d=>r(d,f),onRemove:()=>R(f),options:o,usedOptions:l,filters:u,...x})]},x.type)),j&&t.length>0&&e.jsx("hr",{className:"hr-spacer"}),j&&e.jsx(Be,{onClick:C})]})]})}function Me({options:t,filters:s,usedOptions:o,type:i,value:l,onFilterChange:c,onRemove:j}){const[n,v]=a.useState("unknown");a.useEffect(()=>{i&&v(i)},[i]);let h=null,_={};const g=t.find(u=>u.type===n);g&&g.chooser&&(h=g.chooser,g.chooserProps&&(_=g.chooserProps));const y=u=>{v(u.target.value);const b=t.find(N=>N.type===u.target.value);let C=null;b&&!b.chooser&&(C=!0),c({type:u.target.value,value:C})},p=u=>{c({type:n,value:u})};return e.jsxs("div",{className:`${$.choose_filter}`,children:[e.jsxs("div",{className:`${$.filter}`,children:[e.jsxs(ie,{className:"input-select",fullWidth:!0,value:n,onChange:y,children:[e.jsx(D,{value:"unknown",children:"escolha um filtro"}),t==null?void 0:t.filter(u=>!o.includes(u.type)||u.type===i).map(u=>e.jsx(D,{value:u.type,children:u.title},u.type))]}),e.jsx("div",{className:`${$.remove}`,onClick:j,children:e.jsx(we,{})})]}),!!h&&e.jsx("div",{className:`${$.filter_option}`,children:e.jsx(h,{onChange:p,..._,filters:s,value:l})})]})}function Be({onClick:t}){return e.jsxs("div",{className:`${$.add_filter}`,onClick:t,children:[e.jsx("div",{children:"filtrar por"}),e.jsx(re,{})]})}function Ie({disabled:t=!1,startDate:s,endDate:o,onChange:i}){const[l,c]=a.useState(null),[j,n]=a.useState(null);return a.useEffect(()=>{c(s)},[s]),a.useEffect(()=>{n(o)},[o]),e.jsxs("div",{className:"input-daterangepicker",children:[e.jsx(ae,{value:l,onChange:v=>i(v,j),disabled:t,clearable:!0,clearText:"remover"}),e.jsx("div",{}),e.jsx(ae,{value:j,onChange:v=>i(l,v),minDate:l,disabled:t,clearable:!0,clearText:"remover",onError:v=>{v==="minDate"&&n(null)}})]})}const Oe=t=>{let s=[];for(let o of t)if(o.type==="period"){const[i,l]=o.value;i&&s.push(`ini_date=${U(i).format("YYYY-MM-DD")}`),l&&s.push(`end_date=${U(l).format("YYYY-MM-DD")}`)}else o.value&&s.push(`${o.type}=${o.value}`);return s.length?`&${s.join("&")}`:""};function Ye({value:t,onChange:s}){const o=i=>{s(i)};return e.jsx(ce,{fullWidth:!0,children:e.jsxs(ie,{className:"input-select",value:t||"none",onChange:i=>o(i.target.value),children:[e.jsx(D,{value:"none",children:" -- selecione -- "}),e.jsx(D,{value:"adm",children:"Responsável"}),e.jsx(D,{value:"member",children:"Membro"})]})})}const We=[{title:"por responsab.",type:"participation_type",chooser:Ye,incompatibleWith:[]}],ze=()=>{const{server:t}=B(),{currentCommunity:s}=I(),o=O(),{enqueueSnackbar:i,closeSnackbar:l}=ne(),[c,j]=a.useState(1),[n,v]=a.useState("createdAt"),[h,_]=a.useState("asc"),[g,y]=a.useState(10),[p,u]=a.useState(null),[b,C]=a.useState(null),[N,r]=a.useState([]),[R,Y]=a.useState(""),{data:x}=H(["participation_list",{community:s.id,page:c,order:n,direction:h,perPage:g,urlFilters:R}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/participation/?page=${c}&order=${n}&direction=${h==="asc"?"desc":"asc"}&limit=${g}${R}`)).data}),f={remove:F(m=>w.delete(`${t}gt/${s.id}/participation/${m.id}`),{onSuccess:()=>o.invalidateQueries("participation_list")}),approve:F(m=>w.put(`${t}gt/${s.id}/participation/${m.id}`),{onSuccess:()=>o.invalidateQueries("participation_list")})};a.useEffect(()=>{N&&(Y(Oe(N)),j(1),v("createdAt"),_("asc"))},[N]);const d=m=>{j(1),n===m?_(h==="asc"?"desc":"asc"):(v(m),_("desc"))},k=m=>{C(m)},S=async m=>{m==="confirm"&&await f.remove.mutateAsync(b),C(null)},P=m=>{u(m)},oe=async m=>{if(m==="confirm"){const te=i("Aprovando a solicitação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{await f.approve.mutateAsync(p),l(te),i("Solicitação aprovada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(le){l(te),console.error(le),i("Erro ao aprovar a solicitação!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}}u(null)};return e.jsxs("div",{className:"page-content mb-5",children:[e.jsx("div",{className:"page-sidebar sticky",children:e.jsx("div",{className:"sidebar-body",children:e.jsx(qe,{filters:N,options:We,onChange:r})})}),e.jsxs("div",{className:"page-body",children:[x&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(T,{text:"ID",column:"id",order:n,direction:h,onClick:d})}),e.jsx("th",{children:e.jsx(T,{text:"Data de solicitação",column:"createdAt",order:n,direction:h,onClick:d})}),e.jsx("th",{children:e.jsx(T,{text:"Nome",column:"name",order:n,direction:h,onClick:d})}),s.alias==="adm"&&e.jsx("th",{children:e.jsx(T,{text:"Grupo de trabalho",column:"community_name",order:n,direction:h,onClick:d})}),e.jsx("th",{children:e.jsx(T,{text:"Responsável",column:"adm",order:n,direction:h,onClick:d})}),e.jsx("th",{children:"Ações"})]})}),e.jsx(V,{children:x.entities.map(m=>e.jsxs(Qe,{children:[e.jsxs("td",{children:["#",m.id]}),e.jsx("td",{children:U(m.createdAt).format("DD/MM/YYYY")}),e.jsx("td",{children:m.name}),s.alias==="adm"&&e.jsx("td",{children:m.community_name}),e.jsx("td",{children:m.adm?"sim":"não"}),e.jsxs("td",{className:"tbox-table-actions",children:[e.jsx("div",{children:e.jsx(E,{title:"Aprovar",children:e.jsx(M,{onClick:()=>P(m),children:e.jsx(Se,{})})})}),e.jsx("div",{children:e.jsx(E,{title:"Remover",children:e.jsx(M,{onClick:()=>k(m),children:e.jsx(G,{})})})})]})]},m.id))})]})})}),e.jsx(J,{className:"pagination",component:"div",count:x.total,page:c-1,onPageChange:(...m)=>j(m[1]+1),rowsPerPage:g,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:m=>{y(m.target.value),j(1)}})]}),e.jsx(Z,{display:"flex",justifyContent:"space-between"}),e.jsx(q,{open:!!b,content:"Confirma a remoção desta solicitação?",confirmButtonText:"Remover",onClose:S}),e.jsx(q,{open:!!p,content:"Confirma a aprovação desta solicitação?",confirmButtonText:"Aprovar",onClose:oe})]})]})};function T({text:t,column:s,order:o,direction:i,enabled:l=!0,onClick:c}){return e.jsxs(e.Fragment,{children:[!l&&e.jsx(e.Fragment,{children:t}),l&&e.jsx(ee,{className:"tbox-table-sortlabel",active:o===s,direction:i,onClick:()=>c(s),children:t})]})}const Qe=K(X)({"&:last-child td, &:last-child th":{border:0}}),Le=ze;function ct(){const{changeRoute:t,params:s,currentCommunity:o}=I(),{server:i}=B(),{enqueueSnackbar:l,closeSnackbar:c}=ne(),j=O(),[n,v]=a.useState(null),[h,_]=a.useState(!1),g={invite:F(p=>w.post(`${i}gt/${o.id}/membership`,p),{onSuccess:()=>j.invalidateQueries("invites_list")})};a.useEffect(()=>{v(s&&s.length?s[0]:"lista")},[s]);const y=async(p,u)=>{if(!p||!p.length||!u||!u.length)return;const b=l("Enviando o convite..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{await g.invite.mutateAsync({name:p,email:u}),c(b),l("Convite enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),_(!1),t({params:["convites"]})}catch(C){c(b),console.error(C),l("Erro ao enviar o convite!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(je,{title:"Membros"}),e.jsx("div",{className:"page-header-buttons",children:e.jsxs("button",{className:"button-primary",onClick:()=>_(!0),children:[e.jsx(re,{}),"Convidar"]})})]}),n&&e.jsxs(e.Fragment,{children:[e.jsx(be,{defaultTab:n,onTabChange:p=>t({params:[p]})}),n==="lista"&&e.jsx(Ce,{}),n==="convites"&&e.jsx($e,{}),n==="solicitacoes"&&e.jsx(Le,{})]}),e.jsx(Ue,{open:h,onCreate:y,onClose:()=>_(!1)})]})}function Ue({open:t,onCreate:s,onClose:o}){const[i,l]=a.useState(""),[c,j]=a.useState("");return a.useEffect(()=>{t&&(l(""),j(""))},[t]),e.jsx("div",{children:e.jsxs(de,{open:t,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{id:"alert-dialog-title",children:"Enviar um convite"}),e.jsxs(me,{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(se,{className:"input-text",label:"Nome",value:i,onChange:n=>l(n.target.value)})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(se,{className:"input-text",label:"E-mail",value:c,onChange:n=>j(n.target.value)})})})]}),e.jsxs(he,{children:[e.jsx(pe,{onClick:()=>o(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>s(i,c),children:"Criar"})]})]})})}export{ct as default};
