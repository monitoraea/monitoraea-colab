import{r as o,j as e,u as Z,d as M,c as j,e as z,C as J,o as N,l as B,E as P,q as W,f as $,T as U,A as V,b as K,a as X,D as ee,h as te,i as S,k as ie,B as oe}from"./index-BBw7QwKF.js";import{T as ae,a as E}from"./Tabs-BfSjt6lv.js";import"./lodash-C7QqFTGI.js";import{m as se,R as ne,U as re}from"./index-gnBBLgSI.js";import{D as ce}from"./index-CDLW8h1a.js";import{C as le}from"./index-BYOM-a-D.js";import{P as me}from"./plus-CwcqUnYF.js";import{P as de}from"./PageTitle-BTzaKbkB.js";import{B as ue}from"./Box-BTNPWRkB.js";import"./KeyboardArrowRight-BVqOZDBe.js";import"./Plus-CVubINO2.js";import"./Trash-2pZcX-vp.js";import"./Popper-CYEbyxeH.js";import"./Autocomplete-Cdct8V3n.js";import"./FormGroup-BUGLYAa9.js";import"./FormControlLabel-BCx5uoE6.js";import"./useThemeProps-SKs67XED.js";import"./getThemeProps-CrbXbNpL.js";import"./Checkbox-Cdsbpw7u.js";import"./useThemeProps-DFUa_Ol-.js";const pe="_backdrop_x4juq_52",_e="_indicator_x4juq_85",ge="_warning_x4juq_106",Ae="_ready_x4juq_109",ke="_divisor_x4juq_146",ye="_cleanfilters_x4juq_152",G={"projects-tabs":"_projects-tabs_x4juq_45",backdrop:pe,"ptabs-content":"_ptabs-content_x4juq_72","ptabs-tabs":"_ptabs-tabs_x4juq_79",indicator:_e,"fixed-size":"_fixed-size_x4juq_85","not-ready":"_not-ready_x4juq_103",warning:ge,ready:Ae,"ptabs-actions":"_ptabs-actions_x4juq_119","ptabs-datefilter":"_ptabs-datefilter_x4juq_124","ptabs-datefilter-button":"_ptabs-datefilter-button_x4juq_134",divisor:ke,cleanfilters:ye};function he({defaultTab:a,onTabChange:l,analysis:_}){o.useState(!1);const m=A=>{l(A.target.id)};return e.jsxs("div",{className:G["projects-tabs"],children:[e.jsx("div",{className:G.backdrop}),e.jsx("div",{className:G["ptabs-content"],children:e.jsxs(ae,{className:G["ptabs-tabs"],onChange:m,value:a,children:[e.jsx(E,{disableRipple:!0,label:"Informações",...T("informacao")}),e.jsx(E,{disableRipple:!0,label:"Linha do tempo",...T("linha_tempo")})]})})]})}function T(a,l=""){return{id:a,"aria-controls":`simple-tabpanel-${a}`,value:a,"data-problems":l}}const Q={fields:[{key:"logo_arquivo",type:"thumbnail",title:"Logotipo",size:2},{key:"uf_nome",type:"read_only",title:"Estado",size:3},{key:"regiao",type:"read_only",title:"Região",size:3},{key:"data_criacao",type:"yearpicker",title:"Data da criação",size:3},{key:"ativo",type:"options",title:"Ativo",size:3,options:[{value:1,label:"Sim"},{value:2,label:"Em reestruturação"},{value:3,label:"Não"}]},{key:"link",type:"text",title:"Link para o site",size:12},{key:"documento_criacao",type:"text",title:"Título do documento de criação",size:4},{key:"documento_criacao_tipo",type:"options",title:"Tipo de documento de criação",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"documento_criacao_arquivo",type:"text",title:"Link para o documento de criação",size:6,show:{target:{key:"documento_criacao_tipo",value:"link"}}},{key:"documento_criacao_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de criação",size:6,show:{target:{key:"documento_criacao_tipo",value:"file"}}},{key:"composicao_cadeiras_set_pub",type:"integer",title:"Núm. cadeiras - setor público",size:3},{key:"composicao_cadeiras_soc_civ",type:"integer",title:"Núm. cadeiras - sociedade civil",size:3},{key:"setor",type:"text",title:"Setor %index%",size:6},{key:"cadeiras",type:"integer",title:"Cadeiras %index%",size:6},{key:"coordenacao",type:"options",title:"Órgão gestor",size:6,options:[{value:1,label:"Secretarias Estaduais de Meio Ambiente (ou correlatas) e de Educação"},{value:2,label:"Apenas Secretaria de Estado de Meio Ambiente (ou correlatas)"},{value:3,label:"Apenas Secretaria de Estado de Educação"},{value:4,label:"Outra Pasta do Estado"},{value:5,label:"Instituição da Sociedade Civil"},{value:6,label:"Instituição de outro segmento"}]},{key:"coordenacao_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"coordenacao",value:[4,6]}}},{key:"regimento_interno_tem",type:"options",title:"Tem regimento?",size:4,list:{module:"property",key:"sim_nao"}},{key:"regimento_interno",type:"text",title:"Título do regimento interno",size:12,show:{target:{key:"regimento_interno_tem",value:"sim"}}},{key:"regimento_interno_tipo",type:"options",title:"Tipo de documento de regimento",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"regimento_interno_arquivo",type:"text",title:"Link para o regimento interno",size:6,show:{target:{key:"regimento_interno_tipo",value:"link"}}},{key:"regimento_interno_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de regimento",size:6,show:{target:{key:"regimento_interno_tipo",value:"file"}}},{key:"org_interna_periodicidade",type:"options",title:"Periodicidade",size:6,options:[{value:1,label:"Mensal"},{value:2,label:"Bimestral"},{value:3,label:"Semestral"},{value:4,label:"Anual"},{value:5,label:"Outro"}]},{key:"organizacao_interna_periodicidade_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"org_interna_periodicidade",value:5}}},{key:"organizacao_interna_estrutura_tem",type:"options",title:"Possui câmaras técnicas ou grupos de trabalho?",size:6,list:{module:"property",key:"sim_nao"}},{key:"organizacao_interna_estrutura_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"organizacao_interna_estrutura_tem",value:"sim"}}},{key:"ppea_tem",type:"options",title:"Tem política pública?",size:4,list:{module:"property",key:"sim_nao"}},{key:"ppea_tipo",type:"options",title:"Tipo de documento de política pública",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"ppea_arquivo",type:"text",title:"Link para a política pública",size:6,show:{target:{key:"ppea_tipo",value:"link"}}},{key:"ppea_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de política pública",size:6,show:{target:{key:"ppea_tipo",value:"file"}}},{key:"ppea_decreto",type:"text",title:"Decreto",size:3},{key:"ppea_lei",type:"text",title:"Lei",size:3}],blocks:[{key:"detalhes",title:"Detalhes da comissão",elements:["logo_arquivo","uf_nome","regiao","data_criacao","ativo","link"]},{key:"documento",title:"Documento de criação",elements:["documento_criacao","documento_criacao_tipo","documento_criacao_arquivo","documento_criacao_arquivo2"]},{key:"composicao",title:"Composição",elements:[{type:"field",key:"composicao_cadeiras_set_pub"},"composicao_cadeiras_soc_civ",{type:"block",key:"composicao_cadeiras_outros"}]},{key:"composicao_cadeiras_outros",elements:["setor","cadeiras"],iterate:{target:"none",index:"default",add:"Adicionar setor"}},{key:"coordenacao_block",title:"Coordenação",elements:["coordenacao","coordenacao_especifique"]},{key:"regimento_interno_block",title:"Regimento interno",elements:["regimento_interno_tem","regimento_interno",{type:"block",key:"regimento_interno_tem_block"}]},{key:"regimento_interno_tem_block",elements:["regimento_interno_tipo","regimento_interno_arquivo","regimento_interno_arquivo2"],show:{target:{key:"regimento_interno_tem",value:"sim"}}},{key:"organizacao_interna",title:"Organização interna",elements:["org_interna_periodicidade","organizacao_interna_periodicidade_especifique","organizacao_interna_estrutura_tem","organizacao_interna_estrutura_especifique"]},{key:"ppea_block",title:"Política Pública de Educação Ambiental",elements:["ppea_tem",{type:"block",key:"ppea_tem_block"}]},{key:"ppea_tem_block",elements:["ppea_tipo","ppea_arquivo","ppea_arquivo2","ppea_decreto","ppea_lei"],show:{target:{key:"ppea_tem",value:"sim"}}}]},Ce=[{type:"row",block:"detalhes",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:2,key:"logo_arquivo"}]},{type:"row",elements:[{type:"column",size:3,key:"uf_nome"},{type:"column",size:3,key:"regiao"},{type:"column",size:3,key:"data_criacao"},{type:"column",size:3,key:"ativo"}]},{type:"row",elements:[{type:"column",size:12,key:"link"}]}]}]},{type:"separator"},{type:"row",block:"documento",elements:[{type:"row",elements:[{type:"column",size:12,key:"documento_criacao"},{type:"column",size:2,key:"documento_criacao_tipo"},{type:"column",size:6,key:"documento_criacao_arquivo"},{type:"column",size:6,key:"documento_criacao_arquivo2"}]}]},{type:"separator"},{type:"row",block:"composicao",elements:[{type:"row",elements:[{type:"column",size:3,key:"composicao_cadeiras_set_pub"},{type:"column",size:3,key:"composicao_cadeiras_soc_civ"}]},{type:"row",block:"composicao_cadeiras_outros",elements:[{type:"column",size:3,key:"setor"},{type:"column",size:3,key:"cadeiras"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"composicao_cadeiras_outros",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar setor"}]}]}]}]},{type:"row",block:"coordenacao_block",elements:[{type:"column",size:6,key:"coordenacao"},{type:"column",size:6,key:"coordenacao_especifique"}]},{type:"row",block:"regimento_interno_block",elements:[{type:"column",size:6,key:"regimento_interno_tem"},{type:"column",size:6,key:"regimento_interno"}]},{type:"row",block:"regimento_interno_tem_block",elements:[{type:"column",size:6,key:"regimento_interno_tipo"},{type:"column",size:6,key:"regimento_interno_arquivo"},{type:"column",size:6,key:"regimento_interno_arquivo2"}]},{type:"row",block:"organizacao_interna",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"org_interna_periodicidade"},{type:"column",size:6,key:"organizacao_interna_periodicidade_especifique"}]},{type:"row",elements:[{type:"column",size:6,key:"organizacao_interna_estrutura_tem"},{type:"column",size:6,key:"organizacao_interna_estrutura_especifique"}]}]}]},{type:"row",block:"ppea_block",elements:[{type:"column",size:4,key:"ppea_tem"}]},{type:"row",block:"ppea_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea_tipo"},{type:"column",size:6,key:"ppea_arquivo"},{type:"column",size:6,key:"ppea_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea_decreto"},{type:"column",size:3,key:"ppea_lei"}]}]}]}],ve={lists:[{key:"sim_nao",options:[{value:"sim",label:"Sim"},{value:"nao",label:"Não"}]},{key:"tipo_arquivo",options:[{value:"link",label:"Link"},{value:"file",label:"Arquivo"}]}]},D={logo_arquivo:null,documento_criacao_arquivo2:null,regimento_interno_arquivo2:null};function be({entityId:a}){const{server:l}=Z(),_=M(),{enqueueSnackbar:m,closeSnackbar:A}=j(),[h,d]=o.useState({}),[u,g]=o.useState({}),[p,C]=o.useState(D),{data:v}=z(["commission_info",{entityId:a}],{queryFn:async()=>(await B.get(`${l}commission/${a}/draft`)).data,retry:!1,refetchOnWindowFocus:!1});o.useEffect(()=>{if(!v||!Q)return;const t=se(v,Q);g(t),d(t),C(D)},[v,Q]);const f=(t,i,c)=>{if(c===void 0){let s={...u};if(t.includes("tipo")&&i==="link"){console.log();const n=t.replace("_tipo","");s={...s,[`${n}_arquivo`]:h[`${n}_tipo`]==="link"?h[`${n}_arquivo`]:""}}["logo_arquivo","documento_criacao_arquivo2","regimento_interno_arquivo2"].includes(t)?(s={...s,[t]:i||"remove"},C({...p,[t]:i==null?void 0:i.file})):s={...s,[t]:i},console.log(`changing ${t}:`,i,s),g(s)}else{let s=u[c.k];s&&Array.isArray(s)&&(s[c.index][t]=i,g(n=>({...n,[c.k]:s})))}},b=t=>{let i=u[t.k];i.splice(t.index,1),g(c=>({...c,[t.k]:i}))},I=t=>{let i={};for(let s of t.elements)i[s]=null;let c;u[t.key]?c=[...u[t.key],i]:c=[i],g(s=>({...s,[t.key]:c}))},Y=async()=>{let t=new FormData;p.logo_arquivo&&t.append("logo",p.logo_arquivo),u.documento_criacao_tipo==="file"&&p.documento_criacao_arquivo2&&t.append("documento_criacao",p.documento_criacao_arquivo2),u.regimento_interno_tipo==="file"&&p.regimento_interno_arquivo2&&t.append("regimento_interno",p.regimento_interno_arquivo2);const i=m("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let c,s;c="put",s=`${l}commission/${a}/draft`,t.set("entity",JSON.stringify(u));const{data:n}=await B({method:c,url:s,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});_.invalidateQueries("commission_info"),A(i),m("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(c){A(i),console.error(c),m("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return e.jsx(e.Fragment,{children:u&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(J,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:Y,children:[e.jsx(N,{}),"Gravar"]})})]}),e.jsx(ne,{form:Q,view:Ce,lists:ve,data:u,onDataChange:f,onRemoveIterative:b,onAddIterative:I}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:Y,children:[e.jsx(N,{}),"Gravar"]})})]})]})})})})})}var fe={exports:{}};(function(a,l){(function(_,m){a.exports=m(P)})(W,function(_){function m(d){return d&&typeof d=="object"&&"default"in d?d:{default:d}}var A=m(_),h={name:"pt-br",weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"Do_2ª_3ª_4ª_5ª_6ª_Sá".split("_"),months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),ordinal:function(d){return d+"º"},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [às] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [às] HH:mm"},relativeTime:{future:"em %s",past:"há %s",s:"poucos segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"}};return A.default.locale(h,null,!0),h})})(fe);const Ye=a=>o.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash",...a},o.createElement("polyline",{points:"3 6 5 6 21 6"}),o.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})),Be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZEAAAGRCAYAAACkIY5XAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABZtJREFUeJzt1UENACAQwDDAv+fDwz6EpFWw3/bMzAKA4LwOAOBfJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQHYBGSAHHiuWzmAAAAAASUVORK5CYII=",Ie="_vcentered_12ruc_1",xe="_add_12ruc_6",Ge="_remove_12ruc_6",Qe="_timeline_12ruc_30",Je="_highlight_12ruc_33",Ze="_each_12ruc_37",je="_date_12ruc_46",ze="_thumb_12ruc_49",we="_text_12ruc_68",y={vcentered:Ie,add:xe,remove:Ge,timeline:Qe,highlight:Je,each:Ze,date:je,thumb:ze,"thumb-image":"_thumb-image_12ruc_53",text:we};function qe({entityId:a}){const{server:l}=Z(),_=M(),{enqueueSnackbar:m,closeSnackbar:A}=j(),[h,d]=o.useState([]),[u,g]=o.useState(new Date),[p,C]=o.useState(null),[v,f]=o.useState(null),[b,I]=o.useState(null),[Y,t]=o.useState(null),[i,c]=o.useState(null),[s,n]=o.useState(null),{data:k}=z(["commission_timeline",{entityId:a}],{queryFn:async()=>(await B.get(`${l}commission/${a}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),O=$(r=>B.delete(`${l}commission/${a}/draft/timeline/${r}`),{onSuccess:()=>_.invalidateQueries("commission_timeline")});o.useEffect(()=>{k&&d(k)},[k]),o.useEffect(()=>{i&&setTimeout(()=>{document.getElementById(`timeline_${i}`).scrollIntoView(),n(i),c(null),setTimeout(()=>n(null),2e3)},10)},[h,i]),o.useEffect(()=>{f(p?p.file:null)},[p]);const R=async()=>{if(!b||!b.length)return;let r=new FormData;v&&r.append("image",v);const w=m("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let x,q;x="post",q=`${l}commission/${a}/draft/timeline`,r.set("entity",JSON.stringify({date:u,texto:b}));const{data:H}=await B({method:x,url:q,data:r,config:{headers:{"Content-Type":"multipart/form-data"}}});c(H.id),g(new Date),I(null),C(null),f(null),_.invalidateQueries("commission_timeline"),A(w),m("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(x){A(w),console.error(x),m("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},F=r=>()=>{t(r)},L=async r=>{r==="confirm"&&await O.mutateAsync(Y),t(null)};return e.jsx(e.Fragment,{children:h&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(J,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:`col-xs-2 ${y.vcentered}`,children:e.jsx(ce,{className:"input-datepicker",label:"Mês",value:u||"",onChange:g,views:["month","year"],inputFormat:"MM/yyyy"})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(re,{onChange:C,url:p==null?void 0:p.url,alt:"imagem",title:"Imagem"})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(U,{className:"input-text",label:"Texto",value:b||"",onChange:r=>I(r.target.value),multiline:!0,rows:4})}),e.jsx("div",{className:`col-xs-1 ${y.vcentered}`,children:e.jsx("button",{className:y.add,onClick:R,children:e.jsx(me,{})})})]})})})}),e.jsx(J,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:y.timeline,children:!!k&&h.map(r=>e.jsxs("div",{id:`timeline_${r.id}`,className:`${y.each} ${s===r.id?y.highlight:""}`,children:[e.jsxs("div",{className:y.date,children:[" ⚬ ",V(r.date).locale("pt-br").format("MMM [de] YYYY")]}),e.jsx("div",{className:y.thumb,children:e.jsxs("div",{className:y["thumb-image"],children:[!!r.image&&e.jsx("img",{src:r.image,alt:"imagem de timeline"}),!r.image&&e.jsx("img",{src:Be,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:y.text,children:r.texto}),e.jsx("div",{children:e.jsx("button",{className:y.remove,onClick:F(r.id),children:e.jsx(Ye,{})})})]},r.id))})})})})]}),e.jsx(le,{open:!!Y,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:L})]})})}const Ne="_button_delete_lccbr_45",Se="_Roll_lccbr_1",Ee="_term_lccbr_82",Te={button_delete:Ne,Roll:Se,term:Ee},rt=()=>{const{currentCommunity:a,changeRoute:l,params:_}=K(),{server:m}=Z(),{user:A,updateUser:h}=X(),{enqueueSnackbar:d,closeSnackbar:u}=j(),[g,p]=o.useState(null),[C,v]=o.useState(null),[f,b]=o.useState(!1),[I,Y]=o.useState(!1),{data:t}=z(["commission",{currentCommunity:a.id}],{queryFn:async()=>(await B.get(`${m}commission/id_from_community/${a.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),i={publish:$(()=>B.put(`${m}commission/${g}/publish`))};o.useEffect(()=>{Y(A.membership.map(n=>n.id===1||n.id===a.id&&n.type==="adm").reduce((n,k)=>n||k))},[I,A,a]),o.useEffect(()=>{t&&p(t.id)},[t]),o.useEffect(()=>{v(_&&_.length?_[0]:"informacao")},[_]);const c=n=>{n==="confirm"&&s(),b(!1)},s=async()=>{const n=d("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:k}=await i.publish.mutateAsync();if(u(n),k.success)window.location=`${window.location}`,d("Comissão publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(k.reason.code==="not_ready")d(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta comissão ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(k){u(n),console.error(k),d("Erro ao publicar a comissão!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(de,{title:"Comissão"}),e.jsx("div",{className:"page-header-buttons"})]}),C&&e.jsxs(e.Fragment,{children:[e.jsx(he,{defaultTab:C,onTabChange:n=>l({params:[n]})}),g&&e.jsxs(e.Fragment,{children:[C==="informacao"&&e.jsx(be,{entityId:g}),C==="linha_tempo"&&e.jsx(qe,{entityId:g})]})]}),e.jsx(ue,{display:"flex",justifyContent:"space-between"}),e.jsx(De,{open:f,onClose:c})]})};function De({open:a,onClose:l}){return e.jsx("div",{children:e.jsxs(ee,{open:a,onClose:l,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(te,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(S,{children:e.jsx(S,{id:"alert-dialog-description",className:Te.term,children:e.jsx("p",{children:"TODO TODO TODO"})})}),e.jsxs(ie,{children:[e.jsx("button",{className:"button-primary",onClick:()=>l("confirm"),children:"Concordo"}),e.jsx(oe,{onClick:()=>l("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{rt as default};
