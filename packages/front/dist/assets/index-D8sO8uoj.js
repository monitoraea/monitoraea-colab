import{j as e,u as B,b as I,d as Y,r as a,e as U,f as E,o as A,p as q,A as K,E as V,n as w,c as G,S as re,M as R,t as oe,w as ae,x as H,i as de,P as ue,D as he,k as me,l as pe,T as ne,m as xe,B as ve}from"./index-DLt25zcS.js";import{T as je,a as W}from"./Tabs-BURW5nwB.js";import{C as O}from"./index-Bha5MrYE.js";import{T as X,a as J}from"./TableRow-2NasLTb7.js";import{T as Z}from"./TablePagination-ChKDi7BJ.js";import{B as ee}from"./Box-BoG2D6P7.js";import{T as te}from"./TableSortLabel-BadkXaU-.js";import{c as fe}from"./index-1IFiBNUq.js";import"./KeyboardArrowRight-B-_qEmRL.js";const ge="_backdrop_1ndo5_52",be="_divisor_1ndo5_118",_e="_cleanfilters_1ndo5_124",M={"tool-tabs":"_tool-tabs_1ndo5_45",backdrop:ge,"ptabs-content":"_ptabs-content_1ndo5_72","ptabs-tabs":"_ptabs-tabs_1ndo5_79","ptabs-actions":"_ptabs-actions_1ndo5_91","ptabs-datefilter":"_ptabs-datefilter_1ndo5_96","ptabs-datefilter-button":"_ptabs-datefilter-button_1ndo5_106",divisor:be,cleanfilters:_e};function ye({defaultTab:t,onTabChange:s}){const i=n=>{s(n.target.id)};return e.jsxs("div",{className:M["tool-tabs"],children:[e.jsx("div",{className:M.backdrop}),e.jsx("div",{className:M["ptabs-content"],children:e.jsxs(je,{className:M["ptabs-tabs"],onChange:i,value:t,children:[e.jsx(W,{disableRipple:!0,label:"Membros",...L("lista")}),e.jsx(W,{disableRipple:!0,label:"Solicitações",...L("solicitacoes")}),e.jsx(W,{disableRipple:!0,label:"Convites",...L("convites")})]})})]})}function L(t){return{id:t,"aria-controls":`simple-tabpanel-${t}`,value:t}}const ie={adm:"coordenador",member:"membro",organizer:"articulador"},Ce=()=>{const{server:t}=B(),{currentCommunity:s}=I(),i=Y(),[n,r]=a.useState(1),[l,m]=a.useState("name"),[o,c]=a.useState("desc"),[j,_]=a.useState(10),[b,k]=a.useState(null),{data:f}=U(["members_list",{community:s.id,page:n,order:l,direction:o,perPage:j}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/membership/?page=${n}&order=${l}&direction=${o==="asc"?"desc":"asc"}&limit=${j}`)).data}),d={remove:E(p=>w.delete(`${t}gt/${s.id}/membership/${p.id}`),{onSuccess:()=>i.invalidateQueries("members_list")})},y=p=>{r(1),l===p?c(o==="asc"?"desc":"asc"):(m(p),c("desc"))},C=p=>{k(p)},N=async p=>{p==="confirm"&&await d.remove.mutateAsync(b),k(null)};return e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"page-body",children:[f&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(z,{text:"ID",column:"id",order:l,direction:o,onClick:y})}),e.jsx("th",{children:e.jsx(z,{text:"Nome",column:"name",order:l,direction:o,onClick:y})}),e.jsx("th",{children:e.jsx(z,{text:"E-mail",column:"email",order:l,direction:o,onClick:y})}),e.jsx("th",{children:"Papel"}),e.jsx("th",{children:"Ações"})]})}),e.jsx(X,{children:f.entities.map(p=>e.jsxs(ke,{children:[e.jsxs("td",{children:["#",p.id]}),e.jsx("td",{children:p.name}),e.jsx("td",{children:p.email}),e.jsx("td",{children:p.type?ie[p.type.trim()]:ie.member}),e.jsx("td",{className:"tbox-table-actions",children:e.jsx("div",{children:e.jsx(A,{title:"Remover",children:e.jsx(q,{onClick:()=>C(p),children:e.jsx(K,{})})})})})]},p.id))})]})})}),e.jsx(Z,{className:"pagination",component:"div",count:f.total,page:n-1,onPageChange:(...p)=>r(p[1]+1),rowsPerPage:j,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:p=>{_(p.target.value),r(1)}})]}),e.jsx(ee,{display:"flex",justifyContent:"space-between"}),e.jsx(O,{open:!!b,content:"Confirma a remoção deste membro?",confirmButtonText:"Remover",onClose:N})]})})};function z({text:t,column:s,order:i,direction:n,enabled:r=!0,onClick:l}){return e.jsxs(e.Fragment,{children:[!r&&e.jsx(e.Fragment,{children:t}),r&&e.jsx(te,{className:"tbox-table-sortlabel",active:i===s,direction:n,onClick:()=>l(s),children:t})]})}const ke=V(J)({"&:last-child td, &:last-child th":{border:0}}),Ne=Ce,Se=t=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-clipboard",...t},a.createElement("path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"}),a.createElement("rect",{x:8,y:2,width:8,height:4,rx:1,ry:1})),$e=()=>{const{server:t}=B(),{currentCommunity:s}=I(),i=Y(),{enqueueSnackbar:n}=G(),[r,l]=a.useState(1),[m,o]=a.useState("name"),[c,j]=a.useState("desc"),[_,b]=a.useState(10),[k,f]=a.useState(null),{data:d}=U(["invites_list",{community:s.id,page:r,order:m,direction:c,perPage:_}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/invites/?page=${r}&order=${m}&direction=${c==="asc"?"desc":"asc"}&limit=${_}`)).data}),y={remove:E(x=>w.delete(`${t}gt/${s.id}/invites/${x.id}`),{onSuccess:()=>i.invalidateQueries("invites_list")})},C=x=>{l(1),m===x?j(c==="asc"?"desc":"asc"):(o(x),j("desc"))},N=x=>{f(x)},p=async x=>{x==="confirm"&&await y.remove.mutateAsync(k),f(null)},T=x=>async()=>{try{await fe(x.link),n(`Link de convite para ${x.name} foi copiado para a área de transferência!`,{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(v){console.error(v),n("Erro ao copiar o link!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"page-body",children:[d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(Q,{text:"ID",column:"id",order:m,direction:c,onClick:C})}),e.jsx("th",{children:e.jsx(Q,{text:"Nome",column:"name",order:m,direction:c,onClick:C})}),e.jsx("th",{children:e.jsx(Q,{text:"E-mail",column:"email",order:m,direction:c,onClick:C})}),e.jsx("th",{children:"Ações"})]})}),e.jsx(X,{children:d.entities.map(x=>e.jsxs(Pe,{children:[e.jsxs("td",{children:["#",x.id]}),e.jsx("td",{children:x.name}),e.jsx("td",{children:x.email}),e.jsxs("td",{className:"tbox-table-actions",children:[e.jsx("div",{children:e.jsx(A,{title:"Copiar link de convite para a área de transferência",children:e.jsx(q,{onClick:T(x),children:e.jsx(Se,{})})})}),e.jsx("div",{children:e.jsx(A,{title:"Remover",children:e.jsx(q,{onClick:()=>N(x),children:e.jsx(K,{})})})})]})]},x.id))})]})})}),e.jsx(Z,{className:"pagination",component:"div",count:d.total,page:r-1,onPageChange:(...x)=>l(x[1]+1),rowsPerPage:_,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:x=>{b(x.target.value),l(1)}})]}),e.jsx(ee,{display:"flex",justifyContent:"space-between"}),e.jsx(O,{open:!!k,content:"Confirma a remoção deste convite?",confirmButtonText:"Remover",onClose:p})]})})};function Q({text:t,column:s,order:i,direction:n,enabled:r=!0,onClick:l}){return e.jsxs(e.Fragment,{children:[!r&&e.jsx(e.Fragment,{children:t}),r&&e.jsx(te,{className:"tbox-table-sortlabel",active:i===s,direction:n,onClick:()=>l(s),children:t})]})}const Pe=V(J)({"&:last-child td, &:last-child th":{border:0}}),we=$e,Te=t=>a.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-user-check",...t},a.createElement("path",{d:"M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"}),a.createElement("circle",{cx:8.5,cy:7,r:4}),a.createElement("polyline",{points:"17 11 19 13 23 9"}));function De(){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("line",{x1:"9",y1:"9",x2:"15",y2:"15"}),e.jsx("line",{x1:"15",y1:"9",x2:"9",y2:"15"})]})}const Fe="_sidebar_filters_fhqor_45",Re="_filter_group_fhqor_45",Ee="_group_title_fhqor_48",Ae="_add_filter_fhqor_55",qe="_choose_filter_fhqor_79",Me="_filter_fhqor_45",Oe="_remove_fhqor_86",$={sidebar_filters:Fe,filter_group:Re,group_title:Ee,add_filter:Ae,choose_filter:qe,filter:Me,"input-select":"_input-select_fhqor_83",remove:Oe};function Be({filters:t,onChange:s,options:i,dateRange:n=!0}){const[r,l]=a.useState([]),[m,o]=a.useState(!0),[c,j]=a.useState(!1),[_,b]=a.useState(null),[k,f]=a.useState(null),[d,y]=a.useState([]);a.useEffect(()=>{const v=t.filter(u=>u.type!=="period").map(u=>u.type).filter(u=>u!=="unknown"),g=v.length===i.length;l(v),o(!g&&!t.find(u=>!u.value))},[t,i,n]),a.useEffect(()=>{y(t.filter(v=>!!v.value))},[t]);const C=()=>{s([...t,{type:"unknown"}]),o(!1)},N=v=>{let g=!1;const u=v.filter(S=>S.value&&S.type!=="unknown").map(S=>S.type);for(let S of u)if(i.find(P=>P.type===S&&P.incompatibleWith.includes("period"))){g=!0;break}return g&&(b(null),f(null)),j(g),g},p=(v,g)=>{let u=[...t];if(u[g]=v,v.value){const P=i.find(D=>D.type===v.type);P.incompatibleWith&&(u=u.filter(D=>!P.incompatibleWith.includes(D.type)))}N(u)&&(u=u.filter(P=>P.type!=="period")),s(u)},T=v=>{let g=t.filter((u,S)=>S!==v);N(g),s(g)},x=(v,g)=>{b(v),f(g);let u=[...t.filter(S=>S.type!=="period"),{type:"period",value:[v,g]}];s(u)};return e.jsxs("div",{className:`${$.sidebar_filters}`,children:[n&&e.jsxs("div",{className:`${$.filter_group}`,children:[e.jsx("div",{className:`${$.group_title}`,children:"Período"}),e.jsx(We,{disabled:c,startDate:_,endDate:k,onChange:x,className:"input-datepicker"})]}),e.jsxs("div",{className:`${$.filter_group}`,children:[e.jsx("div",{className:`${$.group_title}`,children:"Filtros"}),t.map((v,g)=>v.type==="period"?null:e.jsxs("div",{children:[g>0&&e.jsx("hr",{className:"hr-spacer"}),e.jsx(Ie,{onFilterChange:u=>p(u,g),onRemove:()=>T(g),options:i,usedOptions:r,filters:d,...v})]},v.type)),m&&t.length>0&&e.jsx("hr",{className:"hr-spacer"}),m&&e.jsx(Ye,{onClick:C})]})]})}function Ie({options:t,filters:s,usedOptions:i,type:n,value:r,onFilterChange:l,onRemove:m}){const[o,c]=a.useState("unknown");a.useEffect(()=>{n&&c(n)},[n]);let j=null,_={};const b=t.find(d=>d.type===o);b&&b.chooser&&(j=b.chooser,b.chooserProps&&(_=b.chooserProps));const k=d=>{c(d.target.value);const y=t.find(N=>N.type===d.target.value);let C=null;y&&!y.chooser&&(C=!0),l({type:d.target.value,value:C})},f=d=>{l({type:o,value:d})};return e.jsxs("div",{className:`${$.choose_filter}`,children:[e.jsxs("div",{className:`${$.filter}`,children:[e.jsxs(re,{className:"input-select",fullWidth:!0,value:o,onChange:k,children:[e.jsx(R,{value:"unknown",children:"escolha um filtro"}),t==null?void 0:t.filter(d=>!i.includes(d.type)||d.type===n).map(d=>e.jsx(R,{value:d.type,children:d.title},d.type))]}),e.jsx("div",{className:`${$.remove}`,onClick:m,children:e.jsx(De,{})})]}),!!j&&e.jsx("div",{className:`${$.filter_option}`,children:e.jsx(j,{onChange:f,..._,filters:s,value:r})})]})}function Ye({onClick:t}){return e.jsxs("div",{className:`${$.add_filter}`,onClick:t,children:[e.jsx("div",{children:"filtrar por"}),e.jsx(oe,{})]})}function We({disabled:t=!1,startDate:s,endDate:i,onChange:n}){const[r,l]=a.useState(null),[m,o]=a.useState(null);return a.useEffect(()=>{l(s)},[s]),a.useEffect(()=>{o(i)},[i]),e.jsxs("div",{className:"input-daterangepicker",children:[e.jsx(ae,{value:r,onChange:c=>n(c,m),disabled:t,clearable:!0,clearText:"remover"}),e.jsx("div",{}),e.jsx(ae,{value:m,onChange:c=>n(r,c),minDate:r,disabled:t,clearable:!0,clearText:"remover",onError:c=>{c==="minDate"&&o(null)}})]})}const Le=t=>{let s=[];for(let i of t)if(i.type==="period"){const[n,r]=i.value;n&&s.push(`ini_date=${H(n).format("YYYY-MM-DD")}`),r&&s.push(`end_date=${H(r).format("YYYY-MM-DD")}`)}else i.value&&s.push(`${i.type}=${i.value}`);return s.length?`&${s.join("&")}`:""};function ze({value:t,onChange:s}){const i=n=>{s(n)};return e.jsx(de,{fullWidth:!0,children:e.jsxs(re,{className:"input-select",value:t||"none",onChange:n=>i(n.target.value),children:[e.jsx(R,{value:"none",children:" -- selecione -- "}),e.jsx(R,{value:"adm",children:"Responsável"}),e.jsx(R,{value:"member",children:"Membro"})]})})}const Qe=[{title:"por responsab.",type:"participation_type",chooser:ze,incompatibleWith:[]}],He=()=>{const{server:t}=B(),{currentCommunity:s}=I(),i=Y(),{enqueueSnackbar:n,closeSnackbar:r}=G(),[l,m]=a.useState(1),[o,c]=a.useState("createdAt"),[j,_]=a.useState("asc"),[b,k]=a.useState(10),[f,d]=a.useState(null),[y,C]=a.useState(null),[N,p]=a.useState([]),[T,x]=a.useState(""),{data:v}=U(["participation_list",{community:s.id,page:l,order:o,direction:j,perPage:b,urlFilters:T}],{queryFn:async()=>(await w.get(`${t}gt/${s.id}/participation/?page=${l}&order=${o}&direction=${j==="asc"?"desc":"asc"}&limit=${b}${T}`)).data}),g={remove:E(h=>w.delete(`${t}gt/${s.id}/participation/${h.id}`),{onSuccess:()=>i.invalidateQueries("participation_list")}),approve:E(h=>w.put(`${t}gt/${s.id}/participation/${h.id}`),{onSuccess:()=>i.invalidateQueries("participation_list")})};a.useEffect(()=>{N&&(x(Le(N)),m(1),c("createdAt"),_("asc"))},[N]);const u=h=>{m(1),o===h?_(j==="asc"?"desc":"asc"):(c(h),_("desc"))},S=h=>{C(h)},P=async h=>{h==="confirm"&&await g.remove.mutateAsync(y),C(null)},D=h=>{d(h)},le=async h=>{if(h==="confirm"){const se=n("Aprovando a solicitação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{await g.approve.mutateAsync(f),r(se),n("Solicitação aprovada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(ce){r(se),console.error(ce),n("Erro ao aprovar a solicitação!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}}d(null)};return e.jsxs("div",{className:"page-content mb-5",children:[e.jsx("div",{className:"page-sidebar sticky",children:e.jsx("div",{className:"sidebar-body",children:e.jsx(Be,{filters:N,options:Qe,onChange:p})})}),e.jsxs("div",{className:"page-body",children:[v&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"tablebox",children:e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(F,{text:"ID",column:"id",order:o,direction:j,onClick:u})}),e.jsx("th",{children:e.jsx(F,{text:"Data de solicitação",column:"createdAt",order:o,direction:j,onClick:u})}),e.jsx("th",{children:e.jsx(F,{text:"Nome",column:"name",order:o,direction:j,onClick:u})}),s.alias==="adm"&&e.jsx("th",{children:e.jsx(F,{text:"Grupo de trabalho",column:"community_name",order:o,direction:j,onClick:u})}),e.jsx("th",{children:e.jsx(F,{text:"Responsável",column:"adm",order:o,direction:j,onClick:u})}),e.jsx("th",{children:"Ações"})]})}),e.jsx(X,{children:v.entities.map(h=>e.jsxs(Ue,{children:[e.jsxs("td",{children:["#",h.id]}),e.jsx("td",{children:H(h.createdAt).format("DD/MM/YYYY")}),e.jsx("td",{children:h.name}),s.alias==="adm"&&e.jsx("td",{children:h.community_name}),e.jsx("td",{children:h.adm?"sim":"não"}),e.jsxs("td",{className:"tbox-table-actions",children:[e.jsx("div",{children:e.jsx(A,{title:"Aprovar",children:e.jsx(q,{onClick:()=>D(h),children:e.jsx(Te,{})})})}),e.jsx("div",{children:e.jsx(A,{title:"Remover",children:e.jsx(q,{onClick:()=>S(h),children:e.jsx(K,{})})})})]})]},h.id))})]})})}),e.jsx(Z,{className:"pagination",component:"div",count:v.total,page:l-1,onPageChange:(...h)=>m(h[1]+1),rowsPerPage:b,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:h=>{k(h.target.value),m(1)}})]}),e.jsx(ee,{display:"flex",justifyContent:"space-between"}),e.jsx(O,{open:!!y,content:"Confirma a remoção desta solicitação?",confirmButtonText:"Remover",onClose:P}),e.jsx(O,{open:!!f,content:"Confirma a aprovação desta solicitação?",confirmButtonText:"Aprovar",onClose:le})]})]})};function F({text:t,column:s,order:i,direction:n,enabled:r=!0,onClick:l}){return e.jsxs(e.Fragment,{children:[!r&&e.jsx(e.Fragment,{children:t}),r&&e.jsx(te,{className:"tbox-table-sortlabel",active:i===s,direction:n,onClick:()=>l(s),children:t})]})}const Ue=V(J)({"&:last-child td, &:last-child th":{border:0}}),Ke=He;function it(){const{changeRoute:t,params:s,currentCommunity:i}=I(),{server:n}=B(),{enqueueSnackbar:r,closeSnackbar:l}=G(),m=Y(),[o,c]=a.useState(null),[j,_]=a.useState(!1),b={invite:E(f=>w.post(`${n}gt/${i.id}/membership`,f),{onSuccess:()=>m.invalidateQueries("invites_list")})};a.useEffect(()=>{c(s&&s.length?s[0]:"lista")},[s]);const k=async(f,d)=>{if(!f||!f.length||!d||!d.length)return;const y=r("Enviando o convite..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{await b.invite.mutateAsync({name:f,email:d}),l(y),r("Convite enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),_(!1),t({params:["convites"]})}catch(C){l(y),console.error(C),r("Erro ao enviar o convite!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(ue,{title:"Membros"}),e.jsx("div",{className:"page-header-buttons",children:e.jsxs("button",{className:"button-primary",onClick:()=>_(!0),children:[e.jsx(oe,{}),"Convidar"]})})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(ye,{defaultTab:o,onTabChange:f=>t({params:[f]})}),o==="lista"&&e.jsx(Ne,{}),o==="convites"&&e.jsx(we,{}),o==="solicitacoes"&&e.jsx(Ke,{})]}),e.jsx(Ve,{open:j,onCreate:k,onClose:()=>_(!1)})]})}function Ve({open:t,onCreate:s,onClose:i}){const[n,r]=a.useState(""),[l,m]=a.useState("");a.useEffect(()=>{t&&(r(""),m(""))},[t]);const o=c=>{m(c.target.value.trim().toLowerCase())};return e.jsx("div",{children:e.jsxs(he,{open:t,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(me,{id:"alert-dialog-title",children:"Enviar um convite"}),e.jsxs(pe,{children:[e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(ne,{className:"input-text",label:"Nome",value:n,onChange:c=>r(c.target.value)})})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(ne,{className:"input-text",label:"E-mail",value:l,onChange:o})})})]}),e.jsxs(xe,{children:[e.jsx(ve,{onClick:()=>i(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>s(n,l),children:"Criar"})]})]})})}export{it as default};
