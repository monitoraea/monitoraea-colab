import{u as O,b as B,d as w,c as R,r as s,e as L,f as Q,j as e,P as K,q as V,n as j,D as W,k as H,l as M,T as U,m as G,B as J}from"./index-DLt25zcS.js";import{r as S}from"./index-DQ24o8Cs.js";import{S as X}from"./Search-BuC3Vl68.js";import{B as Y}from"./Box-BoG2D6P7.js";import{T as Z}from"./TableSortLabel-BadkXaU-.js";const ee="_commission_list_1rasy_1",ae="_commission_1rasy_1",te="_name_1rasy_8",se="_actions_1rasy_11",ie="_sent_1rasy_19",re="_action_1rasy_11",d={commission_list:ee,commission:ae,name:te,actions:se,sent:ie,action:re};let _;function he(){const{server:i}=O(),{changeRoute:c}=B(),o=w(),{enqueueSnackbar:t,closeSnackbar:r}=R(),u=V,m=s.useRef(null),[k,F]=s.useState(""),[p,I]=s.useState(""),[x,P]=s.useState("name"),[h,f]=s.useState("asc"),[$,D]=s.useState(0),[y,E]=s.useState(null),[N,v]=s.useState(!1),{data:g}=L(["user_policies_list",{order:x,direction:h}],{queryFn:async()=>(await j.get(`${i}ppea/mine?direction=${h}`)).data});s.useEffect(()=>{if(!g)return;let a=[...g.entities];p.trim().length&&(a=a.filter(n=>S(n.name.toLowerCase()).includes(S(p.trim().toLocaleLowerCase())))),D(a.length),E(a)},[g,p]);const T={create:Q(a=>j.post(`${i}ppea`,{nome:a}),{onSuccess:()=>{o.invalidateQueries("user_policies_list")}})},q=a=>{x===a?f(h==="asc"?"desc":"asc"):(P(a),f("desc"))},C=async(a,n)=>{const l=t("Enviando pedido de participação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{data:b}=await j.post(`${i}ppea/${n}/participate`,{isADM:a});r(l),b.success?(t("Seu pedido de participação foi enviado! Uma notificação será enviada, no momento da aprovação",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),o.invalidateQueries("user_policies_list")):b.error==="already_member"?t("Você já é membro deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):b.error==="already_in_list"?t("Você já está na lista de aprovação deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):t("Erro ao enviar seu pedido de participação! Por favor, entre em contato com a administração",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})},z=a=>{F(a.target.value),_&&clearTimeout(_),_=setTimeout(()=>I(a.target.value),500)},A=async a=>{if(!a||!a.length)return;const n=t("Criando a iniciativa..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:l}=await T.create.mutateAsync(a);r(n),t("Iniciativa gravada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),v(!1),window.location=`/colabora/politica/${l.communityId}`}catch(l){r(n),console.error(l),t("Erro ao gravar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page width-limiter tbox-fixed",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(K,{title:"Políticas ("+$+")"}),e.jsx("div",{className:"page-header-buttons",children:e.jsx("button",{className:"button-primary",onClick:()=>v(!0),children:"Nova política"})})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"tablebox limit-height",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(u,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx(X,{onClick:()=>{var a;return(a=m.current)==null?void 0:a.focus()}}),inputRef:m,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:k,onChange:z})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(oe,{text:"Políticas",column:"name",order:x,direction:h,onClick:q})}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:y&&y.map(a=>e.jsxs("tr",{className:"tbox-row",children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:`tbox-table-actions ${d.actions}`,children:[a.is_requesting&&e.jsx("div",{className:d.sent,children:"Solicitação enviada"}),!a.is_requesting&&e.jsxs(e.Fragment,{children:[a.is_member&&e.jsx(e.Fragment,{children:e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>c({community:a.community_id}),children:"Acessar"})}),!a.is_member&&e.jsxs(e.Fragment,{children:[!a.has_members&&e.jsx("button",{className:`button-outline ${d.action}`,onClick:()=>C(!0,a.id),children:"sou o responsável"}),e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>C(!1,a.id),children:"colaborar"})]})]})]})]},a.id))})]})})]})})}),e.jsx(Y,{display:"flex",justifyContent:"space-between"})]}),e.jsx(ne,{open:!!N,type:N,onCreate:A,onClose:()=>v(!1)})]})}function oe({text:i,column:c,order:o,direction:t,onClick:r}){return e.jsx(e.Fragment,{children:e.jsx(Z,{className:"tbox-table-sortlabel",active:o===c,direction:t==="desc"?"asc":"desc",onClick:()=>r(c),children:i})})}function ne({open:i,type:c,onCreate:o,onClose:t}){const[r,u]=s.useState("");return s.useEffect(()=>{i&&u("")},[i]),e.jsx("div",{children:e.jsxs(W,{open:i,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(H,{id:"alert-dialog-title",children:"Nova iniciativa de PPEA"}),e.jsx(M,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(U,{className:"input-text",label:"Nome da nova iniciativa",value:r,onChange:m=>u(m.target.value)})})})}),e.jsxs(G,{children:[e.jsx(J,{onClick:()=>t(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>o(r),children:"Criar"})]})]})})}export{he as default};
