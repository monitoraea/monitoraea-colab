import{r as t,j as e,u as R,a as U,d as P,c as B,e as T,C as A,v as H,J,K as W,L as X,N as Z,O as ee,n as C,b as te,Q as M,f as ae,x as be,w as fe,U as ve,T as ge,P as xe,D as ke,k as je,l as Y,m as ze,B as we}from"./index-DLt25zcS.js";import{T as Ne,a as Q}from"./Tabs-BURW5nwB.js";import{C as se}from"./index-Bha5MrYE.js";import{E as Ce}from"./CheckCircle-DswnPI8a.js";import{i as $e,g as Se,a as qe,b as Ee,c as Oe,d as Te,E as Fe}from"./indicsTree-CbQzdjjY.js";import{n as De,S as Ae,a as Re,b as Me,c as Pe}from"./no_thumb-BtmO3-w3.js";import{P as Be}from"./plus-B_5SJsXG.js";import{B as Ie}from"./Box-BoG2D6P7.js";import"./KeyboardArrowRight-B-_qEmRL.js";const We="_backdrop_z4t2t_52",Qe="_indicator_z4t2t_85",Ge="_warning_z4t2t_106",He="_ready_z4t2t_109",Ue="_divisor_z4t2t_146",Ke="_cleanfilters_z4t2t_152",O={"projects-tabs":"_projects-tabs_z4t2t_45",backdrop:We,"ptabs-content":"_ptabs-content_z4t2t_72","ptabs-tabs":"_ptabs-tabs_z4t2t_79",indicator:Qe,"fixed-size":"_fixed-size_z4t2t_85","not-ready":"_not-ready_z4t2t_103",warning:Ge,ready:He,"ptabs-actions":"_ptabs-actions_z4t2t_119","ptabs-datefilter":"_ptabs-datefilter_z4t2t_124","ptabs-datefilter-button":"_ptabs-datefilter-button_z4t2t_134",divisor:Ue,cleanfilters:Ke};function Ye({defaultTab:s,onTabChange:c,analysis:r}){const[_,k]=t.useState(!1),[v,p]=t.useState(0),f=u=>{c(u.target.id)};return t.useEffect(()=>{if(!r)return;let u=0;(Object.filter=(d,i)=>Object.keys(d).filter(m=>(i(d[m])&&u++,i(d[m]))).reduce((m,o)=>(m[o]=d[o],m),{}))(r.analysis.indics,d=>d.ready===!1),p(u),k(Object.values(r.analysis.indics).reduce((d,i)=>i.ready?d:!1,!0))},[r]),e.jsxs("div",{className:O["projects-tabs"],children:[e.jsx("div",{className:O.backdrop}),e.jsx("div",{className:O["ptabs-content"],children:e.jsxs(Ne,{className:O["ptabs-tabs"],onChange:f,value:s,children:[e.jsx(Q,{disableRipple:!0,label:"Cadastro",...G("informacao")}),e.jsx(Q,{disableRipple:!0,label:"Indicadores",...G("indicadores",v>0?v:""),className:`${O.indicator} ${_?O.ready:O["not-ready"]} ${v<10&&O["fixed-size"]}`}),e.jsx(Q,{disableRipple:!0,label:"Linha do tempo",...G("linha_tempo")})]})})]})}function G(s,c=""){return{id:s,"aria-controls":`simple-tabpanel-${s}`,value:s,"data-problems":c}}const Le=[{type:"row",block:"detalhes",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"tipo_colegiado"},{type:"column",size:6,key:"tipo_colegiado_outro"}]},{type:"row",elements:[{type:"column",size:6,key:"nivel_atuacao"},{type:"column",size:6,key:"nivel_atuacao_outro"}]}]}]},{type:"separator"},{type:"row",block:"detalhes2",elements:[{type:"row",elements:[{type:"column",size:2,key:"logo_arquivo"}]},{type:"row",elements:[{type:"column",size:3,key:"uf_nome"},{type:"column",size:3,key:"regiao"},{type:"column",size:3,key:"data_criacao"},{type:"column",size:3,key:"ativo"}]},{type:"row",elements:[{type:"column",size:12,key:"link"}]}]},{type:"separator"},{type:"row",block:"documento",elements:[{type:"row",elements:[{type:"column",size:12,key:"documento_criacao"},{type:"column",size:2,key:"documento_criacao_tipo"},{type:"column",size:6,key:"documento_criacao_arquivo"},{type:"column",size:6,key:"documento_criacao_arquivo2"}]}]},{type:"separator"},{type:"row",block:"composicao",elements:[{type:"row",elements:[{type:"column",size:3,key:"composicao_cadeiras_set_pub"},{type:"column",size:3,key:"composicao_cadeiras_soc_civ"}]},{type:"row",block:"composicao_cadeiras_outros",elements:[{type:"column",size:3,key:"setor"},{type:"column",size:3,key:"cadeiras"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"composicao_cadeiras_outros",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar setor"}]}]}]}]},{type:"separator"},{type:"row",block:"coordenacao_block",elements:[{type:"column",size:6,key:"coordenacao"},{type:"column",size:6,key:"coordenacao_especifique"}]},{type:"separator"},{type:"row",block:"coordenacao_quem_block",elements:[{type:"row",block:"coordenacao_quem",elements:[{type:"column",size:3,key:"nome"},{type:"column",size:2,key:"email"},{type:"column",size:2,key:"telefone"},{type:"column",size:2,key:"mandato_ini"},{type:"column",size:2,key:"mandato_fim"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"coordenacao_quem",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar coordenador"}]}]}]}]},{type:"separator"},{type:"row",block:"regimento_interno_block",elements:[{type:"column",size:6,key:"regimento_interno_tem"},{type:"column",size:6,key:"regimento_interno"}]},{type:"row",block:"regimento_interno_tem_block",elements:[{type:"column",size:6,key:"regimento_interno_tipo"},{type:"column",size:6,key:"regimento_interno_arquivo"},{type:"column",size:6,key:"regimento_interno_arquivo2"}]},{type:"row",block:"organizacao_interna",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"org_interna_periodicidade"},{type:"column",size:6,key:"organizacao_interna_periodicidade_especifique"}]},{type:"row",elements:[{type:"column",size:6,key:"organizacao_interna_estrutura_tem"},{type:"column",size:6,key:"organizacao_interna_estrutura_especifique"}]}]}]},{type:"separator"},{type:"row",block:"ppea_block",elements:[{type:"column",size:4,key:"ppea_tem"}]},{type:"row",block:"ppea_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea_tipo"},{type:"column",size:6,key:"ppea_arquivo"},{type:"column",size:6,key:"ppea_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea_decreto"},{type:"column",size:3,key:"ppea_lei"}]}]}]},{type:"row",block:"programa_estadual_block",elements:[{type:"column",size:4,key:"programa_estadual_tem"}]},{type:"row",block:"programa_estadual_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"programa_estadual_tipo"},{type:"column",size:6,key:"programa_estadual_arquivo"},{type:"column",size:6,key:"programa_estadual_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"programa_estadual_decreto"},{type:"column",size:3,key:"programa_estadual_lei"}]}]}]},{type:"row",block:"plano_estadual_block",elements:[{type:"column",size:4,key:"plano_estadual_tem"}]},{type:"row",block:"plano_estadual_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"plano_estadual_tipo"},{type:"column",size:6,key:"plano_estadual_arquivo"},{type:"column",size:6,key:"plano_estadual_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"plano_estadual_decreto"},{type:"column",size:3,key:"plano_estadual_lei"}]}]}]},{type:"row",block:"ppea_outra_block",elements:[{type:"column",size:4,key:"ppea_outra_tem"}]},{type:"row",block:"ppea_outra_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea_outra_tipo"},{type:"column",size:6,key:"ppea_outra_arquivo"},{type:"column",size:6,key:"ppea_outra_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea_outra_decreto"},{type:"column",size:3,key:"ppea_outra_lei"}]}]}]},{type:"row",block:"ppea2_block",elements:[{type:"column",size:4,key:"ppea2_tem"}]},{type:"row",block:"ppea2_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea2_tipo"},{type:"column",size:6,key:"ppea2_arquivo"},{type:"column",size:6,key:"ppea2_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea2_decreto"},{type:"column",size:3,key:"ppea2_lei"}]}]}]}],Ve={lists:[{key:"sim_nao",options:[{value:!0,label:"Sim"},{value:!1,label:"Não"}]},{key:"tipo_arquivo",options:[{value:"link",label:"Link"},{value:"file",label:"Arquivo"}]},{key:"tipo_coordenacao",options:[{value:1,label:"Secretarias Estaduais de Meio Ambiente (ou correlatas) e de Educação"},{value:2,label:"Apenas Secretaria de Estado de Meio Ambiente (ou correlatas)"},{value:3,label:"Apenas Secretaria de Estado de Educação"},{value:4,label:"Outra Pasta do Estado"},{value:5,label:"Instituição da Sociedade Civil"},{value:6,label:"Instituição de outro segmento"},{value:7,label:"Outro"}]},{key:"tipo_colegiado",options:[{value:1,label:"Comitê assessor da PNEA"},{value:2,label:"CIEA"},{value:3,label:"CIMEA"},{value:4,label:"Câmara Técnica de EA em Conselho de Política Pública"},{value:5,label:"Câmara Técnica de EA em Conselho Gestor de UC"},{value:6,label:"Câmara Técnica de EA em Comitê de Bacia Hidrográfica"},{value:7,label:"Outro"}]},{key:"nivel_atuacao",options:[{value:1,label:"Federal"},{value:2,label:"Regional"},{value:3,label:"Municipal"},{value:4,label:"Outro"}]}]};function Je({entityId:s}){const{server:c}=R(),{user:r}=U(),_=P(),{enqueueSnackbar:k,closeSnackbar:v}=B(),[p,f]=t.useState({}),[u,z]=t.useState({}),[d,i]=t.useState({}),{data:m}=T(["commission_info",{entityId:s}],{queryFn:async()=>(await C.get(`${c}commission/${s}/draft`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:o}=T(["content_for_form_cad"],{queryFn:async()=>(await C.get(`${c}content/for_form/ciea/ciea/info`)).data,retry:!1,refetchOnWindowFocus:!1});t.useEffect(()=>{m&&i(m)},[m]);const $=(l,y)=>{f(l),z(y)},w=async()=>{const l=ee(W,p,u),y=k("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let x,j;x="put",j=`${c}commission/${s}/draft`,await C({method:x,url:j,data:l,config:{headers:{"Content-Type":"multipart/form-data"}}}),_.invalidateQueries("commission_info"),v(y),k("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(x){v(y),console.error(x),k("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return m?e.jsx(e.Fragment,{children:p&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(A,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:w,children:[e.jsx(H,{}),"Gravar"]})})]}),e.jsx(J,{form:W,view:Le,lists:Ve,data:X(d,W),onDataChange:$,helpbox:{isADM:r.membership.find(l=>l.id===Z),content:o,prefix:"ciea.",type:"info"}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:w,children:[e.jsx(H,{}),"Gravar"]})})]})]})})})})}):e.jsx(e.Fragment,{})}const Xe="_error_y2a6h_45",Ze="_done_y2a6h_50",et="_indic_y2a6h_55",tt="_selected_y2a6h_59",at="_field_y2a6h_63",st="_title_box_y2a6h_66",ot="_tree_y2a6h_81",it="_li_lae_titles_y2a6h_92",nt="_show_y2a6h_96",rt="_fade_in_show_y2a6h_1",lt="_hide_y2a6h_111",ct="_li_indicators_y2a6h_114",dt="_strong_y2a6h_125",mt="_actions_y2a6h_151",ut="_helpbox_button_y2a6h_157",pt="_button_delete_y2a6h_164",_t="_Roll_y2a6h_1",S={error:Xe,done:Ze,indic:et,selected:tt,field:at,title_box:st,tree:ot,li_lae_titles:it,show:nt,fade_in_show:rt,hide:lt,li_indicators:ct,"item-container":"_item-container_y2a6h_118",strong:dt,"indic-header":"_indic-header_y2a6h_137",actions:mt,helpbox_button:ut,button_delete:pt,Roll:_t};function yt({entityId:s,analysis:c,problems:r}){const{server:_}=R(),{currentCommunity:k,changeRoute:v,params:p}=te(),{user:f}=U(),u=P(),{enqueueSnackbar:z,closeSnackbar:d}=B(),[i,m]=t.useState(null),[o,$]=t.useState(null),[w,l]=t.useState(null),[y,x]=t.useState(null),[j,a]=t.useState(null),[h,g]=t.useState(!1),[E,I]=t.useState(null),[oe,ie]=t.useState([]),[ne,re]=t.useState([]),[le,ce]=t.useState({}),[de,K]=t.useState({}),{data:F}=T([`iniciative_info_${o}`,{entityId:s}],{queryFn:async()=>(await C.get(`${_}commission/${s}/draft/indicadores/${o}`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1}),{data:me}=T([`content_for_form_${o}`],{queryFn:async()=>(await C.get(`${_}content/for_form/ciea/${o}/indic`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1});t.useEffect(()=>{F&&K(F)},[F]),t.useEffect(()=>{c&&m($e(c))},[c]),t.useEffect(()=>{ie(r)},[r]),t.useEffect(()=>{p&&p[1]?$(p[1]):$("1_1")},[p]),t.useEffect(()=>{if(o&&F){const n=o.split("_")[0];l(n);const N=i.find(D=>D.id===n).indics.find(D=>D.id===o);I(Se(M,n,N.id))}},[o,F]);const ue=n=>{x(y!==n?n:null)},pe=(n,q)=>()=>{K({}),x(q),h?a(n):v({params:["indicadores",n]})},_e=async n=>{n==="confirm"&&v({params:["indicadores",j]}),a(null)},ye=(n,q)=>{re(n),ce(q)},he=async()=>{const n=ee(E,ne,le);n.set("indic",o);const q=z("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let N,D;N="put",D=`${_}commission/${s}/draft/indicadores/${o}`,await C({method:N,url:D,data:n,config:{headers:{"Content-Type":"multipart/form-data"}}}),u.invalidateQueries(`ciea_info_${o}`),u.invalidateQueries("ciea_analysis"),d(q),z("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(N){d(q),console.error(N),z("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return F?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-content",children:[e.jsx("div",{className:"page-sidebar",children:e.jsx("div",{className:`sidebar-body ${S.tree}`,children:i&&e.jsx("ul",{children:i.map(n=>{let q=qe(M,n.id);return e.jsx(t.Fragment,{children:q&&e.jsxs("li",{className:`mb-3 ${S.li_lae_titles}`,onClick:()=>ue(n.id),children:[e.jsx(L,{title:Ee(M,n.id),ready:n.ready,className:w===n.id||y===n.id?S.strong:""}),e.jsx("ul",{className:`${w===n.id||y===n.id?S.show:S.hide}`,children:n.indics.map(N=>e.jsx("li",{className:`${S.li_indicators}`,onClick:pe(N.id,n.id),children:e.jsx(L,{title:Oe(M,n.id,N.id),ready:N.ready,className:`${S.indic} ${o===N.id?S.selected:""}`})},N.id))})]})},n.id)})})})}),e.jsx("div",{className:"page-body",children:e.jsx(A,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[!!E&&e.jsx(J,{form:E,data:X(de,E),problems:Te(o,oe),onDataChange:ye,helpbox:{isADM:f.membership.find(n=>n.id===Z),content:me,prefix:`ciea.${o.split("_")[0]}.${o}.`}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:he,children:[e.jsx(H,{}),"Gravar"]})})]})]})})})]}),e.jsx(se,{open:!!j,content:"Você deseja sair do indicador sem salvar as alterações?",confirmButtonText:"Confirmar",onClose:_e})]}):e.jsx(e.Fragment,{})}function L({title:s,ready:c,className:r}){let _=c?e.jsx(Ce,{}):e.jsx(Fe,{});return e.jsxs("div",{className:`${S["item-container"]} ${r}`,children:[e.jsx("div",{className:`${S[c?"done":"error"]}`,children:_}),e.jsx("div",{children:s})]})}const ht="_vcentered_1g64r_1",bt="_add_1g64r_6",ft="_action_1g64r_7",vt="_timeline_1g64r_33",gt="_highlight_1g64r_36",xt="_each_1g64r_40",kt="_date_1g64r_49",jt="_text_1g64r_52",zt="_thumb_1g64r_58",wt="_buttons_1g64r_81",Nt="_editing_1g64r_86",b={vcentered:ht,add:bt,action:ft,timeline:vt,highlight:gt,each:xt,date:kt,text:jt,thumb:zt,"thumb-image":"_thumb-image_1g64r_62",buttons:wt,editing:Nt,"edit-buttons":"_edit-buttons_1g64r_92"};function Ct({entityId:s}){const{server:c}=R(),r=P(),[_,k]=t.useState([]),[v,p]=t.useState(null),[f,u]=t.useState(null),[z,d]=t.useState(null),[i,m]=t.useState(null),{data:o}=T(["commission_timeline",{entityId:s}],{queryFn:async()=>(await C.get(`${c}commission/${s}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),$=ae(a=>C.delete(`${c}commission/${s}/draft/timeline/${a}`),{onSuccess:()=>r.invalidateQueries("commission_timeline")});t.useEffect(()=>{o&&k(o)},[o]),t.useEffect(()=>{f&&setTimeout(()=>{const a=document.getElementById(`timeline_${f}`);a&&(a.scrollIntoView({block:"end",inline:"nearest"}),d(f),u(null),setTimeout(()=>d(null),2e3))},10)},[_,f]);const w=a=>()=>{p(a)},l=a=>()=>{const h=_.find(g=>g.id===a);h&&m(h)},y=async a=>{a==="confirm"&&await $.mutateAsync(v),p(null)},x=()=>{m(null)},j=()=>{m(null)};return e.jsx(e.Fragment,{children:_&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(A,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsxs("section",{id:"details",children:["A linha do tempo é uma ferramenta para a apresentação e o registro dos principais marcos/eventos da iniciativa. Insira o mês/ano em que o marco/evento aconteceu, uma imagem ilustrativa (pode ser uma fotografia real ou um ícone/desenho) e um texto descritivo. A ferramenta organiza automaticamente a apresentação dos marcos/eventos em ordem cronológica.",e.jsx("br",{}),"Alguns exemplos de marcos/eventos: criação da iniciativa, realização de atividades relevantes, eventos públicos, publicação de normativas, relatórios, materiais educomunicativos, etc."]})})}),e.jsx(A,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${b["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(V,{entityId:s,editing:i,onHighlight:u,add:!0,onSave:j})})})}),e.jsx(A,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:b.timeline,children:!!o&&_.map(a=>e.jsxs(t.Fragment,{children:[(i==null?void 0:i.id)!==a.id&&e.jsxs("div",{id:`timeline_${a.id}`,className:`${b.each} ${z===a.id?b.highlight:""}`,children:[e.jsxs("div",{className:b.date,children:[" ",e.jsx("span",{className:b.text,children:be(a.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:b.thumb,children:e.jsxs("div",{className:b["thumb-image"],children:[!!a.timeline_arquivo&&e.jsx("img",{src:a.timeline_arquivo,alt:"imagem de timeline"}),!a.timeline_arquivo&&e.jsx("img",{src:De,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:b.text,children:a.texto}),e.jsxs("div",{className:b.buttons,children:[e.jsx("button",{className:b.action,onClick:l(a.id),disabled:!!i,children:e.jsx(Ae,{})}),(i==null?void 0:i.id)!==a.id&&e.jsx("button",{className:b.action,onClick:w(a.id),disabled:!!i,children:e.jsx(Re,{})})]})]}),(i==null?void 0:i.id)===a.id&&e.jsx(V,{entityId:s,editing:i,onHighlight:u,onCancel:x,onSave:j})]},a.id))})})})})]}),e.jsx(se,{open:!!v,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:y})]})})}function V({add:s,entityId:c,editing:r,onHighlight:_,onCancel:k,onSave:v}){const{enqueueSnackbar:p,closeSnackbar:f}=B(),{server:u}=R(),z=P(),[d,i]=t.useState(new Date),[m,o]=t.useState(null),[$,w]=t.useState(null),[l,y]=t.useState(null);t.useEffect(()=>{s?(i(new Date),y(null)):(i(r.date),y(r.texto),o({url:r.timeline_arquivo}))},[r]);const x=a=>{o(a||"remove"),w(a==null?void 0:a.file)},j=async()=>{if(!l||!l.length)return;let a=new FormData;$&&a.append("imagem",$);const h=p("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let g,E;s?(g="post",E=`${u}commission/${c}/draft/timeline`):(g="put",E=`${u}commission/${c}/draft/timeline/${r.id}`),a.set("entity",JSON.stringify({date:d,texto:l,timeline_arquivo:m}));const{data:I}=await C({method:g,url:E,data:a,config:{headers:{"Content-Type":"multipart/form-data"}}});_(I.id),i(new Date),y(null),o(null),w(null),v(),z.invalidateQueries("commission_timeline"),f(h),p("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(g){f(h),console.error(g),p("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!s&&r?b.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${b.vcentered}`,children:e.jsx(fe,{className:"input-datepicker",label:"Mês",value:d||"",onChange:i,views:["month","year"],inputFormat:"MM/yyyy",disabled:s&&!!r})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(ve,{onChange:x,url:m==null?void 0:m.url,alt:"imagem",title:"Imagem",disabled:s&&!!r,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(ge,{className:"input-text",label:"Texto",value:l||"",onChange:a=>y(a.target.value),multiline:!0,rows:4,disabled:s&&!!r})}),e.jsxs("div",{className:`col-xs-1 ${b.vcentered}`,children:[s&&e.jsx("button",{className:b.add,onClick:j,disabled:s&&!!r,children:e.jsx(Be,{})}),!s&&e.jsxs("div",{className:b["edit-buttons"],children:[e.jsx("button",{className:b.add,onClick:j,children:e.jsx(Me,{})}),e.jsx("button",{className:b.add,onClick:k,children:e.jsx(Pe,{})})]})]})]})}const $t="_button_delete_11779_45",St="_Roll_11779_1",qt="_term_11779_82",Et={button_delete:$t,Roll:St,term:qt},Wt=()=>{const{currentCommunity:s,changeRoute:c,params:r}=te(),{server:_}=R(),{user:k,updateUser:v}=U(),{enqueueSnackbar:p,closeSnackbar:f}=B(),[u,z]=t.useState(null),[d,i]=t.useState(null),[m,o]=t.useState(!1),[$,w]=t.useState(!1),{data:l}=T(["commission",{currentCommunity:s.id}],{queryFn:async()=>(await C.get(`${_}commission/id_from_community/${s.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:y}=T(["ciea_analysis",{id:l==null?void 0:l.id}],{queryFn:async()=>(await C.get(`${_}commission/${l==null?void 0:l.id}/verify`)).data,enabled:!!(l!=null&&l.id),retry:!1,refetchOnWindowFocus:!1}),x={publish:ae(()=>C.put(`${_}commission/${u}/publish`))};t.useEffect(()=>{w(k.membership.map(h=>h.id===1||h.id===s.id&&h.type==="adm").reduce((h,g)=>h||g))},[$,k,s]),t.useEffect(()=>{l&&z(l.id)},[l]),t.useEffect(()=>{i(r&&r.length?r[0]:"informacao")},[r]);const j=h=>{h==="confirm"&&a(),o(!1)},a=async()=>{const h=p("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:g}=await x.publish.mutateAsync();if(f(h),g.success)window.location=`${window.location}`,p("Comissão publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(g.reason.code==="not_ready")p(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta comissão ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(g){f(h),console.error(g),p("Erro ao publicar a comissão!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(xe,{title:"Comissão"}),e.jsx("div",{className:"page-header-buttons"})]}),y&&d&&e.jsxs(e.Fragment,{children:[e.jsx(Ye,{defaultTab:d,onTabChange:h=>c({params:[h]}),analysis:y}),u&&e.jsxs(e.Fragment,{children:[d==="informacao"&&e.jsx(Je,{entityId:u}),d==="indicadores"&&e.jsx(yt,{entityId:u,analysis:y,problems:y.analysis.question_problems}),d==="linha_tempo"&&e.jsx(Ct,{entityId:u})]})]}),e.jsx(Ie,{display:"flex",justifyContent:"space-between"}),e.jsx(Ot,{open:m,onClose:j})]})};function Ot({open:s,onClose:c}){return e.jsx("div",{children:e.jsxs(ke,{open:s,onClose:c,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(je,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(Y,{children:e.jsx(Y,{id:"alert-dialog-description",className:Et.term,children:e.jsx("p",{children:"TODO TODO TODO"})})}),e.jsxs(ze,{children:[e.jsx("button",{className:"button-primary",onClick:()=>c("confirm"),children:"Concordo"}),e.jsx(we,{onClick:()=>c("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{Wt as default};
