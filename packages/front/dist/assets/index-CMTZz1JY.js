import{r as s,j as e,E as se,u as P,b as B,d as E,e as F,f as K,P as ie,t as oe,o as G,p as H,A as le,q as ne,n as S,c as I,C as R,v as L,J as re,L as ce,O as de,x as me,w as ue,U as pe,T as he,a as ve,D as be,k as _e,l as Q,m as ge,B as xe}from"./index-DLt25zcS.js";import{T as ye,a as O}from"./Tabs-BURW5nwB.js";import{E as fe}from"./Edit-DVLUGes_.js";import{D as je}from"./Download-Cw4RWD-J.js";import{C as V}from"./index-Bha5MrYE.js";import{S as ke}from"./Search-BuC3Vl68.js";import{a as Ne,T as Ce}from"./TableRow-2NasLTb7.js";import{T as ze}from"./TablePagination-ChKDi7BJ.js";import{B as X}from"./Box-BoG2D6P7.js";import{T as Se}from"./TableSortLabel-BadkXaU-.js";import{n as we,S as Pe,a as $e,b as Te,c as Re}from"./no_thumb-BtmO3-w3.js";import{P as Ee}from"./plus-B_5SJsXG.js";import"./KeyboardArrowRight-B-_qEmRL.js";const Fe="_backdrop_z4t2t_52",Oe="_indicator_z4t2t_85",De="_warning_z4t2t_106",qe="_ready_z4t2t_109",Ae="_divisor_z4t2t_146",Me="_cleanfilters_z4t2t_152",T={"projects-tabs":"_projects-tabs_z4t2t_45",backdrop:Fe,"ptabs-content":"_ptabs-content_z4t2t_72","ptabs-tabs":"_ptabs-tabs_z4t2t_79",indicator:Oe,"fixed-size":"_fixed-size_z4t2t_85","not-ready":"_not-ready_z4t2t_103",warning:De,ready:qe,"ptabs-actions":"_ptabs-actions_z4t2t_119","ptabs-datefilter":"_ptabs-datefilter_z4t2t_124","ptabs-datefilter-button":"_ptabs-datefilter-button_z4t2t_134",divisor:Ae,cleanfilters:Me};function Be({defaultTab:a,onTabChange:r,analysis:l}){s.useState(!1);const v=p=>{r(p.target.id)};return e.jsxs("div",{className:T["projects-tabs"],children:[e.jsx("div",{className:T.backdrop}),e.jsx("div",{className:T["ptabs-content"],children:e.jsxs(ye,{className:T["ptabs-tabs"],onChange:v,value:a,children:[e.jsx(O,{disableRipple:!0,label:"Cadastros",...D("informacao"),disabled:a==="gerenciar",style:{color:a==="gerenciar"?"#aaa":"inherit"}}),e.jsx(O,{disableRipple:!0,label:"Linha do tempo",...D("linha_tempo"),disabled:a==="gerenciar",style:{color:a==="gerenciar"?"#aaa":"inherit"}}),a==="gerenciar"&&e.jsx(O,{disableRipple:!0,label:"Gerenciar",...D("gerenciar")})]})})]})}function D(a,r=""){return{id:a,"aria-controls":`simple-tabpanel-${a}`,value:a,"data-problems":r}}const Ie=a=>s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-delete",...a},s.createElement("path",{d:"M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"}),s.createElement("line",{x1:18,y1:9,x2:12,y2:15}),s.createElement("line",{x1:12,y1:9,x2:18,y2:15})),Ge="_adornment_1fsxa_1",W={adornment:Ge};let q;function He(){const{server:a}=P(),{changeRoute:r,params:l}=B(),v=E(),p=ne,x=s.useRef(null),[c,h]=s.useState(1),[d,z]=s.useState("nome"),[_,o]=s.useState("desc"),[b,g]=s.useState(10),[f,k]=s.useState(""),[i,m]=s.useState(""),[C,N]=s.useState(null),[t,j]=s.useState(null),{data:y}=F(["educom_list",{page:c,order:d,direction:_,perPage:b,searchFieldFilter:i}],{queryFn:async()=>(await S.get(`${a}educom_clima/?version=draft&page=${c}&order=${d}&direction=${_==="asc"?"desc":"asc"}&limit=${b}${i!=null&&i.length?`&name=${i}`:""}`)).data}),w={remove:K(n=>S.delete(`${a}educom_clima/${n}`),{onSuccess:()=>v.invalidateQueries("educom_list")})},$=n=>{h(1),d===n?o(_==="asc"?"desc":"asc"):(z(n),o("desc"))},Z=n=>{j(n)},ee=async n=>{n==="confirm"&&await w.remove.mutateAsync(t),j(null)},ae=n=>{k(n.target.value),q&&clearTimeout(q),q=setTimeout(()=>{m(n.target.value),h(1)},500)},te=()=>{k(""),m("")};return e.jsxs(e.Fragment,{children:[!C&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-header",children:[e.jsx(ie,{title:`Iniciativas ${y?`(${y.total})`:""}`}),e.jsxs("div",{className:"page-header-buttons",children:[e.jsx("div",{children:e.jsxs("button",{className:"button-primary",onClick:()=>r({params:["gerenciar","novo"]}),children:[e.jsx(oe,{}),"adicionar"]})}),e.jsx("div",{children:e.jsxs("button",{className:"button-outline",onClick:()=>window.open(`${a}educom_clima/spreadsheet`,"_blank"),children:[e.jsx(je,{}),"Baixar planilha"]})})]})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:y&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"tablebox",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(p,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx("button",{className:W.adornment,onClick:()=>{var n;return(n=x.current)==null?void 0:n.focus()},children:e.jsx(ke,{})}),endAdornment:e.jsx("button",{className:W.adornment,onClick:te,children:e.jsx(Ie,{})}),inputRef:x,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:f,onChange:ae})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(J,{text:"ID",column:"id",order:d,direction:_,onClick:$})}),e.jsx("th",{children:e.jsx(J,{text:"Nome",column:"nome",order:d,direction:_,onClick:$})})]})}),e.jsx(Ce,{children:y.entities.map(n=>e.jsxs(Le,{children:[e.jsxs("td",{children:["#",n.iniciativa_id]}),e.jsx("td",{children:n.nome}),e.jsxs("td",{className:"tbox-table-actions",children:[e.jsx("div",{children:e.jsx(G,{title:"Editar",children:e.jsx(H,{onClick:()=>r({params:["gerenciar",n.iniciativa_id]}),children:e.jsx(fe,{})})})}),e.jsx("div",{children:e.jsx(G,{title:"Remover",children:e.jsx(H,{onClick:()=>Z(n.iniciativa_id),children:e.jsx(le,{})})})})]})]},n.id))})]})})]}),e.jsx(ze,{className:"pagination",component:"div",count:y.total,page:c-1,onPageChange:(...n)=>h(n[1]+1),rowsPerPage:b,rowsPerPageOptions:[10,20,50,100],onRowsPerPageChange:n=>{g(n.target.value),h(1)}})]})})}),e.jsx(X,{display:"flex",justifyContent:"space-between"}),e.jsx(V,{open:!!t,content:"Confirma a remoção desta registro?",confirmButtonText:"Remover",onClose:ee})]}),!!C&&e.jsx(e.Fragment,{children:"[TODO: MNG]"})]})}function J({text:a,column:r,order:l,direction:v,enabled:p=!0,onClick:x}){return e.jsxs(e.Fragment,{children:[!p&&e.jsx(e.Fragment,{children:a}),p&&e.jsx(Se,{className:"tbox-table-sortlabel",active:l===r,direction:v,onClick:()=>x(r),children:a})]})}const Le=se(Ne)({"&:last-child td, &:last-child th":{border:0}}),A={fields:[{key:"nome",type:"text",title:"Nome da Iniciativa",size:12,client_validation:"not_empty"},{key:"email",type:"text",title:"E-mail do responsável",size:6},{key:"definicao",type:"options",list:{module:"property",key:"definicao"},title:"Tipo de Organização",size:6},{key:"nivel",type:"multi_autocomplete",tag:!0,title:"Nível Territorial",size:6,list:{module:"property",key:"nivel"}},{key:"uf",type:"multi_autocomplete",tag:!0,title:"Estados de atuação",size:6,list:{module:"property",key:"ufs"}},{key:"apresentacao",type:"textarea",title:"Apresentação",size:4,rows:2},{key:"redes_sociais",type:"text",title:"Redes Sociais",size:4},{key:"conte_mais",type:"textarea",title:"Outros detalhes",size:4,rows:2},{key:"faixa_etaria",type:"multi_autocomplete",tag:!0,title:"Idades",size:6,list:{module:"property",key:"faixa_etaria"}},{key:"participantes_genero",type:"multi_autocomplete",tag:!0,title:"Relação Gênero/Sexo",size:6,list:{module:"property",key:"participantes_genero"}},{key:"racas_etnias",type:"multi_autocomplete",tag:!0,title:"Relação Étnica",size:6,list:{module:"property",key:"racas_etnias"}},{key:"temas",type:"multi_autocomplete",tag:!0,title:"Temas",size:4,list:{module:"property",key:"temas"}},{key:"midias",type:"multi_autocomplete",tag:!0,title:"Mídias",size:4,list:{module:"property",key:"midias"}},{key:"materiais_didaticos",type:"textarea",title:"Materiais Didáticos",size:4,rows:2},{key:"estrategias_educativas",type:"multi_autocomplete",tag:!0,title:"Estratégias Educativas",size:4,list:{module:"property",key:"estrategias_educativas"}},{key:"noticia_falsa_recebeu",type:"options",title:"Recebeu Notícia Falsa?",size:4,list:{module:"property",key:"noticia_falsa_recebeu"}},{key:"noticia_falsa_exemplo",type:"textarea",title:"Exemplo de Notícia Falsa",size:12,rows:2,show:{target:{key:"noticia_falsa_recebeu",value:1}}},{key:"aborda_desinformacao",type:"options",title:"Aborda desinformação?",size:4,list:{module:"property",key:"aborda_desinformacao"}},{key:"aborda_desinformacao_exemplo",type:"textarea",title:"Exemplo de desinformação",size:12,rows:2,show:{target:{key:"aborda_desinformacao",value:1}}}],blocks:[{key:"iniciativa",title:"Sobre a Iniciativa",elements:["nome","email","definicao","nivel","uf"]},{key:"apresentacao",title:"Apresentação",elements:["apresentacao","redes_sociais","conte_mais"]},{key:"participantes",title:"Participantes",elements:["faixa_etaria","participantes_genero","racas_etnias"]},{key:"mais",title:"Mais informações",elements:["temas","midias","estrategias_educativas","materiais_didaticos","noticia_falsa_recebeu","noticia_falsa_exemplo","aborda_desinformacao","aborda_desinformacao_exemplo"]}]},Qe=[{type:"row",block:"iniciativa",elements:[{type:"row",elements:[{type:"column",size:12,key:"nome"},{type:"column",size:6,key:"email"},{type:"column",size:6,key:"definicao"},{type:"column",size:6,key:"nivel"},{type:"column",size:6,key:"uf"}]}]},{type:"row",block:"apresentacao",elements:[{type:"row",elements:[{type:"column",size:12,key:"apresentacao"},{type:"column",size:12,key:"redes_sociais"},{type:"column",size:12,key:"conte_mais"}]}]},{type:"row",block:"participantes",elements:[{type:"row",elements:[{type:"column",size:6,key:"faixa_etaria"},{type:"column",size:6,key:"participantes_genero"},{type:"column",size:6,key:"racas_etnias"}]}]},{type:"row",block:"mais",elements:[{type:"row",elements:[{type:"column",size:12,key:"temas"},{type:"column",size:12,key:"midias"},{type:"column",size:12,key:"materiais_didaticos"},{type:"column",size:12,key:"estrategias_educativas"},{type:"column",size:12,key:"noticia_falsa_recebeu"},{type:"column",size:12,key:"noticia_falsa_exemplo"},{type:"column",size:12,key:"aborda_desinformacao"},{type:"column",size:12,key:"aborda_desinformacao_exemplo"}]}]}],U={lists:[{key:"acao_enfrentamento",options:[{value:1,label:"Sim"},{value:2,label:"Não"}]},{key:"nivel",options:[{value:1,label:"Municipal"},{value:2,label:"Estadual"},{value:3,label:"Regional"},{value:4,label:"Nacional"},{value:5,label:"Local"},{value:6,label:"Internacional"},{value:7,label:"Prefiro não responder essa questão"}]},{key:"definicao",options:[{value:1,label:"Organização da social civil"},{value:2,label:"Governamental (inclui escolas públicas, por exemplo)"},{value:3,label:"Movimento social"},{value:4,label:"Prefiro não responder essa questão"},{value:5,label:"Corporativa (ligada ao setor empresarial)"}]},{key:"faixa_etaria",options:[{value:1,label:"Jovens (15 a 29 anos)"},{value:2,label:"Adultos (30 a 59 anos)"},{value:3,label:"Crianças (4 a 14 anos)"},{value:4,label:"Idosos (a partir de 60 anos)"},{value:5,label:"Bebês (até 3 anos)"},{value:6,label:"Prefiro não responder essa questão"}]},{key:"participantes_genero",options:[{value:1,label:"Mulheres cisgênero"},{value:2,label:"Homens cisgênero"},{value:3,label:"Mulheres transgênero"},{value:4,label:"Homens transgênero"},{value:5,label:"Não binário"},{value:6,label:"Prefiro não responder essa questão"}]},{key:"racas_etnias",options:[{value:1,label:"Pretos(as)"},{value:2,label:"Brancos(as)"},{value:3,label:"Pardos(as)"},{value:4,label:"Indígenas"},{value:5,label:"Amarelos(as)"},{value:6,label:"Prefiro não responder essa questão"}]},{key:"noticia_falsa_recebeu",options:[{value:1,label:"Sim"},{value:2,label:"Não"}]},{key:"aborda_desinformacao",options:[{value:1,label:"Sim"},{value:2,label:"Não"}]},{key:"ufs",options:[{value:12,label:"Acre"},{value:27,label:"Alagoas"},{value:16,label:"Amapá"},{value:13,label:"Amazonas"},{value:29,label:"Bahia"},{value:23,label:"Ceará"},{value:53,label:"Distrito Federal"},{value:32,label:"Espírito Santo"},{value:52,label:"Goiás"},{value:21,label:"Maranhão"},{value:51,label:"Mato Grosso"},{value:50,label:"Mato Grosso do Sul"},{value:31,label:"Minas Gerais"},{value:15,label:"Pará"},{value:25,label:"Paraíba"},{value:41,label:"Paraná"},{value:26,label:"Pernambuco"},{value:22,label:"Piauí"},{value:33,label:"Rio de Janeiro"},{value:24,label:"Rio Grande do Norte"},{value:43,label:"Rio Grande do Sul"},{value:11,label:"Rondônia"},{value:14,label:"Roraima"},{value:42,label:"Santa Catarina"},{value:35,label:"São Paulo"},{value:28,label:"Sergipe"},{value:17,label:"Tocantins"}]},{key:"temas",options:[{value:1,label:"Água"},{value:6,label:"Biodiversidade"},{value:8,label:"Degradação Ambiental"},{value:9,label:"Educação Ambiental"},{value:2,label:"Emergência climática"},{value:4,label:"Energias Renováveis"},{value:3,label:"ODS - Agenda 2030"},{value:5,label:"Resíduos e Reciclagem"},{value:7,label:"Transição energética"}]},{key:"midias",options:[{value:4,label:"Intervenções e projetos"},{value:5,label:"Pesquisa"},{value:3,label:"Processos formativos"},{value:2,label:"Produção de Conteúdo"},{value:1,label:"Reunião Online"}]},{key:"estrategias_educativas",options:[{value:5,label:"Campanhas"},{value:1,label:"Oficinas e Palestras"},{value:3,label:"Pesquisa, Projetos Acadêmicos e Formação"},{value:4,label:"Produção Cultural"},{value:2,label:"Projetos Práticos"}]}]},We="_action_1rbzt_1",M={action:We,"special-section-header":"_special-section-header_1rbzt_7"};function Je({entityId:a}){const{changeRoute:r}=B(),{server:l}=P(),v=E(),{enqueueSnackbar:p,closeSnackbar:x}=I(),[c,h]=s.useState({}),[d,z]=s.useState({}),[_,o]=s.useState([]),[b,g]=s.useState({}),{data:f}=F(["policy_info",{entityId:a}],{queryFn:async()=>(await S.get(`${l}educom_clima/${a}/draft/info`)).data,enabled:!!a&&a!=="novo",refetchOnWindowFocus:!1});s.useEffect(()=>{f&&g(f),o([])},[f]);const k=(C,N)=>{h(C),z(N)},i=()=>{r({params:[]})},m=async()=>{if(!c.nome||!c.nome.trim().length){o(["nome"]);return}o([]);const C=de(A,c,d),N=p("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let t,j;a!=="novo"?(t="put",j=`${l}educom_clima/${a}/draft`):(t="post",j=`${l}educom_clima/draft`),await S({method:t,url:j,data:C,config:{headers:{"Content-Type":"multipart/form-data"}}}),v.invalidateQueries("educom_list"),x(N),p("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(t){x(N),console.error(t),p("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return e.jsx(e.Fragment,{children:c&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(R,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:`section-header ${M["special-section-header"]}`,children:[e.jsx("div",{className:"section-title"}),e.jsxs("div",{className:`section-actions ${M.action}`,children:[e.jsx("button",{className:"button-outline",onClick:i,children:"Sair"}),e.jsxs("button",{className:"button-primary",onClick:m,children:[e.jsx(L,{}),"Gravar"]})]})]}),e.jsx(re,{form:A,view:Qe,lists:U,data:ce(b,A,U),problems:_,onDataChange:k}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsxs("div",{className:`section-actions ${M.action}`,children:[e.jsx("button",{className:"button-outline",onClick:i,children:"Cancelar"}),e.jsxs("button",{className:"button-primary",onClick:m,children:[e.jsx(L,{}),"Gravar"]})]})]})]})})})})})}const Ue="_vcentered_1g64r_1",Ye="_add_1g64r_6",Ke="_action_1g64r_7",Ve="_timeline_1g64r_33",Xe="_highlight_1g64r_36",Ze="_each_1g64r_40",ea="_date_1g64r_49",aa="_text_1g64r_52",ta="_thumb_1g64r_58",sa="_buttons_1g64r_81",ia="_editing_1g64r_86",u={vcentered:Ue,add:Ye,action:Ke,timeline:Ve,highlight:Xe,each:Ze,date:ea,text:aa,thumb:ta,"thumb-image":"_thumb-image_1g64r_62",buttons:sa,editing:ia,"edit-buttons":"_edit-buttons_1g64r_92"};function oa({entityId:a}){const{server:r}=P(),l=E(),[v,p]=s.useState([]),[x,c]=s.useState(null),[h,d]=s.useState(null),[z,_]=s.useState(null),[o,b]=s.useState(null),{data:g}=F(["educom_clima_timeline",{entityId:a}],{queryFn:async()=>(await S.get(`${r}educom_clima/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),f=K(t=>S.delete(`${r}educom_clima/draft/timeline/${t}`),{onSuccess:()=>l.invalidateQueries("educom_clima_timeline")});s.useEffect(()=>{g&&p(g)},[g]),s.useEffect(()=>{h&&setTimeout(()=>{const t=document.getElementById(`timeline_${h}`);t&&(t.scrollIntoView({block:"end",inline:"nearest"}),_(h),d(null),setTimeout(()=>_(null),2e3))},10)},[v,h]);const k=t=>()=>{c(t)},i=t=>()=>{const j=v.find(y=>y.id===t);j&&b(j)},m=async t=>{t==="confirm"&&await f.mutateAsync(x),c(null)},C=()=>{b(null)},N=()=>{b(null)};return e.jsx(e.Fragment,{children:v&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(R,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsxs("section",{id:"details",children:["A linha do tempo é uma ferramenta para a apresentação e o registro dos principais marcos/eventos da iniciativa. Insira o mês/ano em que o marco/evento aconteceu, uma imagem ilustrativa (pode ser uma fotografia real ou um ícone/desenho) e um texto descritivo. A ferramenta organiza automaticamente a apresentação dos marcos/eventos em ordem cronológica.",e.jsx("br",{}),"Alguns exemplos de marcos/eventos: criação da iniciativa, realização de atividades relevantes, eventos públicos, publicação de normativas, relatórios, materiais educomunicativos, etc."]})})}),e.jsx(R,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${u["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(Y,{entityId:a,editing:o,onHighlight:d,add:!0,onSave:N})})})}),e.jsx(R,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:u.timeline,children:!!g&&v.map(t=>e.jsxs(s.Fragment,{children:[(o==null?void 0:o.id)!==t.id&&e.jsxs("div",{id:`timeline_${t.id}`,className:`${u.each} ${z===t.id?u.highlight:""}`,children:[e.jsxs("div",{className:u.date,children:[" ",e.jsx("span",{className:u.text,children:me(t.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:u.thumb,children:e.jsxs("div",{className:u["thumb-image"],children:[!!t.timeline_arquivo&&e.jsx("img",{src:t.timeline_arquivo,alt:"imagem de timeline"}),!t.timeline_arquivo&&e.jsx("img",{src:we,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:u.text,children:t.texto}),e.jsxs("div",{className:u.buttons,children:[e.jsx("button",{className:u.action,onClick:i(t.id),disabled:!!o,children:e.jsx(Pe,{})}),(o==null?void 0:o.id)!==t.id&&e.jsx("button",{className:u.action,onClick:k(t.id),disabled:!!o,children:e.jsx($e,{})})]})]}),(o==null?void 0:o.id)===t.id&&e.jsx(Y,{entityId:a,editing:o,onHighlight:d,onCancel:C,onSave:N})]},t.id))})})})})]}),e.jsx(V,{open:!!x,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:m})]})})}function Y({add:a,entityId:r,editing:l,onHighlight:v,onCancel:p,onSave:x}){const{enqueueSnackbar:c,closeSnackbar:h}=I(),{server:d}=P(),z=E(),[_,o]=s.useState(new Date),[b,g]=s.useState(null),[f,k]=s.useState(null),[i,m]=s.useState(null);s.useEffect(()=>{a?(o(new Date),m(null)):(o(l.date),m(l.texto),g({url:l.timeline_arquivo}))},[l]);const C=t=>{g(t||"remove"),k(t==null?void 0:t.file)},N=async()=>{if(!i||!i.length)return;let t=new FormData;f&&t.append("imagem",f);const j=c("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let y,w;a?(y="post",w=`${d}educom_clima/draft/timeline`):(y="put",w=`${d}educom_clima/draft/timeline/${l.id}`),t.set("entity",JSON.stringify({date:_,texto:i,timeline_arquivo:b}));const{data:$}=await S({method:y,url:w,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});v($.id),o(new Date),m(null),g(null),k(null),x(),z.invalidateQueries("educom_clima_timeline"),h(j),c("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(y){h(j),console.error(y),c("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!a&&l?u.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${u.vcentered}`,children:e.jsx(ue,{className:"input-datepicker",label:"Mês",value:_||"",onChange:o,views:["month","year"],inputFormat:"MM/yyyy",disabled:a&&!!l})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(pe,{onChange:C,url:b==null?void 0:b.url,alt:"imagem",title:"Imagem",disabled:a&&!!l,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(he,{className:"input-text",label:"Texto",value:i||"",onChange:t=>m(t.target.value),multiline:!0,rows:4,disabled:a&&!!l})}),e.jsxs("div",{className:`col-xs-1 ${u.vcentered}`,children:[a&&e.jsx("button",{className:u.add,onClick:N,disabled:a&&!!l,children:e.jsx(Ee,{})}),!a&&e.jsxs("div",{className:u["edit-buttons"],children:[e.jsx("button",{className:u.add,onClick:N,children:e.jsx(Te,{})}),e.jsx("button",{className:u.add,onClick:p,children:e.jsx(Re,{})})]})]})]})}const la="_button_delete_11779_45",na="_Roll_11779_1",ra="_term_11779_82",ca={button_delete:la,Roll:na,term:ra},Na=()=>{const{currentCommunity:a,changeRoute:r,params:l}=B(),{server:v}=P(),{user:p,updateUser:x}=ve(),{enqueueSnackbar:c,closeSnackbar:h}=I(),[d,z]=s.useState(null),[_,o]=s.useState(!1),[b,g]=s.useState(!1);F(["commission",{currentCommunity:a.id}],{queryFn:async()=>(await S.get(`${v}commission/id_from_community/${a.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),s.useEffect(()=>{g(p.membership.map(i=>i.id===1||i.id===a.id&&i.type==="adm").reduce((i,m)=>i||m))},[b,p,a]),s.useEffect(()=>{z(l&&l.length?l[0]:"informacao")},[l]);const f=i=>{i==="confirm"&&k(),o(!1)},k=async()=>{const i=c("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:m}=await mutation.publish.mutateAsync();if(h(i),m.success)window.location=`${window.location}`,c("Iniciativa publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(m.reason.code==="not_ready")c(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta iniciativa ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(m){h(i),console.error(m),c("Erro ao publicar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsx("div",{className:"page-header",children:e.jsx("div",{className:"page-header-buttons"})}),d&&e.jsxs(e.Fragment,{children:[e.jsx(Be,{defaultTab:d,onTabChange:i=>r({params:[i]})}),e.jsxs(e.Fragment,{children:[d==="informacao"&&e.jsx(He,{}),d==="gerenciar"&&e.jsx(Je,{entityId:l[1]}),d==="linha_tempo"&&e.jsx(oa,{})]})]}),e.jsx(X,{display:"flex",justifyContent:"space-between"}),e.jsx(da,{open:_,onClose:f})]})};function da({open:a,onClose:r}){return e.jsx("div",{children:e.jsxs(be,{open:a,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(_e,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(Q,{children:e.jsx(Q,{id:"alert-dialog-description",className:ca.term,children:e.jsx("p",{children:"TODO TODO TODO"})})}),e.jsxs(ge,{children:[e.jsx("button",{className:"button-primary",onClick:()=>r("confirm"),children:"Concordo"}),e.jsx(xe,{onClick:()=>r("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{Na as default};
