import{r as i,j as e,u as Q,d as Z,c as q,e as w,C as J,s as j,n as B,N as $,x as O,f as M,L as R,T as F,b as H,a as P,p as W,D as V,k as U,l as N,m as K,B as X}from"./index-7W1X0-fp.js";import{T as ee,a as E}from"./Tabs-BbqEWVY-.js";import"./lodash-Ba4guvlw.js";import{m as te,R as ae,U as oe}from"./index-7lRCPYvU.js";import{D as ie}from"./index-DB8_86U1.js";import{C as se}from"./index-CicgDPHG.js";import{P as ne}from"./plus-CmmBX90E.js";import{P as re}from"./PageTitle-B5Guk-9A.js";import"./KeyboardArrowRight-C1ubucs1.js";import"./Plus-LxlK4A0R.js";import"./Trash-DJyh5p-H.js";import"./Popper-DAXMf1d9.js";import"./Autocomplete-rJEHThK9.js";import"./useThemeProps-D5IlkqSU.js";const le="_backdrop_x4juq_52",ce="_indicator_x4juq_85",me="_warning_x4juq_106",pe="_ready_x4juq_109",ue="_divisor_x4juq_146",de="_cleanfilters_x4juq_152",I={"projects-tabs":"_projects-tabs_x4juq_45",backdrop:le,"ptabs-content":"_ptabs-content_x4juq_72","ptabs-tabs":"_ptabs-tabs_x4juq_79",indicator:ce,"fixed-size":"_fixed-size_x4juq_85","not-ready":"_not-ready_x4juq_103",warning:me,ready:pe,"ptabs-actions":"_ptabs-actions_x4juq_119","ptabs-datefilter":"_ptabs-datefilter_x4juq_124","ptabs-datefilter-button":"_ptabs-datefilter-button_x4juq_134",divisor:ue,cleanfilters:de};function _e({defaultTab:a,onTabChange:d,analysis:c}){i.useState(!1);const _=g=>{d(g.target.id)};return e.jsxs("div",{className:I["projects-tabs"],children:[e.jsx("div",{className:I.backdrop}),e.jsx("div",{className:I["ptabs-content"],children:e.jsxs(ee,{className:I["ptabs-tabs"],onChange:_,value:a,children:[e.jsx(E,{disableRipple:!0,label:"Informações",...S("informacao")}),e.jsx(E,{disableRipple:!0,label:"Linha do tempo",...S("linha_tempo")})]})})]})}function S(a,d=""){return{id:a,"aria-controls":`simple-tabpanel-${a}`,value:a,"data-problems":d}}const G={fields:[{key:"logo_arquivo",type:"thumbnail",title:"Logotipo",size:2},{key:"uf_nome",type:"read_only",title:"Estado",size:3},{key:"regiao",type:"read_only",title:"Região",size:3},{key:"data_criacao",type:"yearpicker",title:"Data da criação",size:3},{key:"ativo",type:"options",title:"Ativo",size:3,options:[{value:1,label:"Sim"},{value:2,label:"Em reestruturação"},{value:3,label:"Não"}]},{key:"link",type:"text",title:"Link para o site",size:12},{key:"documento_criacao",type:"text",title:"Título do documento de criação",size:4},{key:"documento_criacao_tipo",type:"options",title:"Tipo de documento de criação",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"documento_criacao_arquivo",type:"text",title:"Link para o documento de criação",size:6,show:{target:{key:"documento_criacao_tipo",value:"link"}}},{key:"documento_criacao_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de criação",size:6,show:{target:{key:"documento_criacao_tipo",value:"file"}}},{key:"composicao_cadeiras_set_pub",type:"integer",title:"Núm. cadeiras - setor público",size:3},{key:"composicao_cadeiras_soc_civ",type:"integer",title:"Núm. cadeiras - sociedade civil",size:3},{key:"setor",type:"text",title:"Setor %index%",size:6},{key:"cadeiras",type:"integer",title:"Cadeiras %index%",size:6},{key:"coordenacao",type:"options",title:"Órgão gestor",size:6,options:[{value:1,label:"Secretarias Estaduais de Meio Ambiente (ou correlatas) e de Educação"},{value:2,label:"Apenas Secretaria de Estado de Meio Ambiente (ou correlatas)"},{value:3,label:"Apenas Secretaria de Estado de Educação"},{value:4,label:"Outra Pasta do Estado"},{value:5,label:"Instituição da Sociedade Civil"},{value:6,label:"Instituição de outro segmento"}]},{key:"coordenacao_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"coordenacao",value:[4,6]}}},{key:"regimento_interno_tem",type:"options",title:"Tem regimento?",size:4,list:{module:"property",key:"sim_nao"}},{key:"regimento_interno",type:"text",title:"Título do regimento interno",size:12,show:{target:{key:"regimento_interno_tem",value:"sim"}}},{key:"regimento_interno_tipo",type:"options",title:"Tipo de documento de regimento",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"regimento_interno_arquivo",type:"text",title:"Link para o regimento interno",size:6,show:{target:{key:"regimento_interno_tipo",value:"link"}}},{key:"regimento_interno_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de regimento",size:6,show:{target:{key:"regimento_interno_tipo",value:"file"}}},{key:"org_interna_periodicidade",type:"options",title:"Periodicidade",size:6,options:[{value:1,label:"Mensal"},{value:2,label:"Bimestral"},{value:3,label:"Semestral"},{value:4,label:"Anual"},{value:5,label:"Outro"}]},{key:"organizacao_interna_periodicidade_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"org_interna_periodicidade",value:5}}},{key:"organizacao_interna_estrutura_tem",type:"options",title:"Possui câmaras técnicas ou grupos de trabalho?",size:6,list:{module:"property",key:"sim_nao"}},{key:"organizacao_interna_estrutura_especifique",type:"text",title:"Especifique",size:6,show:{target:{key:"organizacao_interna_estrutura_tem",value:"sim"}}},{key:"ppea_tem",type:"options",title:"Tem política pública?",size:4,list:{module:"property",key:"sim_nao"}},{key:"ppea_tipo",type:"options",title:"Tipo de documento de política pública",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"ppea_arquivo",type:"text",title:"Link para a política pública",size:6,show:{target:{key:"ppea_tipo",value:"link"}}},{key:"ppea_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de política pública",size:6,show:{target:{key:"ppea_tipo",value:"file"}}},{key:"ppea_decreto",type:"text",title:"Decreto",size:3},{key:"ppea_lei",type:"text",title:"Lei",size:3},{key:"ppea2_tem",type:"options",title:"Tem política pública?",size:4,list:{module:"property",key:"sim_nao"}},{key:"ppea2_tipo",type:"options",title:"Tipo de documento de política pública",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"ppea2_arquivo",type:"text",title:"Link para a política pública",size:6,show:{target:{key:"ppea2_tipo",value:"link"}}},{key:"ppea2_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo de política pública",size:6,show:{target:{key:"ppea2_tipo",value:"file"}}},{key:"ppea2_decreto",type:"text",title:"Decreto",size:3},{key:"ppea2_lei",type:"text",title:"Lei",size:3},{key:"programa_estadual_tem",type:"options",title:"Tem programa estadual?",size:4,list:{module:"property",key:"sim_nao"}},{key:"programa_estadual_tipo",type:"options",title:"Tipo de documento",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"programa_estadual_arquivo",type:"text",title:"Link para o programa",size:6,show:{target:{key:"programa_estadual_tipo",value:"link"}}},{key:"programa_estadual_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo do programa",size:6,show:{target:{key:"programa_estadual_tipo",value:"file"}}},{key:"programa_estadual_decreto",type:"text",title:"Decreto",size:3},{key:"programa_estadual_lei",type:"text",title:"Lei",size:3},{key:"plano_estadual_tem",type:"options",title:"Tem plano estadual?",size:4,list:{module:"property",key:"sim_nao"}},{key:"plano_estadual_tipo",type:"options",title:"Tipo de documento",size:2,list:{module:"property",key:"tipo_arquivo"}},{key:"plano_estadual_arquivo",type:"text",title:"Link para o plano",size:6,show:{target:{key:"plano_estadual_tipo",value:"link"}}},{key:"plano_estadual_arquivo2",type:"file",accept:"application/pdf",title:"Arquivo do plano",size:6,show:{target:{key:"plano_estadual_tipo",value:"file"}}},{key:"plano_estadual_decreto",type:"text",title:"Decreto",size:3},{key:"plano_estadual_lei",type:"text",title:"Lei",size:3}],blocks:[{key:"detalhes",title:"Detalhes da comissão",elements:["logo_arquivo","uf_nome","regiao","data_criacao","ativo","link"]},{key:"documento",title:"Documento de criação",elements:["documento_criacao","documento_criacao_tipo","documento_criacao_arquivo","documento_criacao_arquivo2"]},{key:"composicao",title:"Composição",elements:[{type:"field",key:"composicao_cadeiras_set_pub"},"composicao_cadeiras_soc_civ",{type:"block",key:"composicao_cadeiras_outros"}]},{key:"composicao_cadeiras_outros",elements:["setor","cadeiras"],iterate:{target:"none",index:"default",add:"Adicionar setor"}},{key:"coordenacao_block",title:"Coordenação",elements:["coordenacao","coordenacao_especifique"]},{key:"regimento_interno_block",title:"Regimento interno",elements:["regimento_interno_tem","regimento_interno",{type:"block",key:"regimento_interno_tem_block"}]},{key:"regimento_interno_tem_block",elements:["regimento_interno_tipo","regimento_interno_arquivo","regimento_interno_arquivo2"],show:{target:{key:"regimento_interno_tem",value:"sim"}}},{key:"organizacao_interna",title:"Organização interna",elements:["org_interna_periodicidade","organizacao_interna_periodicidade_especifique","organizacao_interna_estrutura_tem","organizacao_interna_estrutura_especifique"]},{key:"ppea_block",title:"Política Pública Estadual de Educação Ambiental",elements:["ppea_tem",{type:"block",key:"ppea_tem_block"}]},{key:"ppea_tem_block",elements:["ppea_tipo","ppea_arquivo","ppea_arquivo2","ppea_decreto","ppea_lei"],show:{target:{key:"ppea_tem",value:"sim"}}},{key:"ppea2_block",title:"Política Pública Estadual de Mudanças do Clima",elements:["ppea2_tem",{type:"block",key:"ppea2_tem_block"}]},{key:"ppea2_tem_block",elements:["ppea2_tipo","ppea2_arquivo","ppea2_arquivo2","ppea2_decreto","ppea2_lei"],show:{target:{key:"ppea2_tem",value:"sim"}}},{key:"programa_estadual_block",title:"Programa Estadual de Educação Ambiental",elements:["programa_estadual_tem",{type:"block",key:"programa_estadual_tem_block"}]},{key:"programa_estadual_tem_block",elements:["programa_estadual_tipo","programa_estadual_arquivo","programa_estadual_arquivo2","programa_estadual_decreto","programa_estadual_lei"],show:{target:{key:"programa_estadual_tem",value:"sim"}}},{key:"plano_estadual_block",title:"Plano Estadual de Educação Ambiental",elements:["plano_estadual_tem",{type:"block",key:"plano_estadual_tem_block"}]},{key:"plano_estadual_tem_block",elements:["plano_estadual_tipo","plano_estadual_arquivo","plano_estadual_arquivo2","plano_estadual_decreto","plano_estadual_lei"],show:{target:{key:"plano_estadual_tem",value:"sim"}}}]},ke=[{type:"row",block:"detalhes",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:2,key:"logo_arquivo"}]},{type:"row",elements:[{type:"column",size:3,key:"uf_nome"},{type:"column",size:3,key:"regiao"},{type:"column",size:3,key:"data_criacao"},{type:"column",size:3,key:"ativo"}]},{type:"row",elements:[{type:"column",size:12,key:"link"}]}]}]},{type:"separator"},{type:"row",block:"documento",elements:[{type:"row",elements:[{type:"column",size:12,key:"documento_criacao"},{type:"column",size:2,key:"documento_criacao_tipo"},{type:"column",size:6,key:"documento_criacao_arquivo"},{type:"column",size:6,key:"documento_criacao_arquivo2"}]}]},{type:"separator"},{type:"row",block:"composicao",elements:[{type:"row",elements:[{type:"column",size:3,key:"composicao_cadeiras_set_pub"},{type:"column",size:3,key:"composicao_cadeiras_soc_civ"}]},{type:"row",block:"composicao_cadeiras_outros",elements:[{type:"column",size:3,key:"setor"},{type:"column",size:3,key:"cadeiras"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"composicao_cadeiras_outros",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar setor"}]}]}]}]},{type:"row",block:"coordenacao_block",elements:[{type:"column",size:6,key:"coordenacao"},{type:"column",size:6,key:"coordenacao_especifique"}]},{type:"row",block:"regimento_interno_block",elements:[{type:"column",size:6,key:"regimento_interno_tem"},{type:"column",size:6,key:"regimento_interno"}]},{type:"row",block:"regimento_interno_tem_block",elements:[{type:"column",size:6,key:"regimento_interno_tipo"},{type:"column",size:6,key:"regimento_interno_arquivo"},{type:"column",size:6,key:"regimento_interno_arquivo2"}]},{type:"row",block:"organizacao_interna",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"org_interna_periodicidade"},{type:"column",size:6,key:"organizacao_interna_periodicidade_especifique"}]},{type:"row",elements:[{type:"column",size:6,key:"organizacao_interna_estrutura_tem"},{type:"column",size:6,key:"organizacao_interna_estrutura_especifique"}]}]}]},{type:"row",block:"ppea_block",elements:[{type:"column",size:4,key:"ppea_tem"}]},{type:"row",block:"ppea_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea_tipo"},{type:"column",size:6,key:"ppea_arquivo"},{type:"column",size:6,key:"ppea_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea_decreto"},{type:"column",size:3,key:"ppea_lei"}]}]}]},{type:"row",block:"ppea2_block",elements:[{type:"column",size:4,key:"ppea2_tem"}]},{type:"row",block:"ppea2_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"ppea2_tipo"},{type:"column",size:6,key:"ppea2_arquivo"},{type:"column",size:6,key:"ppea2_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"ppea2_decreto"},{type:"column",size:3,key:"ppea2_lei"}]}]}]},{type:"row",block:"programa_estadual_block",elements:[{type:"column",size:4,key:"programa_estadual_tem"}]},{type:"row",block:"programa_estadual_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"programa_estadual_tipo"},{type:"column",size:6,key:"programa_estadual_arquivo"},{type:"column",size:6,key:"programa_estadual_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"programa_estadual_decreto"},{type:"column",size:3,key:"programa_estadual_lei"}]}]}]},{type:"row",block:"plano_estadual_block",elements:[{type:"column",size:4,key:"plano_estadual_tem"}]},{type:"row",block:"plano_estadual_tem_block",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:6,key:"plano_estadual_tipo"},{type:"column",size:6,key:"plano_estadual_arquivo"},{type:"column",size:6,key:"plano_estadual_arquivo2"}]},{type:"row",elements:[{type:"column",size:3,key:"plano_estadual_decreto"},{type:"column",size:3,key:"plano_estadual_lei"}]}]}]}],ye={lists:[{key:"sim_nao",options:[{value:"sim",label:"Sim"},{value:"nao",label:"Não"}]},{key:"tipo_arquivo",options:[{value:"link",label:"Link"},{value:"file",label:"Arquivo"}]}]},T={logo_arquivo:null,documento_criacao_arquivo2:null,regimento_interno_arquivo2:null,ppea_arquivo2:null,ppea2_arquivo2:null,programa_estadual_arquivo2:null,plano_estadual_arquivo2:null};function ge({entityId:a}){const{server:d}=Q(),c=Z(),{enqueueSnackbar:_,closeSnackbar:g}=q(),[f,m]=i.useState({}),[r,y]=i.useState({}),[p,A]=i.useState(T),{data:l}=w(["commission_info",{entityId:a}],{queryFn:async()=>(await B.get(`${d}commission/${a}/draft`)).data,retry:!1,refetchOnWindowFocus:!1});i.useEffect(()=>{if(!l||!G)return;const o=te(l,G);y(o),m(o),A(T)},[l,G]);const h=(o,s,u)=>{if(u===void 0){let n={...r};if(o.includes("tipo")&&s==="link"){console.log();const t=o.replace("_tipo","");n={...n,[`${t}_arquivo`]:f[`${t}_tipo`]==="link"?f[`${t}_arquivo`]:""}}["logo_arquivo","documento_criacao_arquivo2","regimento_interno_arquivo2","ppea_arquivo2","ppea2_arquivo2","programa_estadual_arquivo2","plano_estadual_arquivo2"].includes(o)?(n={...n,[o]:s||"remove"},A({...p,[o]:s==null?void 0:s.file})):n={...n,[o]:s},console.log(`changing ${o}:`,s,n),y(n)}else{let n=r[u.k];n&&Array.isArray(n)&&(n[u.index][o]=s,y(t=>({...t,[u.k]:n})))}},v=o=>{let s=r[o.k];s.splice(o.index,1),y(u=>({...u,[o.k]:s}))},x=o=>{let s={};for(let n of o.elements)s[n]=null;let u;r[o.key]?u=[...r[o.key],s]:u=[s],y(n=>({...n,[o.key]:u}))},C=async()=>{let o=new FormData;p.logo_arquivo&&o.append("logo",p.logo_arquivo),r.documento_criacao_tipo==="file"&&p.documento_criacao_arquivo2&&o.append("documento_criacao",p.documento_criacao_arquivo2),r.regimento_interno_tipo==="file"&&p.regimento_interno_arquivo2&&o.append("regimento_interno",p.regimento_interno_arquivo2),r.ppea_tipo==="file"&&p.ppea_arquivo2&&o.append("ppea",p.ppea_arquivo2),r.ppea2_tipo==="file"&&p.ppea2_arquivo2&&o.append("ppea2",p.ppea2_arquivo2),r.programa_estadual_tipo==="file"&&p.programa_estadual_arquivo2&&o.append("programa_estadual",p.programa_estadual_arquivo2),r.plano_estadual_tipo==="file"&&p.plano_estadual_arquivo2&&o.append("plano_estadual",p.plano_estadual_arquivo2);const s=_("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let u,n;u="put",n=`${d}commission/${a}/draft`,o.set("entity",JSON.stringify(r));const{data:t}=await B({method:u,url:n,data:o,config:{headers:{"Content-Type":"multipart/form-data"}}});c.invalidateQueries("commission_info"),g(s),_("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(u){g(s),console.error(u),_("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return e.jsx(e.Fragment,{children:r&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(J,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:C,children:[e.jsx(j,{}),"Gravar"]})})]}),e.jsx(ae,{form:G,view:ke,lists:ye,data:r,onDataChange:h,onRemoveIterative:v,onAddIterative:x}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:C,children:[e.jsx(j,{}),"Gravar"]})})]})]})})})})})}var Ae={exports:{}};(function(a,d){(function(c,_){a.exports=_($)})(O,function(c){function _(m){return m&&typeof m=="object"&&"default"in m?m:{default:m}}var g=_(c),f={name:"pt-br",weekdays:"domingo_segunda-feira_terça-feira_quarta-feira_quinta-feira_sexta-feira_sábado".split("_"),weekdaysShort:"dom_seg_ter_qua_qui_sex_sáb".split("_"),weekdaysMin:"Do_2ª_3ª_4ª_5ª_6ª_Sá".split("_"),months:"janeiro_fevereiro_março_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),monthsShort:"jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),ordinal:function(m){return m+"º"},formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY [às] HH:mm",LLLL:"dddd, D [de] MMMM [de] YYYY [às] HH:mm"},relativeTime:{future:"em %s",past:"há %s",s:"poucos segundos",m:"um minuto",mm:"%d minutos",h:"uma hora",hh:"%d horas",d:"um dia",dd:"%d dias",M:"um mês",MM:"%d meses",y:"um ano",yy:"%d anos"}};return g.default.locale(f,null,!0),f})})(Ae);const he=a=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-trash",...a},i.createElement("polyline",{points:"3 6 5 6 21 6"}),i.createElement("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})),ve=a=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-edit-2",...a},i.createElement("path",{d:"M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"})),be=a=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-x",...a},i.createElement("line",{x1:18,y1:6,x2:6,y2:18}),i.createElement("line",{x1:6,y1:6,x2:18,y2:18})),fe=a=>i.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round",className:"feather feather-save",...a},i.createElement("path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"}),i.createElement("polyline",{points:"17 21 17 13 7 13 7 21"}),i.createElement("polyline",{points:"7 3 7 8 15 8"})),Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAZEAAAGRCAYAAACkIY5XAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAGXRFWHRTb2Z0d2FyZQB3d3cuaW5rc2NhcGUub3Jnm+48GgAABZtJREFUeJzt1UENACAQwDDAv+fDwz6EpFWw3/bMzAKA4LwOAOBfJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQGYiAGQmAkBmIgBkJgJAZiIAZCYCQHYBGSAHHiuWzmAAAAAASUVORK5CYII=",xe="_vcentered_h38s2_1",Ye="_add_h38s2_6",Be="_action_h38s2_7",Ie="_timeline_h38s2_33",Ge="_highlight_h38s2_36",Qe="_each_h38s2_40",ze="_date_h38s2_49",Je="_text_h38s2_52",Ze="_thumb_h38s2_58",qe="_buttons_h38s2_81",we="_editing_h38s2_86",k={vcentered:xe,add:Ye,action:Be,timeline:Ie,highlight:Ge,each:Qe,date:ze,text:Je,thumb:Ze,"thumb-image":"_thumb-image_h38s2_62",buttons:qe,editing:we,"edit-buttons":"_edit-buttons_h38s2_92"};function je({entityId:a}){const{server:d}=Q(),c=Z(),[_,g]=i.useState([]),[f,m]=i.useState(null),[r,y]=i.useState(null),[p,A]=i.useState(null),[l,h]=i.useState(null),{data:v}=w(["commission_timeline",{entityId:a}],{queryFn:async()=>(await B.get(`${d}commission/${a}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),x=M(t=>B.delete(`${d}commission/${a}/draft/timeline/${t}`),{onSuccess:()=>c.invalidateQueries("commission_timeline")});i.useEffect(()=>{v&&g(v)},[v]),i.useEffect(()=>{r&&setTimeout(()=>{const t=document.getElementById(`timeline_${r}`);t&&(t.scrollIntoView({block:"end",inline:"nearest"}),A(r),y(null),setTimeout(()=>A(null),2e3))},10)},[_,r]);const C=t=>()=>{m(t)},o=t=>()=>{const b=_.find(Y=>Y.id===t);b&&h(b)},s=async t=>{t==="confirm"&&await x.mutateAsync(f),m(null)},u=()=>{h(null)},n=()=>{h(null)};return e.jsx(e.Fragment,{children:_&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(J,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${k["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(D,{entityId:a,editing:l,onHighlight:y,add:!0,onSave:n})})})}),e.jsx(J,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:k.timeline,children:!!v&&_.map(t=>e.jsxs(i.Fragment,{children:[(l==null?void 0:l.id)!==t.id&&e.jsxs("div",{id:`timeline_${t.id}`,className:`${k.each} ${p===t.id?k.highlight:""}`,children:[e.jsxs("div",{className:k.date,children:[" ",e.jsx("span",{className:k.text,children:R(t.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:k.thumb,children:e.jsxs("div",{className:k["thumb-image"],children:[!!t.timeline_arquivo&&e.jsx("img",{src:t.timeline_arquivo,alt:"imagem de timeline"}),!t.timeline_arquivo&&e.jsx("img",{src:Ce,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:k.text,children:t.texto}),e.jsxs("div",{className:k.buttons,children:[e.jsx("button",{className:k.action,onClick:o(t.id),disabled:!!l,children:e.jsx(ve,{})}),(l==null?void 0:l.id)!==t.id&&e.jsx("button",{className:k.action,onClick:C(t.id),disabled:!!l,children:e.jsx(he,{})})]})]}),(l==null?void 0:l.id)===t.id&&e.jsx(D,{entityId:a,editing:l,onHighlight:y,onCancel:u,onSave:n})]},t.id))})})})})]}),e.jsx(se,{open:!!f,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:s})]})})}function D({add:a,entityId:d,editing:c,onHighlight:_,onCancel:g,onSave:f}){const{enqueueSnackbar:m,closeSnackbar:r}=q(),{server:y}=Q(),p=Z(),[A,l]=i.useState(new Date),[h,v]=i.useState(null),[x,C]=i.useState(null),[o,s]=i.useState(null);i.useEffect(()=>{a?(l(new Date),s(null)):(l(c.date),s(c.texto),v({url:c.timeline_arquivo}))},[c]);const u=t=>{v(t||"remove"),C(t==null?void 0:t.file)},n=async()=>{if(!o||!o.length)return;let t=new FormData;x&&t.append("imagem",x);const b=m("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let Y,z;a?(Y="post",z=`${y}commission/${d}/draft/timeline`):(Y="put",z=`${y}commission/${d}/draft/timeline/${c.id}`),t.set("entity",JSON.stringify({date:A,texto:o,timeline_arquivo:h}));const{data:L}=await B({method:Y,url:z,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});_(L.id),l(new Date),s(null),v(null),C(null),f(),p.invalidateQueries("commission_timeline"),r(b),m("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(Y){r(b),console.error(Y),m("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!a&&c?k.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${k.vcentered}`,children:e.jsx(ie,{className:"input-datepicker",label:"Mês",value:A||"",onChange:l,views:["month","year"],inputFormat:"MM/yyyy",disabled:a&&!!c})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(oe,{onChange:u,url:h==null?void 0:h.url,alt:"imagem",title:"Imagem",disabled:a&&!!c,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(F,{className:"input-text",label:"Texto",value:o||"",onChange:t=>s(t.target.value),multiline:!0,rows:4,disabled:a&&!!c})}),e.jsxs("div",{className:`col-xs-1 ${k.vcentered}`,children:[a&&e.jsx("button",{className:k.add,onClick:n,disabled:a&&!!c,children:e.jsx(ne,{})}),!a&&e.jsxs("div",{className:k["edit-buttons"],children:[e.jsx("button",{className:k.add,onClick:n,children:e.jsx(fe,{})}),e.jsx("button",{className:k.add,onClick:g,children:e.jsx(be,{})})]})]})]})}const Ne="_button_delete_lccbr_45",Ee="_Roll_lccbr_1",Se="_term_lccbr_82",Te={button_delete:Ne,Roll:Ee,term:Se},tt=()=>{const{currentCommunity:a,changeRoute:d,params:c}=H(),{server:_}=Q(),{user:g,updateUser:f}=P(),{enqueueSnackbar:m,closeSnackbar:r}=q(),[y,p]=i.useState(null),[A,l]=i.useState(null),[h,v]=i.useState(!1),[x,C]=i.useState(!1),{data:o}=w(["commission",{currentCommunity:a.id}],{queryFn:async()=>(await B.get(`${_}commission/id_from_community/${a.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),s={publish:M(()=>B.put(`${_}commission/${y}/publish`))};i.useEffect(()=>{C(g.membership.map(t=>t.id===1||t.id===a.id&&t.type==="adm").reduce((t,b)=>t||b))},[x,g,a]),i.useEffect(()=>{o&&p(o.id)},[o]),i.useEffect(()=>{l(c&&c.length?c[0]:"informacao")},[c]);const u=t=>{t==="confirm"&&n(),v(!1)},n=async()=>{const t=m("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:b}=await s.publish.mutateAsync();if(r(t),b.success)window.location=`${window.location}`,m("Comissão publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(b.reason.code==="not_ready")m(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta comissão ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(b){r(t),console.error(b),m("Erro ao publicar a comissão!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(re,{title:"Comissão"}),e.jsx("div",{className:"page-header-buttons"})]}),A&&e.jsxs(e.Fragment,{children:[e.jsx(_e,{defaultTab:A,onTabChange:t=>d({params:[t]})}),y&&e.jsxs(e.Fragment,{children:[A==="informacao"&&e.jsx(ge,{entityId:y}),A==="linha_tempo"&&e.jsx(je,{entityId:y})]})]}),e.jsx(W,{display:"flex",justifyContent:"space-between"}),e.jsx(De,{open:h,onClose:u})]})};function De({open:a,onClose:d}){return e.jsx("div",{children:e.jsxs(V,{open:a,onClose:d,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(U,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(N,{children:e.jsx(N,{id:"alert-dialog-description",className:Te.term,children:e.jsx("p",{children:"TODO TODO TODO"})})}),e.jsxs(K,{children:[e.jsx("button",{className:"button-primary",onClick:()=>d("confirm"),children:"Concordo"}),e.jsx(X,{onClick:()=>d("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{tt as default};
