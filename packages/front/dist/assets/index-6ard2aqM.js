import{a as ee,r as a,j as e,u as I,d as Y,c as K,e as B,C as G,J as ve,$ as te,L as fe,N as _e,v as ie,O as ge,n as j,f as Z,x as we,w as Ee,U as ze,T as ne,b as ae,a0 as X,o as Oe,D as oe,k as re,l as V,m as le,B as be,i as Fe,S as Te,M as se,P as qe,A as Re}from"./index-DLt25zcS.js";import{C as ce}from"./index-Bha5MrYE.js";import{T as De,a as L}from"./Tabs-BURW5nwB.js";import{n as Ae,S as Pe,a as Me,b as Ge,c as Be}from"./no_thumb-BtmO3-w3.js";import{P as Ie}from"./plus-B_5SJsXG.js";import{E as xe}from"./CheckCircle-DswnPI8a.js";import{i as Qe,g as We,a as Ke,b as He,c as Ue,d as Le,E as Je}from"./indicsTree-CbQzdjjY.js";import{q as Ve}from"./styled-components.browser.esm-BtHF474-.js";import{S as Ye,M as Xe}from"./index-DFUGF19k.js";import{A as Ze}from"./index-hVwkNHIF.js";import{D as de}from"./Download-Cw4RWD-J.js";import{B as ea}from"./Box-BoG2D6P7.js";import"./KeyboardArrowRight-B-_qEmRL.js";import"./_baseIteratee-BNFwsDK1.js";const aa="_backdrop_1cgck_52",ta="_indicator_1cgck_85",sa="_warning_1cgck_106",ia="_ready_1cgck_109",na="_divisor_1cgck_146",oa="_cleanfilters_1cgck_152",O={"projects-tabs":"_projects-tabs_1cgck_45",backdrop:aa,"ptabs-content":"_ptabs-content_1cgck_72","ptabs-tabs":"_ptabs-tabs_1cgck_79",indicator:ta,"fixed-size":"_fixed-size_1cgck_85","not-ready":"_not-ready_1cgck_103",warning:sa,ready:ia,"ptabs-actions":"_ptabs-actions_1cgck_119","ptabs-datefilter":"_ptabs-datefilter_1cgck_124","ptabs-datefilter-button":"_ptabs-datefilter-button_1cgck_134",divisor:na,cleanfilters:oa};function ra({defaultTab:s,onTabChange:i,analysis:n}){ee();const[l,N]=a.useState(!1),[v,d]=a.useState(!1),[p,b]=a.useState(!1),[C,S]=a.useState(!1),[r,m]=a.useState(0),[o,g]=a.useState(0),w=f=>{i(f.target.id)};return a.useEffect(()=>{if(!n)return;let f=0;const _=Object.filter=(t,z)=>Object.keys(t).filter(h=>(z(t[h])&&f++,z(t[h]))).reduce((h,k)=>(h[k]=t[k],h),{});_(n.analysis.indics,t=>t.ready===!1),m(f),f=0;const x=_(n.analysis.information,t=>t===!1);g(f),N((t=>Object.keys(t).length===0)(x)),b(Object.values(n.analysis.indics).reduce((t,z)=>z.ready?t:!1,!0)),S(n.analysis.geo),d(n.analysis.connections)},[n]),e.jsxs("div",{className:O["projects-tabs"],children:[e.jsx("div",{className:O.backdrop}),e.jsx("div",{className:O["ptabs-content"],children:e.jsxs(De,{className:O["ptabs-tabs"],onChange:w,value:s,children:[e.jsx(L,{disableRipple:!0,label:"Cadastro",...J("informacao",o>0?o:""),className:`${O.indicator} ${l?O.ready:O["not-ready"]} ${o<10&&O["fixed-size"]}`}),e.jsx(L,{disableRipple:!0,label:"Abrangência",className:`${O.indicator} ${C?O.ready:O["not-ready"]} ${O["fixed-size"]}`,...J("abrangencia",C?"":"1")}),e.jsx(L,{disableRipple:!0,label:"Indicadores",...J("indicadores_novos",r>0?r:""),className:`${O.indicator} ${p?O.ready:O["not-ready"]} ${r<10&&O["fixed-size"]}`}),e.jsx(L,{disableRipple:!0,label:"Conexões",...J("conexoes")}),e.jsx(L,{disableRipple:!0,label:"Linha do tempo",...J("timeline")})]})})]})}function J(s,i=""){return{id:s,"aria-controls":`simple-tabpanel-${s}`,value:s,"data-problems":i}}const la=[{type:"row",block:"ppea",elements:[{type:"row",elements:[{type:"column",size:12,key:"nome"},{type:"column",size:12,key:"tema"}]},{type:"row",elements:[{type:"column",size:12,key:"objetivos"},{type:"column",size:12,key:"resumo"},{type:"column",size:6,key:"link"},{type:"column",size:6,key:"ufs"}]},{type:"row",elements:[{type:"column",size:6,key:"data_inicio"},{type:"column",size:6,key:"data_fim"}]},{type:"row",elements:[{type:"column",size:12,key:"publicos"},{type:"column",size:12,key:"financiadores"}]}]},{type:"row",block:"inst",elements:[{type:"column",size:12,key:"instituicao_nome"},{type:"column",size:6,key:"instituicao_segmento"},{type:"column",size:6,key:"instituicao_porte"},{type:"column",size:12,key:"instituicao_link"}]},{type:"row",block:"responsavel_list",elements:[{type:"row",block:"responsavel_items",elements:[{type:"column",size:5,key:"responsavel_nome"},{type:"column",size:5,key:"responsavel_cargo"},{type:"column",size:5,key:"responsavel_telefone"},{type:"column",size:5,key:"responsavel_email"},{type:"column",size:2,elements:[{type:"remove"}]}]},{type:"add",block:"responsavel_items",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar responsável"}]}]}]}]}],ue={lists:[{key:"tema",options:[{value:1,label:"Educação ambiental"},{value:2,label:"Ciências naturais"},{value:3,label:"Resíduos sólidos"},{value:4,label:"Educomunicação"},{value:5,label:"Legislação socioambiental"},{value:6,label:"Gestão ambiental"},{value:7,label:"Áreas protegidas"},{value:8,label:"Pesca"},{value:9,label:"Recursos hídricos"},{value:10,label:"Turismo"},{value:11,label:"Desenvolvimento e economia sustentável"},{value:12,label:"Comunidades tradicionais"},{value:13,label:"Patrimônio histórico cultural"},{value:14,label:"Agroecologia"},{value:15,label:"Agricultura familiar"},{value:16,label:"Mudanças climáticas"},{value:17,label:"Políticas públicas"},{value:18,label:"Gênero"}]},{key:"publicos",options:[{value:1,label:"Crianças - até 15 anos"},{value:2,label:"Jovens - Entre 15 e 29 anos"},{value:3,label:"Educadores"},{value:4,label:"Gestores"},{value:5,label:"Sociedade Civil"},{value:6,label:"Turistas"},{value:7,label:"Comunidade escolar"},{value:8,label:"Comunidade local"},{value:9,label:"Comunidades tradicionais"}]}]};function ca({entityId:s,problems:i}){const{server:n}=I(),{user:l}=ee(),N=Y(),{enqueueSnackbar:v,closeSnackbar:d}=K(),[p,b]=a.useState([]),[C,S]=a.useState({}),[r,m]=a.useState({}),{data:o}=B(["iniciatives_info",{entityId:s}],{queryFn:async()=>(await j.get(`${n}iniciativa/${s}/draft/info`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:g}=B(["content_for_form_cad"],{queryFn:async()=>(await j.get(`${n}content/for_form/ing/ing/info`)).data,retry:!1,refetchOnWindowFocus:!1});a.useEffect(()=>{o&&m(o)},[o]);const w=(_,x)=>{b(_),S(x)},f=async()=>{const _=ge(te,p,C),x=v("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let y,t;y="put",t=`${n}iniciativa/${s}/draft`,await j({method:y,url:t,data:_,config:{headers:{"Content-Type":"multipart/form-data"}}}),N.invalidateQueries("iniciatives_info"),N.invalidateQueries("iniciatives_analysis"),d(x),v("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(y){d(x),console.error(y),v("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return o?e.jsx(e.Fragment,{children:p&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(G,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsx(ve,{form:te,view:la,lists:ue,data:fe(r,te,ue),problems:i,onDataChange:w,helpbox:{isADM:l.membership.find(_=>_.id===_e),content:g,prefix:"ing.",type:"info"}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:f,children:[e.jsx(ie,{}),"Gravar"]})})]})]})})})})}):e.jsx(e.Fragment,{})}function da({entityId:s}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(G,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:"[CONEXÕES]"})})})})})}const ua="_vcentered_1g64r_1",ma="_add_1g64r_6",ha="_action_1g64r_7",pa="_timeline_1g64r_33",va="_highlight_1g64r_36",fa="_each_1g64r_40",_a="_date_1g64r_49",ga="_text_1g64r_52",ba="_thumb_1g64r_58",xa="_buttons_1g64r_81",ya="_editing_1g64r_86",E={vcentered:ua,add:ma,action:ha,timeline:pa,highlight:va,each:fa,date:_a,text:ga,thumb:ba,"thumb-image":"_thumb-image_1g64r_62",buttons:xa,editing:ya,"edit-buttons":"_edit-buttons_1g64r_92"};function ja({entityId:s}){const{server:i}=I(),n=Y(),[l,N]=a.useState([]),[v,d]=a.useState(null),[p,b]=a.useState(null),[C,S]=a.useState(null),[r,m]=a.useState(null),{data:o}=B(["iniciative_timeline",{entityId:s}],{queryFn:async()=>(await j.get(`${i}iniciativa/${s}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),g=Z(t=>j.delete(`${i}iniciativa/${s}/draft/timeline/${t}`),{onSuccess:()=>n.invalidateQueries("iniciative_timeline")});a.useEffect(()=>{o&&N(o)},[o]),a.useEffect(()=>{p&&setTimeout(()=>{const t=document.getElementById(`timeline_${p}`);t&&(t.scrollIntoView({block:"end",inline:"nearest"}),S(p),b(null),setTimeout(()=>S(null),2e3))},10)},[l,p]);const w=t=>()=>{d(t)},f=t=>()=>{const z=l.find(h=>h.id===t);z&&m(z)},_=async t=>{t==="confirm"&&await g.mutateAsync(v),d(null)},x=()=>{m(null)},y=()=>{m(null)};return e.jsx(e.Fragment,{children:l&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(G,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsxs("section",{id:"details",children:["A linha do tempo é uma ferramenta para a apresentação e o registro dos principais marcos/eventos da iniciativa. Insira o mês/ano em que o marco/evento aconteceu, uma imagem ilustrativa (pode ser uma fotografia real ou um ícone/desenho) e um texto descritivo. A ferramenta organiza automaticamente a apresentação dos marcos/eventos em ordem cronológica.",e.jsx("br",{}),"Alguns exemplos de marcos/eventos: criação da iniciativa, realização de atividades relevantes, eventos públicos, publicação de normativas, relatórios, materiais educomunicativos, etc."]})})}),e.jsx(G,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${E["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(me,{entityId:s,editing:r,onHighlight:b,add:!0,onSave:y})})})}),e.jsx(G,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:E.timeline,children:!!o&&l.map(t=>e.jsxs(a.Fragment,{children:[(r==null?void 0:r.id)!==t.id&&e.jsxs("div",{id:`timeline_${t.id}`,className:`${E.each} ${C===t.id?E.highlight:""}`,children:[e.jsxs("div",{className:E.date,children:[" ",e.jsx("span",{className:E.text,children:we(t.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:E.thumb,children:e.jsxs("div",{className:E["thumb-image"],children:[!!t.timeline_arquivo&&e.jsx("img",{src:t.timeline_arquivo,alt:"imagem de timeline"}),!t.timeline_arquivo&&e.jsx("img",{src:Ae,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:E.text,children:t.texto}),e.jsxs("div",{className:E.buttons,children:[e.jsx("button",{className:E.action,onClick:f(t.id),disabled:!!r,children:e.jsx(Pe,{})}),(r==null?void 0:r.id)!==t.id&&e.jsx("button",{className:E.action,onClick:w(t.id),disabled:!!r,children:e.jsx(Me,{})})]})]}),(r==null?void 0:r.id)===t.id&&e.jsx(me,{entityId:s,editing:r,onHighlight:b,onCancel:x,onSave:y})]},t.id))})})})})]}),e.jsx(ce,{open:!!v,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:_})]})})}function me({add:s,entityId:i,editing:n,onHighlight:l,onCancel:N,onSave:v}){const{enqueueSnackbar:d,closeSnackbar:p}=K(),{server:b}=I(),C=Y(),[S,r]=a.useState(new Date),[m,o]=a.useState(null),[g,w]=a.useState(null),[f,_]=a.useState(null);a.useEffect(()=>{s?(r(new Date),_(null)):(r(n.date),_(n.texto),o({url:n.timeline_arquivo}))},[n]);const x=t=>{o(t||"remove"),w(t==null?void 0:t.file)},y=async()=>{if(!f||!f.length)return;let t=new FormData;g&&t.append("imagem",g);const z=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let h,k;s?(h="post",k=`${b}iniciativa/${i}/draft/timeline`):(h="put",k=`${b}iniciativa/${i}/draft/timeline/${n.id}`),t.set("entity",JSON.stringify({date:S,texto:f,timeline_arquivo:m}));const{data:P}=await j({method:h,url:k,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});l(P.id),r(new Date),_(null),o(null),w(null),v(),C.invalidateQueries("iniciative_timeline"),p(z),d("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(h){p(z),console.error(h),d("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!s&&n?E.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${E.vcentered}`,children:e.jsx(Ee,{className:"input-datepicker",label:"Mês",value:S||"",onChange:r,views:["month","year"],inputFormat:"MM/yyyy",disabled:s&&!!n})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(ze,{onChange:x,url:m==null?void 0:m.url,alt:"imagem",title:"Imagem",disabled:s&&!!n,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(ne,{className:"input-text",label:"Texto",value:f||"",onChange:t=>_(t.target.value),multiline:!0,rows:4,disabled:s&&!!n})}),e.jsxs("div",{className:`col-xs-1 ${E.vcentered}`,children:[s&&e.jsx("button",{className:E.add,onClick:y,disabled:s&&!!n,children:e.jsx(Ie,{})}),!s&&e.jsxs("div",{className:E["edit-buttons"],children:[e.jsx("button",{className:E.add,onClick:y,children:e.jsx(Ge,{})}),e.jsx("button",{className:E.add,onClick:N,children:e.jsx(Be,{})})]})]})]})}const Na="_error_y2a6h_45",Ca="_done_y2a6h_50",Sa="_indic_y2a6h_55",ka="_selected_y2a6h_59",$a="_field_y2a6h_63",wa="_title_box_y2a6h_66",Ea="_tree_y2a6h_81",za="_li_lae_titles_y2a6h_92",Oa="_show_y2a6h_96",Fa="_fade_in_show_y2a6h_1",Ta="_hide_y2a6h_111",qa="_li_indicators_y2a6h_114",Ra="_strong_y2a6h_125",Da="_actions_y2a6h_151",Aa="_helpbox_button_y2a6h_157",Pa="_button_delete_y2a6h_164",Ma="_Roll_y2a6h_1",D={error:Na,done:Ca,indic:Sa,selected:ka,field:$a,title_box:wa,tree:Ea,li_lae_titles:za,show:Oa,fade_in_show:Fa,hide:Ta,li_indicators:qa,"item-container":"_item-container_y2a6h_118",strong:Ra,"indic-header":"_indic-header_y2a6h_137",actions:Da,helpbox_button:Aa,button_delete:Pa,Roll:Ma};function Ga({entityId:s,analysis:i,problems:n}){const{server:l}=I(),{currentCommunity:N,changeRoute:v,params:d}=ae(),{user:p}=ee(),b=Y(),{enqueueSnackbar:C,closeSnackbar:S}=K(),[r,m]=a.useState(null),[o,g]=a.useState(null),[w,f]=a.useState(null),[_,x]=a.useState(null),[y,t]=a.useState(null),[z,h]=a.useState(!1),[k,P]=a.useState(null),[H,U]=a.useState([]),[u,F]=a.useState([]),[T,M]=a.useState({}),[$,R]=a.useState({}),{data:Q}=B([`iniciative_info_${o}`,{entityId:s}],{queryFn:async()=>(await j.get(`${l}iniciativa/${s}/draft/indicadores/${o}`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1}),{data:je}=B([`content_for_form_${o}`],{queryFn:async()=>(await j.get(`${l}content/for_form/ing/${o}/indic`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1});a.useEffect(()=>{Q&&R(Q)},[Q]),a.useEffect(()=>{i&&m(Qe(i))},[i]),a.useEffect(()=>{U(n)},[n]),a.useEffect(()=>{d&&d[1]?g(d[1]):g("1_1")},[d]),a.useEffect(()=>{if(o&&Q){const c=o.split("_")[0];f(c);const q=r.find(W=>W.id===c).indics.find(W=>W.id===o);P(We(X,c,q.id))}},[o,Q]);const Ne=c=>{x(_!==c?c:null)},Ce=(c,A)=>()=>{R({}),x(A),z?t(c):v({params:["indicadores_novos",c]})},Se=async c=>{c==="confirm"&&v({params:["indicadores_novos",y]}),t(null)},ke=(c,A)=>{F(c),M(A)},$e=async()=>{const c=ge(k,u,T);c.set("indic",o);const A=C("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let q,W;q="put",W=`${l}iniciativa/${s}/draft/indicadores/${o}`,await j({method:q,url:W,data:c,config:{headers:{"Content-Type":"multipart/form-data"}}}),b.invalidateQueries(`iniciative_info_${o}`),b.invalidateQueries("iniciatives_analysis"),S(A),C("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(q){S(A),console.error(q),C("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return Q?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-content",children:[e.jsx("div",{className:"page-sidebar",children:e.jsx("div",{className:`sidebar-body ${D.tree}`,children:r&&e.jsx("ul",{children:r.map(c=>{let A=Ke(X,c.id);return e.jsx(a.Fragment,{children:A&&e.jsxs("li",{className:`mb-3 ${D.li_lae_titles}`,onClick:()=>Ne(c.id),children:[e.jsx(he,{title:He(X,c.id),ready:c.ready,className:w===c.id||_===c.id?D.strong:""}),e.jsx("ul",{className:`${w===c.id||_===c.id?D.show:D.hide}`,children:c.indics.map(q=>e.jsx("li",{className:`${D.li_indicators}`,onClick:Ce(q.id,c.id),children:e.jsx(he,{title:Ue(X,c.id,q.id),ready:q.ready,className:`${D.indic} ${o===q.id?D.selected:""}`})},q.id))})]})},c.id)})})})}),e.jsx("div",{className:"page-body",children:e.jsx(G,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[!!k&&e.jsx(ve,{form:k,data:fe($,k),problems:Le(o,H),onDataChange:ke,helpbox:{isADM:p.membership.find(c=>c.id===_e),content:je,prefix:`ing.${o.split("_")[0]}.${o}.`}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:$e,children:[e.jsx(ie,{}),"Gravar"]})})]})]})})})]}),e.jsx(ce,{open:!!y,content:"Você deseja sair do indicador sem salvar as alterações?",confirmButtonText:"Confirmar",onClose:Se})]}):e.jsx(e.Fragment,{})}function he({title:s,ready:i,className:n}){let l=i?e.jsx(xe,{}):e.jsx(Je,{});return e.jsxs("div",{className:`${D["item-container"]} ${n}`,children:[e.jsx("div",{className:`${D[i?"done":"error"]}`,children:l}),e.jsx("div",{children:s})]})}function Ba({tab:s}){const{enqueueSnackbar:i,closeSnackbar:n}=K(),{server:l}=I(),{currentCommunity:N}=ae(),[v,d]=a.useState(!1),[p,b]=a.useState(""),[C,S]=a.useState(!1),[r,m]=a.useState({});a.useEffect(()=>{b(""),d(!1),m({})},[]);const o={request:Z(()=>j.post(`${l}help/request`,{communityId:N.id,tab:s,text:p}))},g=()=>{d(!0)},w=async()=>{let f=!1,_={};if(p.trim().length===0&&(_.message=!0,f=!0),m(_),f)return;S(!0);const x=i("Enviando pedido de ajuda...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{await o.request.mutateAsync(),n(x),i("Pedido de ajuda enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),d(!1)}catch(y){n(x),console.error(y),i("Erro ao enviar pedido de ajuda!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginRight:"5px"},children:e.jsx(Oe,{title:"Pedir ajuda",children:e.jsxs("button",{className:"button-outline",disabled:C,onClick:g,children:[e.jsx(Ye,{}),"Pedir ajuda sobre esta aba"]})})}),e.jsxs(oe,{open:v,onClose:()=>d(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"sm",children:[e.jsx(re,{id:"alert-dialog-title",children:"Envio de pedido de ajuda"}),e.jsx(V,{id:"alert-dialog-description",children:e.jsx("p",{className:"pt-1 px-3 pb-3",children:e.jsx(ne,{label:"Preencha este campo com sua dúvida",className:"input-text",value:p,onChange:f=>b(f.target.value),multiline:!0,rows:8,error:r.message})})}),e.jsxs(le,{children:[e.jsx("button",{className:"button-primary",onClick:w,children:"Enviar"}),e.jsx(be,{onClick:()=>d(!1),autoFocus:!0,children:"Cancelar"})]})]})]})}async function pe(s,i){const{data:{geoms:n,bbox:l}}=await j.get(`${s}iniciativa/${i}/geo-draw`);return console.log({geoms:n,bbox:l}),{geoms:n,bbox:l}}function Ia(){const s=Y(),{server:i}=I(),{currentCommunity:n}=ae(),{enqueueSnackbar:l,closeSnackbar:N}=K(),[v,d]=a.useState(null),[p,b]=a.useState(null),[C,S]=a.useState(""),[r,m]=a.useState(!1),[o,g]=a.useState(null),[w,f]=a.useState(!1);a.useEffect(()=>{async function u(){const{data:{id:F}}=await j.get(`${i}iniciativa/id_from_community/${n.id}`);d(F)}u()},[n.id,i]);const[_,x]=a.useState(null),[y,t]=a.useState(null);a.useEffect(()=>{async function u(){const{data:{atuacao_aplica:F,atuacao_naplica_just:T,ufs:M}}=await j.get(`${i}iniciativa/${v}/geo-draw/has-geo`);b(F),S(T||""),g(M)}v&&u()},[v,i]),a.useEffect(()=>{async function u(){const{geoms:F,bbox:T}=await pe(i,v);x(F),T[0][0]&&t(T)}p&&u()},[p,v,i]);const z=async()=>{const u=l("Voltando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{geoms:F,bbox:T}=await pe(i,v);x(F),T[0][0]&&t(T),N(u),m(!1)},h=async u=>{const F=u.features.map(({geometry:$})=>$),T=l("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{data:M}=await j.post(`${i}iniciativa/${v}/geo-draw`,{geoms:F});g(M.ufs),N(T),l("Atuação gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})},k=async u=>{console.log({checked:u});const F=l("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await j.put(`${i}iniciativa/${v}/geo-draw/${u?u==="none"?"none":"1":"0"}`),s.invalidateQueries("iniciatives_analysis"),N(F),b(u)},P=async()=>{const u=l("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});return await j.put(`${i}iniciativa/${v}/draft/justification`,{value:C}),s.invalidateQueries("iniciatives_analysis"),N(u),!0},H=async()=>{f(!1);const u=l("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await j.put(`${i}iniciativa/${v}/draft/ufs`,{ufs:o}),s.invalidateQueries("iniciatives_info"),N(u)},U=u=>{g(u)};return e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(G,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("div",{className:"col-xs-8",style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{className:"col-xs-5",style:{display:"flex"},children:e.jsx(Ze,{label:"Estados",url:"uf/related",urlSingle:"uf",titleField:"value",onChange:U,value:o,multiple:!0,disabled:!w})}),e.jsxs("div",{className:"col-xs-5",style:{display:"flex"},children:[!w&&e.jsx("button",{className:"button-primary",onClick:()=>f(!0),children:"Alterar estados"}),w&&e.jsx("button",{className:"button-primary",onClick:H,children:"Gravar estados"})]})]}),e.jsx(Ba,{tab:"atuacao"})]}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between"},children:e.jsx("div",{className:"col-xs-12",style:{display:"flex"},children:e.jsxs(Qa,{children:[e.jsx("div",{children:"É possivel representar este projeto de geograficamente?"}),e.jsx(Fe,{children:e.jsxs(Te,{className:"input-select",value:p===null?"none":p,onChange:u=>k(u.target.value),children:[e.jsx(se,{value:"none",children:" -- selecione -- "}),e.jsx(se,{value:!0,children:"Sim"}),e.jsx(se,{value:!1,children:"Não"})]})})]})})}),p===!0&&e.jsx(Xe,{entity:"iniciativa",initialGeoms:_,initialBBOX:y,isEditing:r,onEdit:u=>m(u),onSave:h,onCancel:z}),p===!1&&e.jsxs("section",{id:"details",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title",children:"Justificativa"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:()=>P(),children:[e.jsx(ie,{}),"Gravar"]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(ne,{className:"input-text",value:C||"",onChange:u=>S(u.target.value),multiline:!0,rows:4})})})]})]})})})})}const Qa=Ve.div`
  display: flex;
  margin-bottom: 20px;
  justify-content: end;
  align-items: center;
  div {
    margin-right: 10px;
  }
`,Wa="_button_delete_11779_45",Ka="_Roll_11779_1",Ha="_term_11779_82",ye={button_delete:Wa,Roll:Ka,term:Ha},ct=()=>{const{currentCommunity:s,changeRoute:i,params:n}=ae(),{server:l}=I(),{user:N,updateUser:v}=ee(),{enqueueSnackbar:d,closeSnackbar:p}=K(),[b,C]=a.useState(null),[S,r]=a.useState(!1),[m,o]=a.useState(null),[g,w]=a.useState(null),[f,_]=a.useState(!1),[x,y]=a.useState(!1),[t,z]=a.useState(!1),{data:h}=B(["iniciatives",{currentCommunity:s.id}],{queryFn:async()=>(await j.get(`${l}iniciativa/id_from_community/${s.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:k}=B(["iniciatives_analysis",{policy_id:h==null?void 0:h.id}],{queryFn:async()=>(await j.get(`${l}iniciativa/${h==null?void 0:h.id}/verify`)).data,enabled:!!(h!=null&&h.id),retry:!1,refetchOnWindowFocus:!1}),P={publish:Z(()=>j.put(`${l}iniciativa/${m}/publish`)),remove:Z(()=>j.delete(`${l}iniciativa/${b}`))};a.useEffect(()=>{z(N.membership.map($=>$.id===1||$.id===s.id&&$.type==="adm").reduce(($,R)=>$||R))},[t,N,s]),a.useEffect(()=>{h&&o(h.id)},[h]),a.useEffect(()=>{w(n&&n.length?n[0]:"informacao")},[n]);const H=()=>{y(!0)},U=$=>{$==="confirm"&&T(),y(!1)},u=()=>{C(s.id),r(!0)},F=async $=>{if($==="confirm"){let R=await P.remove.mutateAsync(b);d("Iniciativa deletada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),i({community:R.data}),v()}C(null),r(!1)},T=async()=>{const $=d("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:R}=await P.publish.mutateAsync();if(p($),R.success)window.location=`${window.location}`,d("politica publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(R.reason.code==="not_ready")d(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta politica ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(R){p($),console.error(R),d("Erro ao publicar a politica!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},M=()=>{window.open(`${l}iniciativa/${m}/download`,"_blank")};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(qe,{title:"Iniciativa Não Governamental de Educação Ambiental"}),e.jsxs("div",{className:"page-header-buttons",children:[e.jsxs("button",{className:"button-outline",onClick:M,children:[e.jsx(de,{}),"Baixar CSV"]}),e.jsxs("button",{className:"button-outline",onClick:()=>_(!0),children:[e.jsx(de,{}),"Baixar GEO (Shapefile)"]}),t&&t===!0&&e.jsxs("button",{className:"button-primary",onClick:H,children:[e.jsx(xe,{}),"Publicar"]}),t&&t===!0&&e.jsxs("button",{className:ye.button_delete,onClick:u,children:[e.jsx(Re,{}),"Excluir"]})]})]}),k&&g&&e.jsxs(e.Fragment,{children:[e.jsx(ra,{defaultTab:g,onTabChange:$=>i({params:[$]}),analysis:k}),m&&e.jsxs(e.Fragment,{children:[g==="informacao"&&e.jsx(ca,{entityId:m,problems:Object.keys(k.analysis.information).filter($=>k.analysis.information[$]===!1)}),g==="indicadores_novos"&&e.jsx(Ga,{entityId:m,analysis:k,problems:k.analysis.question_problems}),g==="conexoes"&&e.jsx(da,{entityId:m}),g==="abrangencia"&&e.jsx(Ia,{entityId:m}),g==="timeline"&&e.jsx(ja,{entityId:m})]})]}),e.jsx(ea,{display:"flex",justifyContent:"space-between"}),e.jsx(ce,{open:S,content:"Confirma a remoção desta iniciativa?",confirmButtonText:"Remover",onClose:F}),e.jsx(Ua,{open:f,onClose:()=>_(!1)}),e.jsx(La,{open:x,onClose:U})]})};function Ua({open:s,onClose:i}){return e.jsx("div",{children:e.jsxs(oe,{open:s,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{id:"alert-dialog-title",children:"Aviso"}),e.jsx(V,{children:e.jsx(V,{id:"alert-dialog-description",children:"Este recurso esta em fase de implementação!"})}),e.jsx(le,{children:e.jsx("button",{className:"button-primary",onClick:()=>i("cancel"),autoFocus:!0,children:"Fechar"})})]})})}function La({open:s,onClose:i}){return e.jsx("div",{children:e.jsxs(oe,{open:s,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(re,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(V,{children:e.jsxs(V,{id:"alert-dialog-description",className:ye.term,children:[e.jsx("p",{children:"Declaro estar ciente e de acordo com as diretrizes político-pedagógicas do Sistema MonitoraEA e que reconheço a Plataforma MonitoraEA como um instrumento de gestão de dados das iniciativas de educação ambiental (políticas, projetos, instâncias, entre outros) no Brasil."}),e.jsx("p",{children:"Neste sentido, declaro a adesão ao Sistema MonitoraEA por meio da inserção da iniciativa ora cadastrada na Plataforma MonitoraEA. Declaro que a execução técnica e financeira da referida iniciativa está sob a responsabilidade integral da instituição proponente e, eventualmente, seus parceiros."}),e.jsx("p",{children:"Ainda, declaro concordar com a divulgação pública dos dados da iniciativa ora inserida – por meio da Plataforma MonitoraEA - e assumo a inteira responsabilidade pelo teor e veracidade das informações cadastradas."}),e.jsx("p",{children:"Por fim, declaro meu consentimento com a coleta, uso e tratamento de meus dados pessoais pela ANPPEA, que atuará como gestora de dados, nos termos da Lei 13.709/2018, e que tenho ciência de que poderei solicitar, a qualquer momento, a exclusão de meus dados do banco de dados da Plataforma MonitoraEA, bem como a revogação deste consentimento."})]})}),e.jsxs(le,{children:[e.jsx("button",{className:"button-primary",onClick:()=>i("confirm"),children:"Concordo"}),e.jsx(be,{onClick:()=>i("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{ct as default};
