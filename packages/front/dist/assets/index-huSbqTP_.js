import{u as A,b as B,d as w,c as R,r as i,e as L,f as Q,j as e,P as K,q as V,n as j,D as W,k as H,l as M,T as U,m as G,B as J}from"./index-DLt25zcS.js";import{r as S}from"./index-DQ24o8Cs.js";import{S as X}from"./Search-BuC3Vl68.js";import{B as Y}from"./Box-BoG2D6P7.js";import{T as Z}from"./TableSortLabel-BadkXaU-.js";const ee="_commission_list_1rasy_1",ae="_commission_1rasy_1",te="_name_1rasy_8",ie="_actions_1rasy_11",se="_sent_1rasy_19",re="_action_1rasy_11",d={commission_list:ee,commission:ae,name:te,actions:ie,sent:se,action:re};let _;function he(){const{server:s}=A(),{changeRoute:c}=B(),n=w(),{enqueueSnackbar:t,closeSnackbar:r}=R(),m=V,u=i.useRef(null),[k,F]=i.useState(""),[p,I]=i.useState(""),[v,$]=i.useState("name"),[h,f]=i.useState("asc"),[D,T]=i.useState(0),[y,q]=i.useState(null),[N,x]=i.useState(!1),{data:g}=L(["user_iniciatives_list",{order:v,direction:h}],{queryFn:async()=>(await j.get(`${s}iniciativa/mine?direction=${h}`)).data});i.useEffect(()=>{if(!g)return;let a=[...g.entities];p.trim().length&&(a=a.filter(o=>S(o.name.toLowerCase()).includes(S(p.trim().toLocaleLowerCase())))),T(a.length),q(a)},[g,p]);const z={create:Q(a=>j.post(`${s}iniciativa`,{nome:a}),{onSuccess:()=>{n.invalidateQueries("user_iniciatives_list")}})},E=a=>{v===a?f(h==="asc"?"desc":"asc"):($(a),f("desc"))},C=async(a,o)=>{const l=t("Enviando pedido de participação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{data:b}=await j.post(`${s}iniciativa/${o}/participate`,{isADM:a});r(l),b.success?(t("Seu pedido de participação foi enviado! Uma notificação será enviada, no momento da aprovação",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),n.invalidateQueries("user_iniciatives_list")):b.error==="already_member"?t("Você já é membro deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):b.error==="already_in_list"?t("Você já está na lista de aprovação deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):t("Erro ao enviar seu pedido de participação! Por favor, entre em contato com a administração",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})},O=a=>{F(a.target.value),_&&clearTimeout(_),_=setTimeout(()=>I(a.target.value),500)},P=async a=>{if(!a||!a.length)return;const o=t("Criando a iniciativa..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:l}=await z.create.mutateAsync(a);r(o),t("Iniciativa gravada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),x(!1),window.location=`/colabora/iniciativa/${l.communityId}`}catch(l){r(o),console.error(l),t("Erro ao gravar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page width-limiter tbox-fixed",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(K,{title:"Políticas ("+D+")"}),e.jsx("div",{className:"page-header-buttons",children:e.jsx("button",{className:"button-primary",onClick:()=>x(!0),children:"Nova iniciativa"})})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"tablebox limit-height",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(m,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx(X,{onClick:()=>{var a;return(a=u.current)==null?void 0:a.focus()}}),inputRef:u,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:k,onChange:O})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(ne,{text:"Políticas",column:"name",order:v,direction:h,onClick:E})}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:y&&y.map(a=>e.jsxs("tr",{className:"tbox-row",children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:`tbox-table-actions ${d.actions}`,children:[a.is_requesting&&e.jsx("div",{className:d.sent,children:"Solicitação enviada"}),!a.is_requesting&&e.jsxs(e.Fragment,{children:[a.is_member&&e.jsx(e.Fragment,{children:e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>c({community:a.community_id}),children:"Acessar"})}),!a.is_member&&e.jsxs(e.Fragment,{children:[!a.has_members&&e.jsx("button",{className:`button-outline ${d.action}`,onClick:()=>C(!0,a.id),children:"sou o responsável"}),e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>C(!1,a.id),children:"colaborar"})]})]})]})]},a.id))})]})})]})})}),e.jsx(Y,{display:"flex",justifyContent:"space-between"})]}),e.jsx(oe,{open:!!N,type:N,onCreate:P,onClose:()=>x(!1)})]})}function ne({text:s,column:c,order:n,direction:t,onClick:r}){return e.jsx(e.Fragment,{children:e.jsx(Z,{className:"tbox-table-sortlabel",active:n===c,direction:t==="desc"?"asc":"desc",onClick:()=>r(c),children:s})})}function oe({open:s,type:c,onCreate:n,onClose:t}){const[r,m]=i.useState("");return i.useEffect(()=>{s&&m("")},[s]),e.jsx("div",{children:e.jsxs(W,{open:s,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(H,{id:"alert-dialog-title",children:"Nova iniciativa de não governamental"}),e.jsx(M,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(U,{className:"input-text",label:"Nome da nova iniciativa",value:r,onChange:u=>m(u.target.value)})})})}),e.jsxs(G,{children:[e.jsx(J,{onClick:()=>t(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>n(r),children:"Criar"})]})]})})}export{he as default};
