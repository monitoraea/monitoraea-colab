import{u as Q,b as M,c as W,r as s,d as K,a as U,e as X,f as S,j as e,P as H,o as J,p as V,A as Y,D as Z,k as ee,l as te,T as ae,m as se,B as ie,q as oe,n as b,s as re}from"./index-DLt25zcS.js";import{C as ne}from"./index-Bha5MrYE.js";import{S as ce}from"./Search-BuC3Vl68.js";import{E as le}from"./Eye-r5Ro5whN.js";import{r as w}from"./index-DQ24o8Cs.js";import{s as de}from"./FreeMultiple.module-Bw9cwhhu.js";import{B as ue}from"./Box-BoG2D6P7.js";import{T as me}from"./TableSortLabel-BadkXaU-.js";const Ce=()=>{const{server:i}=Q(),{currentCommunity:a,changeRoute:n}=M(),{enqueueSnackbar:o,closeSnackbar:r}=W(),u=s.useRef(null),f=K(),[_,$]=s.useState([]),[D,B]=s.useState(0),[m,R]=s.useState(""),[c,A]=s.useState("name"),[l,y]=s.useState("asc"),[T,C]=s.useState(null),[I,N]=s.useState(!1),{user:k}=U(),[P,x]=s.useState(!1),[p,E]=s.useState(!1),O=oe,{data:h}=X(["communities_list",{currentCommunity:a.id,order:c,direction:l}],{queryFn:async()=>(await b.get(`${i}gt/${a.id}/?alias=${a.alias.trim()}&order=${c}&direction=${l}`)).data}),F={create:S(t=>b.post(`${i}project/?communityId=${a.id}`,{nome:t}),{onSuccess:()=>{f.invalidateQueries("communities_list")}})},q={remove:S(t=>b.delete(`${i}${re[a.perspective]}/${t}`),{onSuccess:()=>f.invalidateQueries("communities_list")})};s.useEffect(()=>{if(!h)return;B(h.total);let t=[...h.entities];m.trim().length&&(t=t.filter(d=>w(d.name.toLowerCase()).includes(w(m.trim().toLocaleLowerCase())))),$(t)},[h,m]),s.useEffect(()=>{E(k.membership.map(t=>t.id===1||t.id===a.id&&t.type==="adm").reduce((t,d)=>t||d))},[p,k,a]);const j=t=>{c===t?y(l==="asc"?"desc":"asc"):(A(t),y("desc"))},L=async t=>{if(!t||!t.length)return;const d=o("Criando a Iniciativa..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:v}=await F.create.mutateAsync(t);r(d),o("Iniciativa gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),x(!1),window.location=`/colabora/projeto/${v.communityId}`}catch(v){r(d),console.error(v),o("Erro ao gravar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},G=t=>{C(t),N(!0)},z=async t=>{t==="confirm"&&(await q.remove.mutateAsync(T),o("Iniciativa deletada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})),C(null),N(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page width-limiter tbox-fixed",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(H,{title:"Grupos de trabalho ("+D+")"}),e.jsxs("div",{className:"page-header-buttons",children:[a.id===1&&e.jsx("button",{className:"button-primary",onClick:()=>x(!0),children:"Nova iniciativa"}),a.id===1&&e.jsx("button",{className:"button-outline",onClick:()=>window.open(`${i}project/spreadsheet/published`,"_blank"),children:"Baixar planilha (publicados)"}),a.id===1&&e.jsx("button",{className:"button-outline",onClick:()=>window.open(`${i}project/spreadsheet/draft`,"_blank"),children:"Baixar planilha (rascunhos)"})]})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"tablebox limit-height",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(O,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx(ce,{onClick:()=>{var t;return(t=u.current)==null?void 0:t.focus()}}),inputRef:u,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:m,onChange:t=>R(t.target.value)})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(g,{text:"Grupos de trabalho",column:"name",order:c,direction:l,onClick:j})}),a.alias.trim()==="adm"&&e.jsx("th",{children:e.jsx(g,{text:"Perspectiva",column:"perspectiveName",order:c,direction:l,onClick:j})}),e.jsx("th",{children:e.jsx(g,{text:"Tipo",column:"typeName",order:c,direction:l,onClick:j})}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:_.map(t=>e.jsxs("tr",{className:"tbox-row",children:[e.jsx("td",{children:t.name}),a.alias.trim()==="adm"&&e.jsx("td",{children:t.pespectiveName}),e.jsx("td",{children:t.typeName}),e.jsxs("td",{className:"tbox-table-actions",children:[e.jsx("div",{onClick:()=>n({community:t.id}),children:e.jsx(le,{})}),e.jsx("div",{className:de["svg-icon-box"],children:p&&p===!0&&e.jsx(J,{title:"Remover",children:e.jsx(V,{onClick:()=>G(t.id),children:e.jsx(Y,{})})})})]})]},t.id))})]})})]})})}),e.jsx(ue,{display:"flex",justifyContent:"space-between"}),e.jsx(ne,{open:I,content:"Confirma a remoção desta iniciativa?",confirmButtonText:"Remover",onClose:z})]}),e.jsx(he,{open:P,onCreate:L,onClose:()=>x(!1)})]})};function g({text:i,column:a,order:n,direction:o,onClick:r}){return e.jsx(e.Fragment,{children:e.jsx(me,{className:"tbox-table-sortlabel",active:n===a,direction:o==="desc"?"asc":"desc",onClick:()=>r(a),children:i})})}function he({open:i,onCreate:a,onClose:n}){const[o,r]=s.useState("");return s.useEffect(()=>{i&&r("")},[i]),e.jsx("div",{children:e.jsxs(Z,{open:i,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(ee,{id:"alert-dialog-title",children:"Nova iniciativa"}),e.jsx(te,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(ae,{className:"input-text",label:"Nome da nova iniciativa",value:o,onChange:u=>r(u.target.value)})})})}),e.jsxs(se,{children:[e.jsx(ie,{onClick:()=>n(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>a(o),children:"Criar"})]})]})})}export{Ce as default};
