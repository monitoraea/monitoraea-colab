import{a as Q,r as a,j as e,u as $,d as P,c as T,e as O,C as E,J as Y,L as X,v as K,O as Z,n as w,f as G,x as ee,w as te,U as ae,T as I,b as B,o as ie,D as W,k as J,l as M,m as U,B as V,i as se,S as oe,M as R,P as ne}from"./index-DLt25zcS.js";import{T as re,a as A}from"./Tabs-BURW5nwB.js";import{C as le}from"./ConectionsTab-DZo3PbTH.js";import{n as ce,S as de,a as ue,b as me,c as pe}from"./no_thumb-BtmO3-w3.js";import{C as ye}from"./index-Bha5MrYE.js";import{P as he}from"./plus-B_5SJsXG.js";import{q as ge}from"./styled-components.browser.esm-BtHF474-.js";import{S as _e,M as be}from"./index-DFUGF19k.js";import{E as ve}from"./CheckCircle-DswnPI8a.js";import{D as fe}from"./Download-Cw4RWD-J.js";import{B as xe}from"./Box-BoG2D6P7.js";import"./KeyboardArrowRight-B-_qEmRL.js";import"./_baseIteratee-BNFwsDK1.js";const ke="_backdrop_1cgck_52",je="_indicator_1cgck_85",ze="_warning_1cgck_106",we="_ready_1cgck_109",Ne="_divisor_1cgck_146",Ce="_cleanfilters_1cgck_152",S={"projects-tabs":"_projects-tabs_1cgck_45",backdrop:ke,"ptabs-content":"_ptabs-content_1cgck_72","ptabs-tabs":"_ptabs-tabs_1cgck_79",indicator:je,"fixed-size":"_fixed-size_1cgck_85","not-ready":"_not-ready_1cgck_103",warning:ze,ready:we,"ptabs-actions":"_ptabs-actions_1cgck_119","ptabs-datefilter":"_ptabs-datefilter_1cgck_124","ptabs-datefilter-button":"_ptabs-datefilter-button_1cgck_134",divisor:Ne,cleanfilters:Ce};function Se({defaultTab:i,onTabChange:o,analysis:s}){Q();const[d,x]=a.useState(!1),[v,m]=a.useState(!1),[u,y]=a.useState(!1),[C,g]=a.useState(0),[l,h]=a.useState(0),k=_=>{o(_.target.id)};return a.useEffect(()=>{if(!s)return;let _=0;const z=Object.filter=(p,N)=>Object.keys(p).filter(t=>(N(p[t])&&_++,N(p[t]))).reduce((t,r)=>(t[r]=p[r],t),{});z(s.analysis.indics,p=>p.ready===!1),g(_),_=0;const n=z(s.analysis.information,p=>p===!1);h(_),x((p=>Object.keys(p).length===0)(n)),y(s.analysis.geo),m(s.analysis.connections)},[s]),e.jsxs("div",{className:S["projects-tabs"],children:[e.jsx("div",{className:S.backdrop}),e.jsx("div",{className:S["ptabs-content"],children:e.jsxs(re,{className:S["ptabs-tabs"],onChange:k,value:i,children:[e.jsx(A,{disableRipple:!0,label:"Cadastro",...D("informacao",l>0?l:""),className:`${S.indicator} ${d?S.ready:S.warning} ${l<10&&S["fixed-size"]}`}),e.jsx(A,{disableRipple:!0,label:"Abrangência",className:`${S.indicator} ${u?S.ready:S["not-ready"]} ${S["fixed-size"]}`,...D("abrangencia",u?"":"1")}),e.jsx(A,{disableRipple:!0,label:"Conexões",...D("conexoes")}),e.jsx(A,{disableRipple:!0,label:"Linha do tempo",...D("timeline")})]})})]})}function D(i,o=""){return{id:i,"aria-controls":`simple-tabpanel-${i}`,value:i,"data-problems":o}}const F={fields:[{key:"logo_arquivo",block:"main",type:"thumbnail",title:"Logotipo",db_field:"logo_arquivo",size:2},{key:"nome",block:"main",type:"text",title:"Nome",size:12,client_validation:"not_empty",validation:[{type:"not_empty"}]},{key:"tipologia",block:"main",type:"options",title:"Tipologia",size:4,options:[{value:-1,label:"Não respondido"},{value:0,label:"Centro"},{value:1,label:"Núcleo"},{value:2,label:"Equipamento"},{value:3,label:"Outro"}],validation:[{type:"neq",value:-1},{type:"not_empty"}]},{key:"uf",block:"main",type:"options",title:"Estado",size:4,remote:"uf/all",query:"empty=1",onchange:[{key:"municipio",value:null}]},{key:"municipio",block:"main",type:"async_autocomplete",title:"Município",size:4,remote_list:"municipio/related",remote_single:"municipio/single",filter:["uf"]},{key:"detalhamento_desc",block:"details",type:"textarea",rows:3,title:"Descrição",size:12},{key:"detalhamento_data",block:"details",type:"monthpicker",title:"Data da versão mais atual",size:4},{key:"detalhamento_tipo",block:"details",type:"options",title:"Tipo de documento de detalhamento",size:2,onchange:[{key:"detalhamento_arquivo",value:null},{key:"detalhamento_arquivo2",value:null}],list:{module:"property",key:"tipo_arquivo"}},{key:"detalhamento_arquivo",block:"details",type:"text",title:"Link para o detalhamento interno",size:6,show:{target:{key:"detalhamento_tipo",value:"link"}}},{key:"detalhamento_arquivo2",block:"detalhamento_tem_block",type:"file",accept:"application/pdf",title:"Arquivo de detalhamento",db_field:"detalhamento_arquivo",size:6,show:{target:{key:"detalhamento_tipo",value:"file"}}},{key:"nome_inst",block:"intitutions_it",type:"text",title:"Nome %index%",size:4},{key:"segmento_inst",block:"intitutions_it",type:"text",title:"Segmento %index%",size:4},{key:"nome_gestor",block:"managers_it",type:"text",title:"Nome %index%",size:4},{key:"email_gestor",block:"managers_it",type:"text",title:"E-mail %index%",size:4},{key:"telefone_gestor",block:"managers_it",type:"text",title:"Telefone %index%",size:4},{key:"data_criacao",block:"inst",type:"monthpicker",title:"Data da criação",size:3,validation:[{type:"not_empty"}]},{key:"data_inst",block:"inst",type:"monthpicker",title:"Data da institucionalização",size:3},{key:"cnpj",block:"inst",type:"text",title:"CNPJ do CECSA",size:4},{key:"estrategia_desc",block:"strategy",type:"textarea",rows:3,title:"Descrição",size:12},{key:"estrategia_data",block:"strategy",type:"monthpicker",title:"Data da versão mais atual",size:4},{key:"estrategia_tipo",block:"strategy",type:"options",title:"Tipo de documento de estrategia",size:2,onchange:[{key:"estrategia_arquivo",value:null},{key:"estrategia_arquivo2",value:null}],list:{module:"property",key:"tipo_arquivo"}},{key:"estrategia_arquivo",block:"strategy",type:"text",title:"Link para o estrategia interno",size:6,show:{target:{key:"estrategia_tipo",value:"link"}}},{key:"estrategia_arquivo2",block:"estrategia_tem_block",type:"file",accept:"application/pdf",title:"Arquivo de estrategia",db_field:"estrategia_arquivo",size:6,show:{target:{key:"estrategia_tipo",value:"file"}}},{key:"resultado_tipo",block:"outcomes_it",type:"options",list:{module:"property",key:"tipo_resultados"},title:"Tipo %index%",size:4},{key:"resultado_link",block:"outcomes_it",type:"text",title:"Link",size:4},{key:"resultado_data",block:"outcomes_it",type:"monthpicker",title:"Data da versão mais atual",size:4}],blocks:[{key:"main",title:"Sobre a Iniciativa"},{key:"managers",title:"Gestores responsáveis",elements:[{type:"block",key:"managers_it"}]},{key:"managers_it",iterate:{target:"none",index:"default",add:"Adicionar gestor"}},{key:"institutions",title:"Instituições proponentes",elements:[{type:"block",key:"intitutions_it"}]},{key:"intitutions_it",iterate:{target:"none",index:"default",add:"Adicionar instituição"}},{key:"inst",title:"Institucional"},{key:"details",title:"Detalhamento"},{key:"strategy",title:"Estratégia de sustentabilidade"},{key:"outcomes",title:"Resultados e Produtos gerados",elements:[{type:"block",key:"outcomes_it"}]},{key:"outcomes_it",iterate:{target:"none",index:"default",add:"Adicionar resultado ou produto"}}]},qe=[{type:"row",block:"main",elements:[{type:"column",size:12,elements:[{type:"row",elements:[{type:"column",size:2,key:"logo_arquivo"}]}]},{type:"row",elements:[{type:"column",size:6,key:"nome"},{type:"column",size:3,key:"tipologia"}]},{type:"row",elements:[{type:"column",size:2,key:"uf"},{type:"column",size:4,key:"municipio"}]}]},{type:"row",block:"details",elements:[{type:"row",elements:[{type:"column",size:9,key:"detalhamento_desc"}]},{type:"row",elements:[{type:"column",size:3,key:"detalhamento_tipo"},{type:"column",size:4,key:"detalhamento_arquivo"},{type:"column",size:4,key:"detalhamento_arquivo2"},{type:"column",size:2,key:"detalhamento_data"}]}]},{type:"row",block:"institutions",elements:[{type:"row",block:"intitutions_it",elements:[{type:"column",size:3,key:"nome_inst"},{type:"column",size:3,key:"segmento_inst"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"intitutions_it",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar instituição"}]}]}]}]},{type:"row",block:"managers",elements:[{type:"row",block:"managers_it",elements:[{type:"column",size:3,key:"nome_gestor"},{type:"column",size:3,key:"email_gestor"},{type:"column",size:3,key:"telefone_gestor"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"managers_it",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar gestor"}]}]}]}]},{type:"row",block:"inst",elements:[{type:"column",size:3,key:"data_criacao"},{type:"column",size:3,key:"data_inst"},{type:"column",size:3,key:"cnpj"}]},{type:"row",block:"strategy",elements:[{type:"row",elements:[{type:"column",size:9,key:"estrategia_desc"}]},{type:"row",elements:[{type:"column",size:3,key:"estrategia_tipo"},{type:"column",size:4,key:"estrategia_arquivo"},{type:"column",size:4,key:"estrategia_arquivo2"},{type:"column",size:2,key:"estrategia_data"}]}]},{type:"row",block:"outcomes",elements:[{type:"row",block:"outcomes_it",elements:[{type:"column",size:3,key:"resultado_tipo"},{type:"column",size:3,key:"resultado_link"},{type:"column",size:3,key:"resultado_data"},{type:"column",size:1,elements:[{type:"remove"}]}]},{type:"add",block:"outcomes_it",elements:[{type:"row",elements:[{type:"column",size:12,elements:[{type:"button",title:"Adicionar resultado ou produto"}]}]}]}]}],$e={lists:[{key:"sim_nao",options:[{value:!0,label:"Sim"},{value:!1,label:"Não"}]},{key:"tipo_arquivo",options:[{value:"link",label:"Link"},{value:"file",label:"Arquivo"}]},{key:"tipo_resultados",options:[{value:-1,label:"Não respondido"},{value:0,label:"Formação"},{value:1,label:"Educomunicação"},{value:2,label:"Articulação"}]}]};function Ee({entityId:i,problems:o}){const{server:s}=$(),d=P(),{enqueueSnackbar:x,closeSnackbar:v}=T(),[m,u]=a.useState([]),[y,C]=a.useState({}),[g,l]=a.useState({}),{data:h}=O(["policy_info",{entityId:i}],{queryFn:async()=>(await w.get(`${s}cne/${i}/draft/info`)).data});a.useEffect(()=>{h&&l(h)},[h]);const k=(z,n)=>{u(z),C(n)},_=async()=>{const z=Z(F,m,y),n=x("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let b,p;b="put",p=`${s}cne/${i}/draft`,await w({method:b,url:p,data:z,config:{headers:{"Content-Type":"multipart/form-data"}}}),d.invalidateQueries("policy_info"),d.invalidateQueries("policy_analysis"),v(n),x("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(b){v(n),console.error(b),x("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return h?e.jsx(e.Fragment,{children:m&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(E,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsx(Y,{form:F,view:qe,lists:$e,data:X(g,F),problems:o,onDataChange:k}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:_,children:[e.jsx(K,{}),"Gravar"]})})]})]})})})})}):e.jsx(e.Fragment,{})}const Te="_vcentered_1g64r_1",Ae="_add_1g64r_6",De="_action_1g64r_7",Oe="_timeline_1g64r_33",Pe="_highlight_1g64r_36",Re="_each_1g64r_40",Fe="_date_1g64r_49",Me="_text_1g64r_52",Ge="_thumb_1g64r_58",Ie="_buttons_1g64r_81",Be="_editing_1g64r_86",j={vcentered:Te,add:Ae,action:De,timeline:Oe,highlight:Pe,each:Re,date:Fe,text:Me,thumb:Ge,"thumb-image":"_thumb-image_1g64r_62",buttons:Ie,editing:Be,"edit-buttons":"_edit-buttons_1g64r_92"};function He({entityId:i}){const{server:o}=$(),s=P(),[d,x]=a.useState([]),[v,m]=a.useState(null),[u,y]=a.useState(null),[C,g]=a.useState(null),[l,h]=a.useState(null),{data:k}=O(["cne_timeline",{entityId:i}],{queryFn:async()=>(await w.get(`${o}cne/${i}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),_=G(t=>w.delete(`${o}cne/${i}/draft/timeline/${t}`),{onSuccess:()=>s.invalidateQueries("cne_timeline")});a.useEffect(()=>{k&&x(k)},[k]),a.useEffect(()=>{u&&setTimeout(()=>{const t=document.getElementById(`timeline_${u}`);t&&(t.scrollIntoView({block:"end",inline:"nearest"}),g(u),y(null),setTimeout(()=>g(null),2e3))},10)},[d,u]);const z=t=>()=>{m(t)},n=t=>()=>{const r=d.find(f=>f.id===t);r&&h(r)},b=async t=>{t==="confirm"&&await _.mutateAsync(v),m(null)},p=()=>{h(null)},N=()=>{h(null)};return e.jsx(e.Fragment,{children:d&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(E,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsxs("section",{id:"details",children:["A linha do tempo é uma ferramenta para a apresentação e o registro dos principais marcos/eventos da iniciativa. Insira o mês/ano em que o marco/evento aconteceu, uma imagem ilustrativa (pode ser uma fotografia real ou um ícone/desenho) e um texto descritivo. A ferramenta organiza automaticamente a apresentação dos marcos/eventos em ordem cronológica.",e.jsx("br",{}),"Alguns exemplos de marcos/eventos: criação da iniciativa, realização de atividades relevantes, eventos públicos, publicação de normativas, relatórios, materiais educomunicativos, etc."]})})}),e.jsx(E,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${j["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(H,{entityId:i,editing:l,onHighlight:y,add:!0,onSave:N})})})}),e.jsx(E,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:j.timeline,children:!!k&&d.map(t=>e.jsxs(a.Fragment,{children:[(l==null?void 0:l.id)!==t.id&&e.jsxs("div",{id:`timeline_${t.id}`,className:`${j.each} ${C===t.id?j.highlight:""}`,children:[e.jsxs("div",{className:j.date,children:[" ",e.jsx("span",{className:j.text,children:ee(t.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:j.thumb,children:e.jsxs("div",{className:j["thumb-image"],children:[!!t.timeline_arquivo&&e.jsx("img",{src:t.timeline_arquivo,alt:"imagem de timeline"}),!t.timeline_arquivo&&e.jsx("img",{src:ce,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:j.text,children:t.texto}),e.jsxs("div",{className:j.buttons,children:[e.jsx("button",{className:j.action,onClick:n(t.id),disabled:!!l,children:e.jsx(de,{})}),(l==null?void 0:l.id)!==t.id&&e.jsx("button",{className:j.action,onClick:z(t.id),disabled:!!l,children:e.jsx(ue,{})})]})]}),(l==null?void 0:l.id)===t.id&&e.jsx(H,{entityId:i,editing:l,onHighlight:y,onCancel:p,onSave:N})]},t.id))})})})})]}),e.jsx(ye,{open:!!v,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:b})]})})}function H({add:i,entityId:o,editing:s,onHighlight:d,onCancel:x,onSave:v}){const{enqueueSnackbar:m,closeSnackbar:u}=T(),{server:y}=$(),C=P(),[g,l]=a.useState(new Date),[h,k]=a.useState(null),[_,z]=a.useState(null),[n,b]=a.useState(null);a.useEffect(()=>{i?(l(new Date),b(null)):(l(s.date),b(s.texto),k({url:s.timeline_arquivo}))},[s]);const p=t=>{k(t||"remove"),z(t==null?void 0:t.file)},N=async()=>{if(!n||!n.length)return;let t=new FormData;_&&t.append("imagem",_);const r=m("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let f,c;i?(f="post",c=`${y}cne/${o}/draft/timeline`):(f="put",c=`${y}cne/${o}/draft/timeline/${s.id}`),t.set("entity",JSON.stringify({date:g,texto:n,timeline_arquivo:h}));const{data:q}=await w({method:f,url:c,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});d(q.id),l(new Date),b(null),k(null),z(null),v(),C.invalidateQueries("cne_timeline"),u(r),m("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(f){u(r),console.error(f),m("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!i&&s?j.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${j.vcentered}`,children:e.jsx(te,{className:"input-datepicker",label:"Mês",value:g||"",onChange:l,views:["month","year"],inputFormat:"MM/yyyy",disabled:i&&!!s})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(ae,{onChange:p,url:h==null?void 0:h.url,alt:"imagem",title:"Imagem",disabled:i&&!!s,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(I,{className:"input-text",label:"Texto",value:n||"",onChange:t=>b(t.target.value),multiline:!0,rows:4,disabled:i&&!!s})}),e.jsxs("div",{className:`col-xs-1 ${j.vcentered}`,children:[i&&e.jsx("button",{className:j.add,onClick:N,disabled:i&&!!s,children:e.jsx(he,{})}),!i&&e.jsxs("div",{className:j["edit-buttons"],children:[e.jsx("button",{className:j.add,onClick:N,children:e.jsx(me,{})}),e.jsx("button",{className:j.add,onClick:x,children:e.jsx(pe,{})})]})]})]})}function Le({tab:i}){const{enqueueSnackbar:o,closeSnackbar:s}=T(),{server:d}=$(),{currentCommunity:x}=B(),[v,m]=a.useState(!1),[u,y]=a.useState(""),[C,g]=a.useState(!1),[l,h]=a.useState({});a.useEffect(()=>{y(""),m(!1),h({})},[]);const k={request:G(()=>w.post(`${d}help/request`,{communityId:x.id,tab:i,text:u}))},_=()=>{m(!0)},z=async()=>{let n=!1,b={};if(u.trim().length===0&&(b.message=!0,n=!0),h(b),n)return;g(!0);const p=o("Enviando pedido de ajuda...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{await k.request.mutateAsync(),s(p),o("Pedido de ajuda enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),m(!1)}catch(N){s(p),console.error(N),o("Erro ao enviar pedido de ajuda!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}finally{g(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginRight:"5px"},children:e.jsx(ie,{title:"Pedir ajuda",children:e.jsxs("button",{className:"button-outline",disabled:C,onClick:_,children:[e.jsx(_e,{}),"Pedir ajuda sobre esta aba"]})})}),e.jsxs(W,{open:v,onClose:()=>m(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"sm",children:[e.jsx(J,{id:"alert-dialog-title",children:"Envio de pedido de ajuda"}),e.jsx(M,{id:"alert-dialog-description",children:e.jsx("p",{className:"pt-1 px-3 pb-3",children:e.jsx(I,{label:"Preencha este campo com sua dúvida",className:"input-text",value:u,onChange:n=>y(n.target.value),multiline:!0,rows:8,error:l.message})})}),e.jsxs(U,{children:[e.jsx("button",{className:"button-primary",onClick:z,children:"Enviar"}),e.jsx(V,{onClick:()=>m(!1),autoFocus:!0,children:"Cancelar"})]})]})]})}async function L(i,o){const{data:{geoms:s,bbox:d}}=await w.get(`${i}cne/${o}/geo-draw`);return console.log({geoms:s,bbox:d}),{geoms:s,bbox:d}}function Qe(){const i=P(),{server:o}=$(),{currentCommunity:s}=B(),{enqueueSnackbar:d,closeSnackbar:x}=T(),[v,m]=a.useState(null),[u,y]=a.useState(null),[C,g]=a.useState(""),[l,h]=a.useState(!1);a.useEffect(()=>{async function r(){const{data:{id:f}}=await w.get(`${o}cne/id_from_community/${s.id}`);m(f)}r()},[s.id,o]);const[k,_]=a.useState(null),[z,n]=a.useState(null);a.useEffect(()=>{async function r(){const{data:{atuacao_aplica:f,atuacao_naplica_just:c}}=await w.get(`${o}cne/${v}/geo-draw/has-geo`);y(f),g(c||"")}v&&r()},[v,o]),a.useEffect(()=>{async function r(){const{geoms:f,bbox:c}=await L(o,v);_(f),c[0][0]&&n(c)}u&&r()},[u,v,o]);const b=async()=>{const r=d("Voltando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{geoms:f,bbox:c}=await L(o,v);_(f),c[0][0]&&n(c),x(r),h(!1)},p=async r=>{const f=r.features.map(({geometry:q})=>q),c=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await w.post(`${o}cne/${v}/geo-draw`,{geoms:f}),i.invalidateQueries("policy_analysis"),x(c),d("Atuação gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})},N=async r=>{console.log({checked:r});const f=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await w.put(`${o}cne/${v}/geo-draw/${r?r==="none"?"none":"1":"0"}`),i.invalidateQueries("policy_analysis"),x(f),y(r)},t=async()=>{const r=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});return await w.put(`${o}cne/${v}/draft/justification`,{value:C}),i.invalidateQueries("policy_analysis"),x(r),!0};return e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(E,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Ke,{children:[e.jsx("div",{children:"É possivel representar este projeto de geograficamente?"}),e.jsx(se,{children:e.jsxs(oe,{className:"input-select",value:u===null?"none":u,onChange:r=>N(r.target.value),children:[e.jsx(R,{value:"none",children:" -- selecione -- "}),e.jsx(R,{value:!0,children:"Sim"}),e.jsx(R,{value:!1,children:"Não"})]})})]}),e.jsx(Le,{tab:"atuacao"})]}),u===!0&&e.jsx(be,{entity:"cne",initialGeoms:k,initialBBOX:z,isEditing:l,onEdit:r=>h(r),onSave:p,onCancel:b}),u===!1&&e.jsxs("section",{id:"details",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title",children:"Justificativa"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:()=>t(),children:[e.jsx(K,{}),"Gravar"]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(I,{className:"input-text",value:C||"",onChange:r=>g(r.target.value),multiline:!0,rows:4})})})]})]})})})})}const Ke=ge.div`
  display: flex;
  margin-bottom: 20px;
  justify-content: end;
  align-items: center;
  div {
    margin-right: 10px;
  }
`,We="_button_delete_11779_45",Je="_Roll_11779_1",Ue="_term_11779_82",Ve={button_delete:We,Roll:Je,term:Ue},ut=()=>{const{currentCommunity:i,changeRoute:o,params:s}=B(),{server:d}=$(),{user:x,updateUser:v}=Q(),{enqueueSnackbar:m,closeSnackbar:u}=T(),[y,C]=a.useState(null),[g,l]=a.useState(null),[h,k]=a.useState(!1),[_,z]=a.useState(!1),{data:n}=O(["policy",{currentCommunity:i.id}],{queryFn:async()=>(await w.get(`${d}cne/id_from_community/${i.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:b}=O(["policy_analysis",{policy_id:n==null?void 0:n.id}],{queryFn:async()=>(await w.get(`${d}cne/${n==null?void 0:n.id}/verify`)).data,enabled:!!(n!=null&&n.id),retry:!1,refetchOnWindowFocus:!1}),p={publish:G(()=>w.put(`${d}cne/${y}/publish`))};a.useEffect(()=>{z(x.membership.map(c=>c.id===1||c.id===i.id&&c.type==="adm").reduce((c,q)=>c||q))},[_,x,i]),a.useEffect(()=>{n&&C(n.id)},[n]),a.useEffect(()=>{l(s&&s.length?s[0]:"informacao")},[s]);const N=()=>{k(!0)},t=c=>{c==="confirm"&&r(),k(!1)},r=async()=>{const c=m("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:q}=await p.publish.mutateAsync();if(u(c),q.success)window.location=`${window.location}`,m("Iniciativa publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(q.reason.code==="not_ready")m(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta iniciativa ainda não está pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações e Indicadores estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(q){u(c),console.error(q),m("Erro ao publicar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},f=()=>{};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(ne,{title:"Centro/Núcleo/Equipamento"}),e.jsxs("div",{className:"page-header-buttons",children:[e.jsxs("button",{className:"button-outline",onClick:f,children:[e.jsx(fe,{}),"Baixar CSV"]}),_&&_===!0&&e.jsxs("button",{className:"button-primary",onClick:N,children:[e.jsx(ve,{}),"Publicar"]})]})]}),b&&g&&e.jsxs(e.Fragment,{children:[e.jsx(Se,{defaultTab:g,onTabChange:c=>o({params:[c]}),analysis:b}),y&&e.jsxs(e.Fragment,{children:[g==="informacao"&&e.jsx(Ee,{entityId:y,problems:Object.keys(b.analysis.information).filter(c=>b.analysis.information[c]===!1)}),g==="conexoes"&&e.jsx(le,{entityName:"cne",entityId:y}),g==="abrangencia"&&e.jsx(Qe,{entityId:y}),g==="timeline"&&e.jsx(He,{entityId:y})]})]}),e.jsx(xe,{display:"flex",justifyContent:"space-between"}),e.jsx(Ye,{open:h,onClose:t})]})};function Ye({open:i,onClose:o}){return e.jsx("div",{children:e.jsxs(W,{open:i,onClose:o,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(J,{id:"alert-dialog-title",children:"Termo de Adesão"}),e.jsx(M,{children:e.jsxs(M,{id:"alert-dialog-description",className:Ve.term,children:[e.jsx("p",{children:"Declaro estar ciente e de acordo com as diretrizes político-pedagógicas do Sistema MonitoraEA e que reconheço a Plataforma MonitoraEA como um instrumento de gestão de dados das iniciativas de educação ambiental (políticas, projetos, instâncias, entre outros) no Brasil."}),e.jsx("p",{children:"Neste sentido, declaro a adesão ao Sistema MonitoraEA por meio da inserção da iniciativa ora cadastrada na Plataforma MonitoraEA. Declaro que a execução técnica e financeira da referida iniciativa está sob a responsabilidade integral da instituição proponente e, eventualmente, seus parceiros."}),e.jsx("p",{children:"Ainda, declaro concordar com a divulgação pública dos dados da iniciativa ora inserida – por meio da Plataforma MonitoraEA - e assumo a inteira responsabilidade pelo teor e veracidade das informações cadastradas."}),e.jsx("p",{children:"Por fim, declaro meu consentimento com a coleta, uso e tratamento de meus dados pessoais pela ANPPEA, que atuará como gestora de dados, nos termos da Lei 13.709/2018, e que tenho ciência de que poderei solicitar, a qualquer momento, a exclusão de meus dados do banco de dados da Plataforma MonitoraEA, bem como a revogação deste consentimento."})]})}),e.jsxs(U,{children:[e.jsx("button",{className:"button-primary",onClick:()=>o("confirm"),children:"Concordo"}),e.jsx(V,{onClick:()=>o("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{ut as default};
