import{u as A,b as B,d as w,c as P,r as i,e as R,f as L,j as e,P as Q,q as K,n as b,D as V,k as W,l as H,T as M,m as U,B as G}from"./index-DLt25zcS.js";import{r as S}from"./index-DQ24o8Cs.js";import{S as J}from"./Search-BuC3Vl68.js";import{B as X}from"./Box-BoG2D6P7.js";import{T as Y}from"./TableSortLabel-BadkXaU-.js";const Z="_commission_list_1rasy_1",ee="_commission_1rasy_1",ae="_name_1rasy_8",te="_actions_1rasy_11",ie="_sent_1rasy_19",se="_action_1rasy_11",u={commission_list:Z,commission:ee,name:ae,actions:te,sent:ie,action:se};let _;function me(){const{server:s}=A();B();const n=w(),{enqueueSnackbar:t,closeSnackbar:r}=P(),o=K,l=i.useRef(null),[h,k]=i.useState(""),[p,F]=i.useState(""),[x,I]=i.useState("name"),[m,f]=i.useState("asc"),[$,D]=i.useState(0),[y,T]=i.useState(null),[N,v]=i.useState(!1),{data:g}=R(["user_iniciatives_list",{order:x,direction:m}],{queryFn:async()=>(await b.get(`${s}project/mine?direction=${m}`)).data});i.useEffect(()=>{if(!g)return;let a=[...g.entities];p.trim().length&&(a=a.filter(c=>S(c.name.toLowerCase()).includes(S(p.trim().toLocaleLowerCase())))),D(a.length),T(a)},[g,p]);const q={create:L(a=>b.post(`${s}project`,{nome:a}),{onSuccess:()=>{n.invalidateQueries("user_iniciatives_list")}})},z=a=>{x===a?f(m==="asc"?"desc":"asc"):(I(a),f("desc"))},C=async(a,c)=>{const d=t("Enviando pedido de participação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{data:j}=await b.post(`${s}project/${c}/participate`,{isADM:a});r(d),j.success?(t("Seu pedido de participação foi enviado! Uma notificação será enviada, no momento da aprovação",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),n.invalidateQueries("user_iniciatives_list")):j.error==="already_member"?t("Você já é membro deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):j.error==="already_in_list"?t("Você já está na lista de aprovação deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):t("Erro ao enviar seu pedido de participação! Por favor, entre em contato com a administração",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})},E=a=>{k(a.target.value),_&&clearTimeout(_),_=setTimeout(()=>F(a.target.value),500)},O=async a=>{if(!a||!a.length)return;const c=t("Criando a iniciativa..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:d}=await q.create.mutateAsync(a);r(c),t("Iniciativa gravada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),v(!1),window.location=`/colabora/projeto/${d.communityId}`}catch(d){r(c),console.error(d),t("Erro ao gravar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page width-limiter tbox-fixed",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(Q,{title:"Iniciativas ("+$+")"}),e.jsx("div",{className:"page-header-buttons",children:e.jsx("button",{className:"button-primary",onClick:()=>v(!0),children:"Nova iniciativa"})})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"tablebox limit-height",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(o,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx(J,{onClick:()=>{var a;return(a=l.current)==null?void 0:a.focus()}}),inputRef:l,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:h,onChange:E})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(re,{text:"Iniciativas",column:"name",order:x,direction:m,onClick:z})}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:y&&y.map(a=>e.jsxs("tr",{className:"tbox-row",children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:`tbox-table-actions ${u.actions}`,children:[a.is_requesting&&e.jsx("div",{className:u.sent,children:"Solicitação enviada"}),!a.is_requesting&&e.jsxs(e.Fragment,{children:[a.is_member&&e.jsx(e.Fragment,{children:e.jsx("button",{className:`button-primary ${u.action}`,onClick:()=>changeRoute({community:a.community_id}),children:"Acessar"})}),!a.is_member&&e.jsxs(e.Fragment,{children:[!a.has_members&&e.jsx("button",{className:`button-outline ${u.action}`,onClick:()=>C(!0,a.id),children:"sou o responsável"}),e.jsx("button",{className:`button-primary ${u.action}`,onClick:()=>C(!1,a.id),children:"colaborar"})]})]})]})]},a.id))})]})})]})})}),e.jsx(X,{display:"flex",justifyContent:"space-between"})]}),e.jsx(ne,{open:!!N,type:N,onCreate:O,onClose:()=>v(!1)})]})}function re({text:s,column:n,order:t,direction:r,onClick:o}){return e.jsx(e.Fragment,{children:e.jsx(Y,{className:"tbox-table-sortlabel",active:t===n,direction:r==="desc"?"asc":"desc",onClick:()=>o(n),children:s})})}function ne({open:s,type:n,onCreate:t,onClose:r}){const[o,l]=i.useState("");return i.useEffect(()=>{s&&l("")},[s]),e.jsx("div",{children:e.jsxs(V,{open:s,onClose:r,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(W,{id:"alert-dialog-title",children:"Nova iniciativa"}),e.jsx(H,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(M,{className:"input-text",label:"Nome da nova iniciativa",value:o,onChange:h=>l(h.target.value)})})})}),e.jsxs(U,{children:[e.jsx(G,{onClick:()=>r(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>t(o),children:"Criar"})]})]})})}export{me as default};
