import{u as M,a as W,b as D,r as p,e as G,N as K,j as e,X as U,n as R,c as L,f as Q,o as Y,D as Z,k as X,l as J,T as g,m as ee,B as ae,d as ie,C as te,v as V,M as y,Y as z,Z as P,H as se}from"./index-DLt25zcS.js";import{S as ne,A as F}from"./index-DFUGF19k.js";const oe="_error_y2a6h_45",le="_done_y2a6h_50",re="_indic_y2a6h_55",ce="_selected_y2a6h_59",de="_field_y2a6h_63",ue="_title_box_y2a6h_66",pe="_tree_y2a6h_81",he="_li_lae_titles_y2a6h_92",me="_show_y2a6h_96",_e="_fade_in_show_y2a6h_1",xe="_hide_y2a6h_111",ve="_li_indicators_y2a6h_114",je="_strong_y2a6h_125",ge="_actions_y2a6h_151",fe="_helpbox_button_y2a6h_157",be="_button_delete_y2a6h_164",ye="_Roll_y2a6h_1",Ce={error:oe,done:le,indic:re,selected:ce,field:de,title_box:ue,tree:pe,li_lae_titles:he,show:me,fade_in_show:_e,hide:xe,li_indicators:ve,"item-container":"_item-container_y2a6h_118",strong:je,"indic-header":"_indic-header_y2a6h_137",actions:ge,helpbox_button:fe,button_delete:be,Roll:ye};function B({type:h,keyRef:_,openHelpbox:C}){const{server:w}=M(),{user:N}=W(),{currentCommunity:E}=D(),[f,i]=p.useState(!1),[j,d]=p.useState(null),{data:b}=G(["help_content",{key_ref:j}],{queryFn:async()=>(await R.get(`${w}helpbox/${j}`)).data,enabled:!!j});return p.useEffect(()=>{_&&d(_.join("."))},[_]),p.useEffect(()=>{i(!!b||N.membership.find(A=>A.id===K))},[b]),e.jsx(e.Fragment,{children:f&&e.jsx("button",{className:`button-link ${Ce.helpbox_button}`,onClick:()=>C(b||{type:h||"indic",key_ref:j,community:E}),children:e.jsx(U,{})})})}function Ne({tab:h}){const{enqueueSnackbar:_,closeSnackbar:C}=L(),{server:w}=M(),{currentCommunity:N}=D(),[E,f]=p.useState(!1),[i,j]=p.useState(""),[d,b]=p.useState(!1),[A,$]=p.useState({});p.useEffect(()=>{j(""),f(!1),$({})},[]);const q={request:Q(()=>R.post(`${w}help/request`,{communityId:N.id,tab:h,text:i}))},H=()=>{f(!0)},l=async()=>{let S=!1,I={};if(i.trim().length===0&&(I.message=!0,S=!0),$(I),S)return;b(!0);const a=_("Enviando pedido de ajuda...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{await q.request.mutateAsync(),C(a),_("Pedido de ajuda enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),f(!1)}catch(r){C(a),console.error(r),_("Erro ao enviar pedido de ajuda!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}finally{b(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginRight:"5px"},children:e.jsx(Y,{title:"Pedir ajuda",children:e.jsxs("button",{className:"button-outline",disabled:d,onClick:H,children:[e.jsx(ne,{}),"Pedir ajuda sobre esta aba"]})})}),e.jsxs(Z,{open:E,onClose:()=>f(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"sm",children:[e.jsx(X,{id:"alert-dialog-title",children:"Envio de pedido de ajuda"}),e.jsx(J,{id:"alert-dialog-description",children:e.jsx("p",{className:"pt-1 px-3 pb-3",children:e.jsx(g,{label:"Preencha este campo com sua dúvida",className:"input-text",value:i,onChange:S=>j(S.target.value),multiline:!0,rows:8,error:A.message})})}),e.jsxs(ee,{children:[e.jsx("button",{className:"button-primary",onClick:l,children:"Enviar"}),e.jsx(ae,{onClick:()=>f(!1),autoFocus:!0,children:"Cancelar"})]})]})]})}function ke({entityName:h="project",entityId:_}){const{server:C}=M(),w=ie(),{enqueueSnackbar:N,closeSnackbar:E}=L(),{currentCommunity:f}=D(),[i,j]=p.useState(null),[d,b]=p.useState([]),[A,$]=p.useState(null),{data:q}=G([`${h}_network`,{entityId:_}],{queryFn:async()=>(await R.get(`${C}${h}/${_}/draft/network`)).data,refetchOnWindowFocus:!1});p.useEffect(()=>{q&&j(q)},[q]),p.useEffect(()=>{console.log({errors:d})},[d]);const H=Q(a=>{if(a)return R.put(`${C}${h}/${_}/draft/network`,{...a,communityId:f.id})},{onSuccess:()=>w.invalidateQueries(`${h}/${_}/draft/network`)}),l=(a,r,t)=>s=>{let n={...i};if(console.log({prop:t,value:s}),r!==void 0){let o=i[a][r];if(t.includes("name")){const{value:m,reason:x}=s;if(x==="clear")o={...o,[t]:""};else if(["input","reset"].includes(x))o={...o,[t]:m};else return}else{if(a==="id"&&!s)return;o={...o,[t]:s}}t.includes("instituicao")&&(o={...o,iniciativa_id:null,iniciativa_name:""}),n[a][r]=o}else n[a]=s;console.log(`changing ${a}:`,s,n),j(n)},S=async()=>{let a=[];if(i.pp_base==="none"&&a.push("pp_base"),i.apoiada_base==="none"&&a.push("apoiada_base"),i.apoia_base==="none"&&a.push("apoia_base"),i.pp_base==="sim"){let t=null;for(let s=0;s<5;s++)i.pp[s].name.length&&(t=s,i.pp[s].type.length||a.push(`pp_${s}_type`));if(t===null)a.push("pp_0_id");else for(let s=t;s>=0;s--)i.pp[s].name.length||a.push(`pp_${s}_id`)}if(["apoiada","apoia"].forEach(t=>{if(i[`${t}_base`]==="sim"){let s=null;for(let n=0;n<5;n++)(i[t][n].instituicao_name.length||i[t][n].iniciativa_name.length)&&(s=n,i[t][n].instituicao_name===""&&a.push(`${t}_${n}_instituicao_id`),i[t][n].type.length||a.push(`${t}_${n}_type`));if(s===null)a.push(`${t}_0_instituicao_id`);else for(let n=s;n>=0;n--)i[t][n].instituicao_name.length||a.push(`${t}_${n}_instituicao_id`)}}),b(a),a.length)return;const r=N("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{await H.mutateAsync(i),w.invalidateQueries(`${h}_network`),E(r),N("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(t){E(r),console.error(t),N("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},I=(a,r)=>(r!=="cne"&&(r="default"),{cne:{1:e.jsx("div",{children:"O centro cadastrado se conecta com alguma Política Pública de Educação Ambiental?"}),2:e.jsxs("div",{children:["A(s) organização(ões) responsável(is) pelo centro/núcleo/equipamento cadastrado ",e.jsx("strong",{children:"é apoiada ou recebe algum suporte"})," de alguma outra instituição, no contexto específico das atividades fomentadas pelo centro?"]}),3:e.jsxs("div",{children:["A(s) organização(ões) responsável(is) pelo centro/núcleo/equipamento cadastrado ",e.jsx("strong",{children:"apoia ou dá algum tipo de suporte"})," a outra instituição, no contexto específico das atividades fomentadas pelo centro?"]})},default:{1:e.jsx("div",{children:"A ação/projeto se conecta com alguma Política Pública de Educação Ambiental?"}),2:e.jsxs("div",{children:["A sua iniciativa (ação ou projeto) ",e.jsx("strong",{children:"é apoiada ou recebe algum suporte"})," de alguma outra instituição para viabilizar suas ações?"]}),3:e.jsxs("div",{children:["A sua iniciativa (ação ou projeto) ",e.jsx("strong",{children:"apoia ou dá algum tipo de suporte"})," a outra ação/projeto na Zona Costeira e Marinha do Brasil?"]})}}[r][a]);return e.jsx(e.Fragment,{children:i&&e.jsx("div",{className:"page-content",children:e.jsxs("div",{className:"page-body",children:[e.jsx(te,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("section",{id:"pp",children:[e.jsxs("div",{className:"section-header",children:[e.jsxs("div",{className:"section-title",style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{children:I(1,h)}),e.jsx(B,{type:"redes",keyRef:["politicas"],openHelpbox:$})]}),e.jsxs("div",{className:"section-actions",children:[h==="project"&&e.jsx(Ne,{tab:"conexoes"}),e.jsxs("button",{className:"button-primary",onClick:()=>S(),children:[e.jsx(V,{}),"Gravar"]})]})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-6",styles:{display:"flex"},children:e.jsxs(g,{select:!0,id:"money-select",label:"",className:"input-text",value:i.pp_base,onChange:a=>l("pp_base")(a.target.value),error:d.includes("pp_base"),children:[e.jsx(y,{value:"none",children:"Selecione uma opção"}),e.jsx(y,{value:"sim",children:"Sim"}),e.jsx(y,{value:"nao",children:"Não"})]})})})]}),i.pp_base==="sim"&&e.jsxs("section",{id:"pp_detalhe",children:[e.jsx("div",{className:"section-header",children:e.jsx("div",{className:"section-title",children:"Indique as políticas em ordem de relevância"})}),[0,1,2,3,4].map(a=>{var r,t,s,n;return e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xs-3",children:e.jsx(F,{label:`Política ${a+1}`,url:"policy",value:(r=i.pp[a])==null?void 0:r.id,onChange:l("pp",a,"id"),inputValue:((t=i.pp[a])==null?void 0:t.name)||"",onInputChange:(o,m,x)=>l("pp",a,"name")({value:m,reason:x}),freeSolo:!0,error:d.includes(`pp_${a}_id`)})}),e.jsx("div",{className:"col-xs-6",children:e.jsx(z,{multiple:!0,id:"fixed-tags-demo",className:"input-autocomplete",value:(s=i.pp[a])==null?void 0:s.type,onChange:(o,m)=>l("pp",a,"type")(m),options:[{value:"principios",title:"Alinhamento com princípios e diretrizes"},{value:"instrumentos",title:"Atuação em instrumentos específicos"},{value:"planos",title:"Atuação em planos e programas conectados à política"},{value:"atividades",title:"Atuação em atividades vinculadas à política"}],getOptionLabel:o=>o.title,renderTags:(o,m)=>o.map((x,k)=>e.jsx(P,{label:x.title,...m({index:k})})),renderInput:o=>e.jsx(g,{...o,label:"Relação",error:d.includes(`pp_${a}_type`)})})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(g,{className:"input-text",id:"text-email",label:"Outra relação",value:(n=i.pp[a])==null?void 0:n.other_type,onChange:o=>l("pp",a,"other_type")(o.target.value)})})]},a)})]}),e.jsx("hr",{className:"hr-spacer my-4"}),e.jsxs("section",{id:"apoiada",children:[e.jsx("div",{className:"section-header",children:e.jsxs("div",{className:"section-title",style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{children:I(2,h)}),e.jsx(B,{type:"redes",keyRef:["apoiada"],openHelpbox:$})]})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-6",styles:{display:"flex"},children:e.jsxs(g,{select:!0,id:"money-select",label:"",className:"input-text",value:i.apoiada_base,onChange:a=>l("apoiada_base")(a.target.value),error:d.includes("apoiada_base"),children:[e.jsx(y,{value:"none",children:"Selecione uma opção"}),e.jsx(y,{value:"sim",children:"Sim"}),e.jsx(y,{value:"nao",children:"Não"})]})})})]}),i.apoiada_base==="sim"&&e.jsxs("section",{id:"apoiada_detalhe",children:[e.jsx("div",{className:"section-header",children:e.jsx("div",{className:"section-title",children:"Indique as instituições em ordem de relevância"})}),[0,1,2,3,4].map(a=>{var r,t,s,n,o,m,x,k,O;return e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xs-3",children:e.jsx(F,{label:`Instituição ${a+1}`,url:"institution",value:(r=i.apoiada[a])==null?void 0:r.instituicao_id,onChange:l("apoiada",a,"instituicao_id"),inputValue:((t=i.apoiada[a])==null?void 0:t.instituicao_name)||"",onInputChange:(c,u,v)=>l("apoiada",a,"instituicao_name")({value:u,reason:v}),freeSolo:!0,error:d.includes(`apoiada_${a}_instituicao_id`)})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(F,{label:`Iniciativa ${a+1}`,url:"project/opt_relations",urlSingle:"project/opt_relations",query:`?${(s=i.apoiada[a])!=null&&s.instituicao_id?`&institution=${(n=i.apoiada[a])==null?void 0:n.instituicao_id}`:(o=i.apoiada[a])!=null&&o.instituicao_name.length?"&institution=0":""}`,value:(m=i.apoiada[a])==null?void 0:m.iniciativa_id,onChange:l("apoiada",a,"iniciativa_id"),inputValue:((x=i.apoiada[a])==null?void 0:x.iniciativa_name)||"",onInputChange:(c,u,v)=>l("apoiada",a,"iniciativa_name")({value:u,reason:v}),freeSolo:!0})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(z,{multiple:!0,id:"fixed-tags-demo",className:"input-autocomplete",value:(k=i.apoiada[a])==null?void 0:k.type,onChange:(c,u)=>l("apoiada",a,"type")(u),options:[{value:"financiamento",title:"Fomento financeiro/financiamento"},{value:"infraestrutura",title:"Compartilhamento de infraestrutura"},{value:"rh",title:"Compartilhamento de recursos humanos"},{value:"info",title:"Compartilhamento de informações"}],getOptionLabel:c=>c.title,renderTags:(c,u)=>c.map((v,T)=>e.jsx(P,{label:v.title,...u({index:T})})),renderInput:c=>e.jsx(g,{...c,label:"Relação",error:d.includes(`apoiada_${a}_type`)})})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(g,{className:"input-text",id:"text-email",label:"Outra relação",value:(O=i.apoiada[a])==null?void 0:O.other_type,onChange:c=>l("apoiada",a,"other_type")(c.target.value)})})]},a)})]}),e.jsx("hr",{className:"hr-spacer my-4"}),e.jsxs("section",{id:"apoia",children:[e.jsx("div",{className:"section-header",children:e.jsxs("div",{className:"section-title",style:{display:"flex",alignItems:"center"},children:[e.jsx("div",{children:I(3,h)}),e.jsx(B,{type:"redes",keyRef:["apoia"],openHelpbox:$})]})}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-6",styles:{display:"flex"},children:e.jsxs(g,{select:!0,id:"money-select",label:"",className:"input-text",value:i.apoia_base,onChange:a=>l("apoia_base")(a.target.value),error:d.includes("apoia_base"),children:[e.jsx(y,{value:"none",children:"Selecione uma opção"}),e.jsx(y,{value:"sim",children:"Sim"}),e.jsx(y,{value:"nao",children:"Não"})]})})})]}),i.apoia_base==="sim"&&e.jsxs("section",{id:"apoia_detalhe",children:[e.jsx("div",{className:"section-header",children:e.jsx("div",{className:"section-title",children:"Indique as iniciativas em ordem de relevância"})}),[0,1,2,3,4].map(a=>{var r,t,s,n,o,m,x,k,O;return e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-xs-3",children:e.jsx(F,{label:`Instituição ${a+1}`,url:"institution",value:(r=i.apoia[a])==null?void 0:r.instituicao_id,onChange:l("apoia",a,"instituicao_id"),inputValue:((t=i.apoia[a])==null?void 0:t.instituicao_name)||"",onInputChange:(c,u,v)=>l("apoia",a,"instituicao_name")({value:u,reason:v}),freeSolo:!0,error:d.includes(`apoia_${a}_instituicao_id`)})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(F,{label:`Iniciativa ${a+1}`,url:"project/opt_relations",urlSingle:"project/opt_relations",query:`?${(s=i.apoia[a])!=null&&s.instituicao_id?`&institution=${(n=i.apoia[a])==null?void 0:n.instituicao_id}`:(o=i.apoia[a])!=null&&o.instituicao_name.length?"&institution=0":""}`,value:(m=i.apoia[a])==null?void 0:m.iniciativa_id,onChange:l("apoia",a,"iniciativa_id"),inputValue:((x=i.apoia[a])==null?void 0:x.iniciativa_name)||"",onInputChange:(c,u,v)=>l("apoia",a,"iniciativa_name")({value:u,reason:v}),freeSolo:!0,error:d.includes(`apoia_${a}_iniciativa_id`)})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(z,{multiple:!0,id:"fixed-tags-demo",className:"input-autocomplete",value:(k=i.apoia[a])==null?void 0:k.type,onChange:(c,u)=>l("apoia",a,"type")(u),options:[{value:"financiamento",title:"Fomento financeiro/financiamento"},{value:"infraestrutura",title:"Compartilhamento de infraestrutura"},{value:"rh",title:"Compartilhamento de recursos humanos"},{value:"info",title:"Compartilhamento de informações"}],getOptionLabel:c=>c.title,renderTags:(c,u)=>c.map((v,T)=>e.jsx(P,{label:v.title,...u({index:T})})),renderInput:c=>e.jsx(g,{...c,label:"Relação",error:d.includes(`apoia_${a}_type`)})})}),e.jsx("div",{className:"col-xs-3",children:e.jsx(g,{className:"input-text",id:"text-email",label:"Outra relação",value:(O=i.apoia[a])==null?void 0:O.other_type,onChange:c=>l("apoia",a,"other_type")(c.target.value)})})]},a)})]}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:()=>S(),children:[e.jsx(V,{}),"Gravar"]})})]})]})}),e.jsx(se,{content:A,onClose:()=>$(null)})]})})})}export{ke as C,Ne as G,B as H,Ce as s};
