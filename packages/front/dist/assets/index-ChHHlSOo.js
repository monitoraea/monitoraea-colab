import{u as A,b as B,d as P,c as R,r as s,e as L,f as Q,j as e,P as K,q as V,n as b,D as W,k as H,l as M,T as U,m as G,B as J}from"./index-DLt25zcS.js";import{r as q}from"./index-DQ24o8Cs.js";import{S as X}from"./Search-BuC3Vl68.js";import{B as Y}from"./Box-BoG2D6P7.js";import{T as Z}from"./TableSortLabel-BadkXaU-.js";const ee="_cne_list_qq0jw_1",ae="_cne_qq0jw_1",te="_actions_qq0jw_8",se="_sent_qq0jw_16",d={cne_list:ee,cne:ae,actions:te,sent:se};let f;function ue(){const{server:i}=A(),{changeRoute:c}=B(),n=P(),{enqueueSnackbar:t,closeSnackbar:r}=R(),u=V,h=s.useRef(null),[S,k]=s.useState(""),[p,F]=s.useState(""),[x,E]=s.useState("name"),[m,_]=s.useState("asc"),[w,I]=s.useState(0),[y,$]=s.useState(null),[N,v]=s.useState(!1),{data:g}=L(["user_cnes_list",{order:x,direction:m}],{queryFn:async()=>(await b.get(`${i}cne/mine?direction=${m}`)).data});s.useEffect(()=>{if(!g)return;let a=[...g.entities];p.trim().length&&(a=a.filter(o=>q(o.name.toLowerCase()).includes(q(p.trim().toLocaleLowerCase())))),I(a.length),$(a)},[g,p]);const D={create:Q(a=>b.post(`${i}cne`,{nome:a}),{onSuccess:()=>{n.invalidateQueries("user_cnes_list")}})},T=a=>{x===a?_(m==="asc"?"desc":"asc"):(E(a),_("desc"))},C=async(a,o)=>{const l=t("Enviando pedido de participação...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{data:j}=await b.post(`${i}cne/${o}/participate`,{isADM:a});r(l),j.success?(t("Seu pedido de participação foi enviado! Uma notificação será enviada, no momento da aprovação",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),n.invalidateQueries("user_cnes_list")):j.error==="already_member"?t("Você já é membro deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):j.error==="already_in_list"?t("Você já está na lista de aprovação deste grupo!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}}):t("Erro ao enviar seu pedido de participação! Por favor, entre em contato com a administração",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})},z=a=>{k(a.target.value),f&&clearTimeout(f),f=setTimeout(()=>F(a.target.value),500)},O=async a=>{if(!a||!a.length)return;const o=t("Criando a iniciativa..",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:l}=await D.create.mutateAsync(a);r(o),t("Iniciativa gravada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),v(!1),window.location=`/colabora/cne/${l.communityId}`}catch(l){r(o),console.error(l),t("Erro ao gravar a iniciativa!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page width-limiter tbox-fixed",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(K,{title:"Centros/Núcleos/Equipamentos ("+w+")"}),e.jsx("div",{className:"page-header-buttons",children:e.jsx("button",{className:"button-primary",onClick:()=>v(!0),children:"Novo Centros/Núcleos/Equipamentos"})})]}),e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsxs("div",{className:"tablebox limit-height",children:[e.jsx("div",{className:"tbox-header",children:e.jsx(u,{spellCheck:"false",className:"tbox-search",startAdornment:e.jsx(X,{onClick:()=>{var a;return(a=h.current)==null?void 0:a.focus()}}),inputRef:h,placeholder:"Pesquisar...",inputProps:{"aria-label":"pesquisar grupos"},value:S,onChange:z})}),e.jsx("div",{className:"tbox-body",children:e.jsxs("table",{className:"tbox-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:e.jsx(ie,{text:"Centros/Núcleos/Equipamentos",column:"name",order:x,direction:m,onClick:T})}),e.jsx("th",{children:"Ações"})]})}),e.jsx("tbody",{children:y&&y.map(a=>e.jsxs("tr",{className:"tbox-row",children:[e.jsx("td",{children:a.name}),e.jsxs("td",{className:`tbox-table-actions ${d.actions}`,children:[a.is_requesting&&e.jsx("div",{className:d.sent,children:"Solicitação enviada"}),!a.is_requesting&&e.jsxs(e.Fragment,{children:[a.is_member&&e.jsx(e.Fragment,{children:e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>c({community:a.community_id}),children:"Acessar"})}),!a.is_member&&e.jsxs(e.Fragment,{children:[!a.has_members&&e.jsx("button",{className:`button-outline ${d.action}`,onClick:()=>C(!0,a.id),children:"sou o responsável"}),e.jsx("button",{className:`button-primary ${d.action}`,onClick:()=>C(!1,a.id),children:"colaborar"})]})]})]})]},a.id))})]})})]})})}),e.jsx(Y,{display:"flex",justifyContent:"space-between"})]}),e.jsx(re,{open:!!N,type:N,onCreate:O,onClose:()=>v(!1)})]})}function ie({text:i,column:c,order:n,direction:t,onClick:r}){return e.jsx(e.Fragment,{children:e.jsx(Z,{className:"tbox-table-sortlabel",active:n===c,direction:t==="desc"?"asc":"desc",onClick:()=>r(c),children:i})})}function re({open:i,type:c,onCreate:n,onClose:t}){const[r,u]=s.useState("");return s.useEffect(()=>{i&&u("")},[i]),e.jsx("div",{children:e.jsxs(W,{open:i,onClose:t,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",maxWidth:"md",fullWidth:!0,children:[e.jsx(H,{id:"alert-dialog-title",children:"Nova iniciativa de Centros/Núcleos/Equipamento"}),e.jsx(M,{children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(U,{className:"input-text",label:"Nome da nova iniciativa",value:r,onChange:h=>u(h.target.value)})})})}),e.jsxs(G,{children:[e.jsx(J,{onClick:()=>t(),autoFocus:!0,children:"Cancelar"}),e.jsx("button",{className:"button-primary",onClick:()=>n(r),children:"Criar"})]})]})})}export{ue as default};
