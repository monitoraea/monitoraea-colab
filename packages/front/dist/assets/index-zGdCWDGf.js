import{a as V,r as a,j as e,u as A,d as H,c as B,e as D,C as P,J as he,V as te,L as _e,N as fe,v as ne,O as ge,n as k,f as U,x as we,w as Ce,U as Ee,T as ie,b as L,W as K,o as ze,D as oe,k as re,l as W,m as ce,B as ve,i as Oe,S as qe,M as se,P as Fe,A as Te}from"./index-DLt25zcS.js";import{C as le}from"./index-Bha5MrYE.js";import{T as Re,a as G}from"./Tabs-BURW5nwB.js";import{n as Pe,S as De,a as Ae,b as Me,c as Ie}from"./no_thumb-BtmO3-w3.js";import{P as Be}from"./plus-B_5SJsXG.js";import{E as xe}from"./CheckCircle-DswnPI8a.js";import{i as Ge,g as Qe,a as We,b as He,c as Ke,d as Ue,E as Ve}from"./indicsTree-CbQzdjjY.js";import{q as Le}from"./styled-components.browser.esm-BtHF474-.js";import{S as Ye,M as Je}from"./index-DFUGF19k.js";import{D as de}from"./Download-Cw4RWD-J.js";import{B as Xe}from"./Box-BoG2D6P7.js";import"./KeyboardArrowRight-B-_qEmRL.js";import"./_baseIteratee-BNFwsDK1.js";const Ze="_backdrop_1cgck_52",ea="_indicator_1cgck_85",aa="_warning_1cgck_106",ta="_ready_1cgck_109",sa="_divisor_1cgck_146",na="_cleanfilters_1cgck_152",z={"projects-tabs":"_projects-tabs_1cgck_45",backdrop:Ze,"ptabs-content":"_ptabs-content_1cgck_72","ptabs-tabs":"_ptabs-tabs_1cgck_79",indicator:ea,"fixed-size":"_fixed-size_1cgck_85","not-ready":"_not-ready_1cgck_103",warning:aa,ready:ta,"ptabs-actions":"_ptabs-actions_1cgck_119","ptabs-datefilter":"_ptabs-datefilter_1cgck_124","ptabs-datefilter-button":"_ptabs-datefilter-button_1cgck_134",divisor:sa,cleanfilters:na};function ia({defaultTab:s,onTabChange:n,analysis:i}){V();const[d,$]=a.useState(!1),[v,m]=a.useState(!1),[_,b]=a.useState(!1),[N,S]=a.useState(!1),[l,p]=a.useState(0),[o,x]=a.useState(0),E=f=>{n(f.target.id)};return a.useEffect(()=>{if(!i)return;let f=0;const g=Object.filter=(t,c)=>Object.keys(t).filter(r=>(c(t[r])&&f++,c(t[r]))).reduce((r,h)=>(r[h]=t[h],r),{});g(i.analysis.indics,t=>t.ready===!1),p(f),f=0;const y=g(i.analysis.information,t=>t===!1);x(f),$((t=>Object.keys(t).length===0)(y)),b(Object.values(i.analysis.indics).reduce((t,c)=>c.ready?t:!1,!0)),S(i.analysis.geo),m(i.analysis.connections)},[i]),e.jsxs("div",{className:z["projects-tabs"],children:[e.jsx("div",{className:z.backdrop}),e.jsx("div",{className:z["ptabs-content"],children:e.jsxs(Re,{className:z["ptabs-tabs"],onChange:E,value:s,children:[e.jsx(G,{disableRipple:!0,label:"Cadastro",...Q("informacao",o>0?o:""),className:`${z.indicator} ${d?z.ready:z.warning} ${o<10&&z["fixed-size"]}`}),e.jsx(G,{disableRipple:!0,label:"Abrangência",className:`${z.indicator} ${N?z.ready:z["not-ready"]} ${z["fixed-size"]}`,...Q("abrangencia",N?"":"1")}),e.jsx(G,{disableRipple:!0,label:"Indicadores",...Q("indicadores_novos",l>0?l:""),className:`${z.indicator} ${_?z.ready:z["not-ready"]} ${l<10&&z["fixed-size"]}`}),e.jsx(G,{disableRipple:!0,label:"Conexões",...Q("conexoes")}),e.jsx(G,{disableRipple:!0,label:"Linha do tempo",...Q("timeline")})]})})]})}function Q(s,n=""){return{id:s,"aria-controls":`simple-tabpanel-${s}`,value:s,"data-problems":n}}const oa=[{type:"row",block:"ppea",elements:[{type:"row",elements:[{type:"column",size:8,key:"tipo"},{type:"column",size:4,key:"tipo_especifique"}]},{type:"row",elements:[{type:"column",size:12,key:"nome"},{type:"column",size:6,key:"area"},{type:"column",size:6,key:"area_tematica"}]},{type:"row",elements:[{type:"column",size:12,key:"link"}]}]},{type:"row",block:"inst",elements:[{type:"column",size:6,key:"instituicao_nome"},{type:"column",size:6,key:"instituicao_enquadramento"}]},{type:"row",block:"responsavel",elements:[{type:"row",elements:[{type:"column",size:6,key:"responsavel_nome"},{type:"column",size:6,key:"responsavel_cargo"}]},{type:"row",elements:[{type:"column",size:6,key:"responsavel_telefone"},{type:"column",size:6,key:"responsavel_email"}]}]},{type:"row",block:"more",elements:[{type:"row",elements:[{type:"column",size:4,key:"fase"},{type:"column",size:4,key:"fase_ano"},{type:"column",size:4,key:"fase_descricao"}]},{type:"row",elements:[{type:"column",size:4,key:"dificuldades"},{type:"column",size:8,key:"contemplados"}]}]}],ra={lists:[{key:"tipos",options:[{value:-1,label:"Não respondido"},{value:1,label:"Política"},{value:2,label:"Programa"},{value:3,label:"Plano"},{value:4,label:"Projeto"},{value:5,label:"Outro"}]},{key:"enquadramentos",options:[{value:-1,label:"Não respondido"},{value:0,label:"Nível Federal"},{value:1,label:"Nível Estadual"},{value:2,label:"Nível Municipal"},{value:5,label:"A partir de Unidade de Conservação"}]},{key:"areas",options:[{value:-1,label:"Não respondido"},{value:0,label:"Geral"},{value:1,label:"Temática"}]},{key:"fases",options:[{value:-1,label:"Não respondido"},{value:0,label:"Etapa de Formulação"},{value:1,label:"Etapa Inicial de Implementação"},{value:2,label:"Etapa de Implementação Avançada"},{value:3,label:"Etapa de Revisão"}]}]};function ca({entityId:s,problems:n}){const{server:i}=A(),{user:d}=V(),$=H(),{enqueueSnackbar:v,closeSnackbar:m}=B(),[_,b]=a.useState([]),[N,S]=a.useState({}),[l,p]=a.useState({}),{data:o}=D(["policy_info",{entityId:s}],{queryFn:async()=>(await k.get(`${i}ppea/${s}/draft/info`)).data}),{data:x}=D(["content_for_form_cad"],{queryFn:async()=>(await k.get(`${i}content/for_form/pp/pp/info`)).data,retry:!1,refetchOnWindowFocus:!1});a.useEffect(()=>{o&&p(o)},[o]);const E=(g,y)=>{b(g),S(y)},f=async()=>{const g=ge(te,_,N),y=v("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let j,t;j="put",t=`${i}ppea/${s}/draft`,await k({method:j,url:t,data:g,config:{headers:{"Content-Type":"multipart/form-data"}}}),$.invalidateQueries("policy_info"),$.invalidateQueries("policy_analysis"),m(y),v("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(j){m(y),console.error(j),v("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return o?e.jsx(e.Fragment,{children:_&&e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(P,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsx(he,{form:te,view:oa,lists:ra,data:_e(l,te),problems:n,onDataChange:E,helpbox:{isADM:d.membership.find(g=>g.id===fe),content:x,prefix:"pp.",type:"info"}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:f,children:[e.jsx(ne,{}),"Gravar"]})})]})]})})})})}):e.jsx(e.Fragment,{})}function la({entityId:s}){return e.jsx(e.Fragment,{children:e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(P,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:"[CONEXÕES]"})})})})})}const da="_vcentered_1g64r_1",ua="_add_1g64r_6",ma="_action_1g64r_7",pa="_timeline_1g64r_33",ha="_highlight_1g64r_36",_a="_each_1g64r_40",fa="_date_1g64r_49",ga="_text_1g64r_52",va="_thumb_1g64r_58",xa="_buttons_1g64r_81",ba="_editing_1g64r_86",w={vcentered:da,add:ua,action:ma,timeline:pa,highlight:ha,each:_a,date:fa,text:ga,thumb:va,"thumb-image":"_thumb-image_1g64r_62",buttons:xa,editing:ba,"edit-buttons":"_edit-buttons_1g64r_92"};function ya({entityId:s}){const{server:n}=A(),i=H(),[d,$]=a.useState([]),[v,m]=a.useState(null),[_,b]=a.useState(null),[N,S]=a.useState(null),[l,p]=a.useState(null),{data:o}=D(["ppea_timeline",{entityId:s}],{queryFn:async()=>(await k.get(`${n}ppea/${s}/draft/timeline`)).data,retry:!1,refetchOnWindowFocus:!1}),x=U(t=>k.delete(`${n}ppea/${s}/draft/timeline/${t}`),{onSuccess:()=>i.invalidateQueries("ppea_timeline")});a.useEffect(()=>{o&&$(o)},[o]),a.useEffect(()=>{_&&setTimeout(()=>{const t=document.getElementById(`timeline_${_}`);t&&(t.scrollIntoView({block:"end",inline:"nearest"}),S(_),b(null),setTimeout(()=>S(null),2e3))},10)},[d,_]);const E=t=>()=>{m(t)},f=t=>()=>{const c=d.find(r=>r.id===t);c&&p(c)},g=async t=>{t==="confirm"&&await x.mutateAsync(v),m(null)},y=()=>{p(null)},j=()=>{p(null)};return e.jsx(e.Fragment,{children:d&&e.jsxs("div",{className:"page-content",children:[e.jsxs("div",{className:"page-body",children:[e.jsx(P,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsxs("section",{id:"details",children:["A linha do tempo é uma ferramenta para a apresentação e o registro dos principais marcos/eventos da iniciativa. Insira o mês/ano em que o marco/evento aconteceu, uma imagem ilustrativa (pode ser uma fotografia real ou um ícone/desenho) e um texto descritivo. A ferramenta organiza automaticamente a apresentação dos marcos/eventos em ordem cronológica.",e.jsx("br",{}),"Alguns exemplos de marcos/eventos: criação da iniciativa, realização de atividades relevantes, eventos públicos, publicação de normativas, relatórios, materiais educomunicativos, etc."]})})}),e.jsx(P,{middle:!0,headerless:!0,children:e.jsx("div",{className:`p-3 ${w["add-panel"]}`,children:e.jsx("section",{id:"details",children:e.jsx(ue,{entityId:s,editing:l,onHighlight:b,add:!0,onSave:j})})})}),e.jsx(P,{middle:!0,headerless:!0,children:e.jsx("div",{className:"p-3",children:e.jsx("section",{id:"details",children:e.jsx("div",{className:w.timeline,children:!!o&&d.map(t=>e.jsxs(a.Fragment,{children:[(l==null?void 0:l.id)!==t.id&&e.jsxs("div",{id:`timeline_${t.id}`,className:`${w.each} ${N===t.id?w.highlight:""}`,children:[e.jsxs("div",{className:w.date,children:[" ",e.jsx("span",{className:w.text,children:we(t.date).locale("pt-br").format("MMM [de] YYYY")})]}),e.jsx("div",{className:w.thumb,children:e.jsxs("div",{className:w["thumb-image"],children:[!!t.timeline_arquivo&&e.jsx("img",{src:t.timeline_arquivo,alt:"imagem de timeline"}),!t.timeline_arquivo&&e.jsx("img",{src:Pe,alt:"sem imagem de timeline"})]})}),e.jsx("div",{className:w.text,children:t.texto}),e.jsxs("div",{className:w.buttons,children:[e.jsx("button",{className:w.action,onClick:f(t.id),disabled:!!l,children:e.jsx(De,{})}),(l==null?void 0:l.id)!==t.id&&e.jsx("button",{className:w.action,onClick:E(t.id),disabled:!!l,children:e.jsx(Ae,{})})]})]}),(l==null?void 0:l.id)===t.id&&e.jsx(ue,{entityId:s,editing:l,onHighlight:b,onCancel:y,onSave:j})]},t.id))})})})})]}),e.jsx(le,{open:!!v,content:"Confirma a remoção deste item?",confirmButtonText:"Remover",onClose:g})]})})}function ue({add:s,entityId:n,editing:i,onHighlight:d,onCancel:$,onSave:v}){const{enqueueSnackbar:m,closeSnackbar:_}=B(),{server:b}=A(),N=H(),[S,l]=a.useState(new Date),[p,o]=a.useState(null),[x,E]=a.useState(null),[f,g]=a.useState(null);a.useEffect(()=>{s?(l(new Date),g(null)):(l(i.date),g(i.texto),o({url:i.timeline_arquivo}))},[i]);const y=t=>{o(t||"remove"),E(t==null?void 0:t.file)},j=async()=>{if(!f||!f.length)return;let t=new FormData;x&&t.append("imagem",x);const c=m("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{let r,h;s?(r="post",h=`${b}ppea/${n}/draft/timeline`):(r="put",h=`${b}ppea/${n}/draft/timeline/${i.id}`),t.set("entity",JSON.stringify({date:S,texto:f,timeline_arquivo:p}));const{data:R}=await k({method:r,url:h,data:t,config:{headers:{"Content-Type":"multipart/form-data"}}});d(R.id),l(new Date),g(null),o(null),E(null),v(),N.invalidateQueries("ppea_timeline"),_(c),m("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})}catch(r){_(c),console.error(r),m("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}};return e.jsxs("div",{className:`row ${!s&&i?w.editing:""}`,children:[e.jsx("div",{className:`col-xs-2 ${w.vcentered}`,children:e.jsx(Ce,{className:"input-datepicker",label:"Mês",value:S||"",onChange:l,views:["month","year"],inputFormat:"MM/yyyy",disabled:s&&!!i})}),e.jsx("div",{className:"col-xs-1",children:e.jsx(Ee,{onChange:y,url:p==null?void 0:p.url,alt:"imagem",title:"Imagem",disabled:s&&!!i,viewer:!1})}),e.jsx("div",{className:"col-xs-8",children:e.jsx(ie,{className:"input-text",label:"Texto",value:f||"",onChange:t=>g(t.target.value),multiline:!0,rows:4,disabled:s&&!!i})}),e.jsxs("div",{className:`col-xs-1 ${w.vcentered}`,children:[s&&e.jsx("button",{className:w.add,onClick:j,disabled:s&&!!i,children:e.jsx(Be,{})}),!s&&e.jsxs("div",{className:w["edit-buttons"],children:[e.jsx("button",{className:w.add,onClick:j,children:e.jsx(Me,{})}),e.jsx("button",{className:w.add,onClick:$,children:e.jsx(Ie,{})})]})]})]})}const ja="_error_y2a6h_45",Na="_done_y2a6h_50",Sa="_indic_y2a6h_55",ka="_selected_y2a6h_59",$a="_field_y2a6h_63",wa="_title_box_y2a6h_66",Ca="_tree_y2a6h_81",Ea="_li_lae_titles_y2a6h_92",za="_show_y2a6h_96",Oa="_fade_in_show_y2a6h_1",qa="_hide_y2a6h_111",Fa="_li_indicators_y2a6h_114",Ta="_strong_y2a6h_125",Ra="_actions_y2a6h_151",Pa="_helpbox_button_y2a6h_157",Da="_button_delete_y2a6h_164",Aa="_Roll_y2a6h_1",F={error:ja,done:Na,indic:Sa,selected:ka,field:$a,title_box:wa,tree:Ca,li_lae_titles:Ea,show:za,fade_in_show:Oa,hide:qa,li_indicators:Fa,"item-container":"_item-container_y2a6h_118",strong:Ta,"indic-header":"_indic-header_y2a6h_137",actions:Ra,helpbox_button:Pa,button_delete:Da,Roll:Aa};function Ma({entityId:s,analysis:n,problems:i}){const{server:d}=A(),{currentCommunity:$,changeRoute:v,params:m}=L(),{user:_}=V(),b=H(),{enqueueSnackbar:N,closeSnackbar:S}=B(),[l,p]=a.useState(null),[o,x]=a.useState(null),[E,f]=a.useState(null),[g,y]=a.useState(null),[j,t]=a.useState(null),[c,r]=a.useState(!1),[h,R]=a.useState(null),[Y,J]=a.useState([]),[X,Z]=a.useState([]),[ee,ae]=a.useState({}),[C,q]=a.useState({}),{data:M}=D([`policy_info_2024_${o}`,{entityId:s}],{queryFn:async()=>(await k.get(`${d}ppea/${s}/draft/indicadores/${o}`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1}),{data:ye}=D([`content_for_form_${o}`],{queryFn:async()=>(await k.get(`${d}content/for_form/pp/${o}/indic`)).data,enabled:!!o,retry:!1,refetchOnWindowFocus:!1});a.useEffect(()=>{M&&q(M)},[M]),a.useEffect(()=>{n&&p(Ge(n))},[n]),a.useEffect(()=>{J(i)},[i]),a.useEffect(()=>{m&&m[1]?x(m[1]):x("1_1")},[m]),a.useEffect(()=>{if(o&&M){const u=o.split("_")[0];f(u);const O=l.find(I=>I.id===u).indics.find(I=>I.id===o);R(Qe(K,u,O.id))}},[o,M]);const je=u=>{y(g!==u?u:null)},Ne=(u,T)=>()=>{q({}),y(T),c?t(u):v({params:["indicadores_novos",u]})},Se=async u=>{u==="confirm"&&v({params:["indicadores_novos",j]}),t(null)},ke=(u,T)=>{Z(u),ae(T)},$e=async()=>{const u=ge(h,X,ee);u.set("indic",o);const T=N("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{let O,I;O="put",I=`${d}ppea/${s}/draft/indicadores/${o}`,await k({method:O,url:I,data:u,config:{headers:{"Content-Type":"multipart/form-data"}}}),b.invalidateQueries(`policy_info_2024_${o}`),b.invalidateQueries("policy_analysis"),S(T),N("Registro gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"center"}})}catch(O){S(T),console.error(O),N("Erro ao gravar o registro!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"center"}})}};return M?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"page-content",children:[e.jsx("div",{className:"page-sidebar",children:e.jsx("div",{className:`sidebar-body ${F.tree}`,children:l&&e.jsx("ul",{children:l.map(u=>{let T=We(K,u.id);return e.jsx(a.Fragment,{children:T&&e.jsxs("li",{className:`mb-3 ${F.li_lae_titles}`,onClick:()=>je(u.id),children:[e.jsx(me,{title:He(K,u.id),ready:u.ready,className:E===u.id||g===u.id?F.strong:""}),e.jsx("ul",{className:`${E===u.id||g===u.id?F.show:F.hide}`,children:u.indics.map(O=>e.jsx("li",{className:`${F.li_indicators}`,onClick:Ne(O.id,u.id),children:e.jsx(me,{title:Ke(K,u.id,O.id),ready:O.ready,className:`${F.indic} ${o===O.id?F.selected:""}`})},O.id))})]})},u.id)})})})}),e.jsx("div",{className:"page-body",children:e.jsx(P,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[!!h&&e.jsx(he,{form:h,data:_e(C,h),problems:Ue(o,Y),onDataChange:ke,helpbox:{isADM:_.membership.find(u=>u.id===fe),content:ye,prefix:`pp.${o.split("_")[0]}.${o}.`}}),e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:$e,children:[e.jsx(ne,{}),"Gravar"]})})]})]})})})]}),e.jsx(le,{open:!!j,content:"Você deseja sair do indicador sem salvar as alterações?",confirmButtonText:"Confirmar",onClose:Se})]}):e.jsx(e.Fragment,{})}function me({title:s,ready:n,className:i}){let d=n?e.jsx(xe,{}):e.jsx(Ve,{});return e.jsxs("div",{className:`${F["item-container"]} ${i}`,children:[e.jsx("div",{className:`${F[n?"done":"error"]}`,children:d}),e.jsx("div",{children:s})]})}function Ia({tab:s}){const{enqueueSnackbar:n,closeSnackbar:i}=B(),{server:d}=A(),{currentCommunity:$}=L(),[v,m]=a.useState(!1),[_,b]=a.useState(""),[N,S]=a.useState(!1),[l,p]=a.useState({});a.useEffect(()=>{b(""),m(!1),p({})},[]);const o={request:U(()=>k.post(`${d}help/request`,{communityId:$.id,tab:s,text:_}))},x=()=>{m(!0)},E=async()=>{let f=!1,g={};if(_.trim().length===0&&(g.message=!0,f=!0),p(g),f)return;S(!0);const y=n("Enviando pedido de ajuda...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"center"}});try{await o.request.mutateAsync(),i(y),n("Pedido de ajuda enviado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),m(!1)}catch(j){i(y),console.error(j),n("Erro ao enviar pedido de ajuda!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}finally{S(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{marginRight:"5px"},children:e.jsx(ze,{title:"Pedir ajuda",children:e.jsxs("button",{className:"button-outline",disabled:N,onClick:x,children:[e.jsx(Ye,{}),"Pedir ajuda sobre esta aba"]})})}),e.jsxs(oe,{open:v,onClose:()=>m(!1),"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"sm",children:[e.jsx(re,{id:"alert-dialog-title",children:"Envio de pedido de ajuda"}),e.jsx(W,{id:"alert-dialog-description",children:e.jsx("p",{className:"pt-1 px-3 pb-3",children:e.jsx(ie,{label:"Preencha este campo com sua dúvida",className:"input-text",value:_,onChange:f=>b(f.target.value),multiline:!0,rows:8,error:l.message})})}),e.jsxs(ce,{children:[e.jsx("button",{className:"button-primary",onClick:E,children:"Enviar"}),e.jsx(ve,{onClick:()=>m(!1),autoFocus:!0,children:"Cancelar"})]})]})]})}async function pe(s,n){const{data:{geoms:i,bbox:d}}=await k.get(`${s}ppea/${n}/geo-draw`);return console.log({geoms:i,bbox:d}),{geoms:i,bbox:d}}function Ba(){const s=H(),{server:n}=A(),{currentCommunity:i}=L(),{enqueueSnackbar:d,closeSnackbar:$}=B(),[v,m]=a.useState(null),[_,b]=a.useState(null),[N,S]=a.useState(""),[l,p]=a.useState(!1);a.useEffect(()=>{async function c(){const{data:{id:r}}=await k.get(`${n}ppea/id_from_community/${i.id}`);m(r)}c()},[i.id,n]);const[o,x]=a.useState(null),[E,f]=a.useState(null);a.useEffect(()=>{async function c(){const{data:{atuacao_aplica:r,atuacao_naplica_just:h}}=await k.get(`${n}ppea/${v}/geo-draw/has-geo`);b(r),S(h||"")}v&&c()},[v,n]),a.useEffect(()=>{async function c(){const{geoms:r,bbox:h}=await pe(n,v);x(r),h[0][0]&&f(h)}_&&c()},[_,v,n]);const g=async()=>{const c=d("Voltando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}}),{geoms:r,bbox:h}=await pe(n,v);x(r),h[0][0]&&f(h),$(c),p(!1)},y=async c=>{const r=c.features.map(({geometry:R})=>R),h=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await k.post(`${n}ppea/${v}/geo-draw`,{geoms:r}),s.invalidateQueries("policy_analysis"),$(h),d("Atuação gravado com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}})},j=async c=>{console.log({checked:c});const r=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});await k.put(`${n}ppea/${v}/geo-draw/${c?c==="none"?"none":"1":"0"}`),s.invalidateQueries("policy_analysis"),$(r),b(c)},t=async()=>{const c=d("Gravando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});return await k.put(`${n}ppea/${v}/draft/justification`,{value:N}),s.invalidateQueries("policy_analysis"),$(c),!0};return e.jsx("div",{className:"page-content",children:e.jsx("div",{className:"page-body",children:e.jsx(P,{middle:!0,headerless:!0,children:e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs(Ga,{children:[e.jsx("div",{children:"É possivel representar este projeto de geograficamente?"}),e.jsx(Oe,{children:e.jsxs(qe,{className:"input-select",value:_===null?"none":_,onChange:c=>j(c.target.value),children:[e.jsx(se,{value:"none",children:" -- selecione -- "}),e.jsx(se,{value:!0,children:"Sim"}),e.jsx(se,{value:!1,children:"Não"})]})})]}),e.jsx(Ia,{tab:"atuacao"})]}),_===!0&&e.jsx(Je,{entity:"ppea",initialGeoms:o,initialBBOX:E,isEditing:l,onEdit:c=>p(c),onSave:y,onCancel:g}),_===!1&&e.jsxs("section",{id:"details",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("div",{className:"section-title",children:"Justificativa"}),e.jsx("div",{className:"section-actions",children:e.jsxs("button",{className:"button-primary",onClick:()=>t(),children:[e.jsx(ne,{}),"Gravar"]})})]}),e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-xs-12",children:e.jsx(ie,{className:"input-text",value:N||"",onChange:c=>S(c.target.value),multiline:!0,rows:4})})})]})]})})})})}const Ga=Le.div`
  display: flex;
  margin-bottom: 20px;
  justify-content: end;
  align-items: center;
  div {
    margin-right: 10px;
  }
`,Qa="_button_delete_11779_45",Wa="_Roll_11779_1",Ha="_term_11779_82",be={button_delete:Qa,Roll:Wa,term:Ha},rt=()=>{const{currentCommunity:s,changeRoute:n,params:i}=L(),{server:d}=A(),{user:$,updateUser:v}=V(),{enqueueSnackbar:m,closeSnackbar:_}=B(),[b,N]=a.useState(null),[S,l]=a.useState(!1),[p,o]=a.useState(null),[x,E]=a.useState(null),[f,g]=a.useState(!1),[y,j]=a.useState(!1),[t,c]=a.useState(!1),{data:r}=D(["policy",{currentCommunity:s.id}],{queryFn:async()=>(await k.get(`${d}ppea/id_from_community/${s.id}`)).data,retry:!1,refetchOnWindowFocus:!1}),{data:h}=D(["policy_analysis",{policy_id:r==null?void 0:r.id}],{queryFn:async()=>(await k.get(`${d}ppea/${r==null?void 0:r.id}/verify`)).data,enabled:!!(r!=null&&r.id),retry:!1,refetchOnWindowFocus:!1}),R={publish:U(()=>k.put(`${d}ppea/${p}/publish`)),remove:U(()=>k.delete(`${d}ppea/${b}`))};a.useEffect(()=>{c($.membership.map(C=>C.id===1||C.id===s.id&&C.type==="adm").reduce((C,q)=>C||q))},[t,$,s]),a.useEffect(()=>{r&&o(r.id)},[r]),a.useEffect(()=>{E(i&&i.length?i[0]:"informacao")},[i]);const Y=()=>{j(!0)},J=C=>{C==="confirm"&&ee(),j(!1)},X=()=>{N(s.id),l(!0)},Z=async C=>{if(C==="confirm"){let q=await R.remove.mutateAsync(b);m("Iniciativa deletada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}}),n({community:q.data}),v()}N(null),l(!1)},ee=async()=>{const C=m("Publicando...",{persist:!0,anchorOrigin:{vertical:"top",horizontal:"right"}});try{const{data:q}=await R.publish.mutateAsync();if(_(C),q.success)window.location=`${window.location}`,m("politica publicada com sucesso!",{variant:"success",anchorOrigin:{vertical:"top",horizontal:"right"}});else if(q.reason.code==="not_ready")m(e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Esta politica ainda não esta pronta para ser publicada!"})}),e.jsx("p",{children:"Verifique se todos os campos das abas de Informações estão completamente preenchidos."})]}),{variant:"warning",anchorOrigin:{vertical:"top",horizontal:"center"}});else throw new Error("unknown reason")}catch(q){_(C),console.error(q),m("Erro ao publicar a politica!",{variant:"error",anchorOrigin:{vertical:"top",horizontal:"right"}})}},ae=()=>{window.open(`${d}ppea/${p}/download`,"_blank")};return e.jsxs("div",{className:"page",children:[e.jsxs("div",{className:"page-header",children:[e.jsx(Fe,{title:"Política Pública de Educação Ambiental"}),e.jsxs("div",{className:"page-header-buttons",children:[e.jsxs("button",{className:"button-outline",onClick:ae,children:[e.jsx(de,{}),"Baixar CSV"]}),e.jsxs("button",{className:"button-outline",onClick:()=>g(!0),children:[e.jsx(de,{}),"Baixar GEO (Shapefile)"]}),t&&t===!0&&e.jsxs("button",{className:"button-primary",onClick:Y,children:[e.jsx(xe,{}),"Publicar"]}),t&&t===!0&&e.jsxs("button",{className:be.button_delete,onClick:X,children:[e.jsx(Te,{}),"Excluir"]})]})]}),h&&x&&e.jsxs(e.Fragment,{children:[e.jsx(ia,{defaultTab:x,onTabChange:C=>n({params:[C]}),analysis:h}),p&&e.jsxs(e.Fragment,{children:[x==="informacao"&&e.jsx(ca,{entityId:p,problems:Object.keys(h.analysis.information).filter(C=>h.analysis.information[C]===!1)}),x==="indicadores_novos"&&e.jsx(Ma,{entityId:p,analysis:h,problems:h.analysis.question_problems}),x==="conexoes"&&e.jsx(la,{entityId:p}),x==="abrangencia"&&e.jsx(Ba,{entityId:p}),x==="timeline"&&e.jsx(ya,{entityId:p})]})]}),e.jsx(Xe,{display:"flex",justifyContent:"space-between"}),e.jsx(le,{open:S,content:"Confirma a remoção desta iniciativa?",confirmButtonText:"Remover",onClose:Z}),e.jsx(Ka,{open:f,onClose:()=>g(!1)}),e.jsx(Ua,{open:y,onClose:J})]})};function Ka({open:s,onClose:n}){return e.jsx("div",{children:e.jsxs(oe,{open:s,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(re,{id:"alert-dialog-title",children:"Aviso"}),e.jsx(W,{children:e.jsx(W,{id:"alert-dialog-description",children:"Este recurso esta em fase de implementação!"})}),e.jsx(ce,{children:e.jsx("button",{className:"button-primary",onClick:()=>n("cancel"),autoFocus:!0,children:"Fechar"})})]})})}function Ua({open:s,onClose:n}){return e.jsx("div",{children:e.jsxs(oe,{open:s,onClose:n,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",fullWidth:!0,maxWidth:"md",children:[e.jsx(re,{id:"alert-dialog-title",children:"Termo de Adesão ao PPPZCM"}),e.jsx(W,{children:e.jsxs(W,{id:"alert-dialog-description",className:be.term,children:[e.jsx("p",{children:"Declaro estar ciente e de acordo com as diretrizes político-pedagógicas do Sistema MonitoraEA e que reconheço a Plataforma MonitoraEA como um instrumento de gestão de dados das iniciativas de educação ambiental (políticas, projetos, instâncias, entre outros) no Brasil."}),e.jsx("p",{children:"Neste sentido, declaro a adesão ao Sistema MonitoraEA por meio da inserção da iniciativa ora cadastrada na Plataforma MonitoraEA. Declaro que a execução técnica e financeira da referida iniciativa está sob a responsabilidade integral da instituição proponente e, eventualmente, seus parceiros."}),e.jsx("p",{children:"Ainda, declaro concordar com a divulgação pública dos dados da iniciativa ora inserida – por meio da Plataforma MonitoraEA - e assumo a inteira responsabilidade pelo teor e veracidade das informações cadastradas."}),e.jsx("p",{children:"Por fim, declaro meu consentimento com a coleta, uso e tratamento de meus dados pessoais pela ANPPEA, que atuará como gestora de dados, nos termos da Lei 13.709/2018, e que tenho ciência de que poderei solicitar, a qualquer momento, a exclusão de meus dados do banco de dados da Plataforma MonitoraEA, bem como a revogação deste consentimento."})]})}),e.jsxs(ce,{children:[e.jsx("button",{className:"button-primary",onClick:()=>n("confirm"),children:"Concordo"}),e.jsx(ve,{onClick:()=>n("cancel"),autoFocus:!0,children:"Não concordo"})]})]})})}export{rt as default};
